<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<title>Icinga with IDOUtils Quickstart</title>
<STYLE type="text/css">
<!--
        .Default { font-family: verdana,arial,serif; font-size: 8pt; }
        .PageTitle { font-family: verdana,arial,serif; font-size: 16pt; font-weight: bold; }
-->      
</STYLE>
</head>

<body bgcolor="#FFFFFF" text="black" class="Default">

<div align="center">
<img src="images/logofullsize.png" border="0" alt="Icinga" title="Icinga">

<h1 class="PageTitle">Icinga with IDOUtils Quickstart</h1>
</div>

<hr>
<p>
Up To: <a href="toc.html">Contents</a><br>

</p>
<p>
<strong><u>Introduction</u></strong>
</p>

<p>
This guide is intended to provide you with simple instructions on how to install Icinga from source and the IDOUtils for your preferred database. It will show you how to enhance the normal installation procedure and how to configure the IDOUtils to capture monitoring data into a database.
<br>
This guide will show examples for Fedora and Ubuntu. Other distributiosn may inherit from those. <br><br>

<b>If you are planning to use Icinga without IDOUtils please read <a href="quickstart-icinga.html">this guide</a> instead!</b>
</p>

<br>

<p>
<strong><u>What You'll End Up With</u></strong>
</p>

<p>
If you follow these instructions, here's what you'll end up with:
</p>

<ul>
<li>Icinga and the plugins will be installed underneath /usr/local/icinga</li>
<li>Icinga will be configured to monitor a few aspects of your local system (CPU load, disk usage, etc.)</li>
<li>The Icinga web interface will be accessible at http://localhost/icinga/ or http://yourdomain.com/icinga</li>
<li>A database which is filled by Icinga using IDOUtils</li>
</ul>

<p>
<strong><u>Prerequisites</u></strong>
</p>

<p>
During portions of the installation you'll need to have <b>root</b> access to your machine.
</p>

<p>
Make sure you've installed the following packages on your system before continuing. IDOUtils use the <a href="http://libdbi.sourceforge.net" target="_blank">libdbi</a> and the libdbi-drivers for several databases. The development libraries are also required. 
<br><br>
The following examples will show how to install the IDOUtils with the libdbi using MySQL.
</p>

<ul>
<li>Apache</li>
<li>GCC compiler</li>
<li>C/C++ development librariesr</li>
<li><a href="http://www.boutell.com/gd/">GD</a> development libraries</li>
<li>libdbi/libdbi-drivers, database like mysql</li>
</ul>

<p>
You can install these packages by running the following commands (as root or sudo):
</p>


<i>Fedora</i>

<pre>
yum install httpd gcc glibc glibc-common gd gd-devel
yum install mysql
</pre>
<br>
From DAG repository or you compile it yourself from source.<br>
<pre>
yum libdbi libdbi-devel libdbi-drivers libdbi-dbd-mysql
</pre>

<i>Ubuntu</i>
<pre>
apt-get install apache2 build-essential libgd2-xpm-dev
apt-get install mysql
apt-get install libdbi0 libdbi0-dev libdbd-mysql
</pre>


<br>
<p>
<strong><u>1) Create Account Information</u></strong>
</p>

<p>
Become the root user.
</p>
<pre>
su -l
</pre>

<p>
Create a new <i>icinga</i> user account and give it a password.
</p>

<pre>
/usr/sbin/useradd -m icinga
passwd icinga
</pre>

<br>
<p>
<strong><u>2) Download Icinga and the Plugins</u></strong>
</p>

<p>
Change to your local source directory i.e. /usr/src
</p>

<pre>
cd /usr/src
</pre>

<p>
Either fetch the actual icinga-core snapshot from Icinga GIT 
<pre>
git clone git://git.icinga.org/icinga-core.git
</pre>

or download the tarball from <a href="http://www.icinga.org">Icinga Website</a>. <br>
<br>
Also don't forget to download the official <a href="http://nagiosplugins.org/download" target="_blank">Nagios Plugins</a> which are 100% comptaible with Icinga. <br><br>

</p>

<br>
<p>
<strong><u>3) Compile and Install Icinga with IDOUtils</u></strong>
</p>

<p>
Extract the Icinga source code tarball (or change directory to the GIT snapshot)
</p>

<pre>
cd /usr/src/
tar xvzf icinga-0.8.tar.gz
cd icinga 
</pre>

<p>
Run the Icinga configure script and enable IDOUtils. You will get help by using the --help flag:
</p>

<pre>
./configure --enable-idoutils
</pre>
<br>If configure fails on finding the dbi.h the libdbi doesn't seem to be correctly installed. Please go to Step 1 and check the steps.
<br>

<p>
Compile the Icinga source code. There is also an extra option for IDOUtils (<i>make idoutils</i>) if you need to recompile only this module. To see available options, only use "make".
</p>

<pre>
make all
</pre>

<p>
Install binaries, init script, sample config files and set permissions on the external command directory. Also install the IDOUtils.
</p>

<pre>
make install
make install-init
make install-config
make install-commandmode
make install-idoutils

or shorter

make fullinstall
</pre>

<p>
Don't start Icinga yet - there's still more that needs to be done...
</p>


<br>
<p>
<strong><u>4) Customize Configuration</u></strong>
</p>



<p>

Sample configuration files have been installed by using make install-config into /usr/local/icinga/etc/. You'll need to make just one change before you proceed...
</p>

<p>
Edit the <i>/usr/local/icinga/etc/objects/contacts.cfg</i> config file with your favorite editor and change the email address associated with the <i>icingaadmin</i> contact definition to the address you'd like to use for receiving alerts.
</p>

<pre>
vi /usr/local/icinga/etc/objects/contacts.cfg
</pre>


<br>
The sample files for the IDOUtils have been installed into /usr/local/icinga/etc/ named idomod.cfg-sample and ido2db.cfg-sample. Just rename or copy them to

<br>
<pre>
cd /usr/local/icinga/etc/
cp idomod.cfg-sample idomod.cfg
cp ido2db.cfg-sample ido2db.cfg
</pre>

To make sure that Icinga knows what to do with the data and die IDOUtils, you have to set the event broker module as the following:
<br>
<pre>
vi /usr/local/icinga/etc/icinga.cfg
add line
broker_module=/usr/local/icinga/bin/idomod.o config_file=/usr/local/icinga/etc/idomod.cfg
</pre>

<br>

<p>
<strong><u>5) Configure Database and IDOUtils</u></strong>
</p>

Install and setup the database server by setting a root password, creating a new user i.e. ido2db with password ido2db and grant all rights on the new database icinga.

Then import the database structure from the IDOUtils to your database, in this example called "icinga". You can also use <a href="http://www.phpmyadmin.net" target="_blank">phpMyAdmin</a> for this procedure.

<pre>
cd /usr/src/icinga/
cd /module/idoutils/db

mysql -u root -p icinga < mysql.sql
</pre>

If it fails make sure you have configured mysql and the daemon is up and running.<br>
<br>
Next step is to tell the IDOUtils the database configuration. 

<pre>
vi /usr/local/icinga/etc/ido2db.cfg
</pre>

Check the User/Group Privileges and modify them in case to your fittings. The db_servertype is configured per default to mysql, more database support will follow.<br>


<br>
<p>
<strong><u>6) Configure the Web Interface</u></strong>
</p>



<p>
Install the Icinga web config file in the Apache conf.d directory.
</p>

<pre>
make install-webconf
</pre>

<p>
Create a <i>icingaadmin</i> account for logging into the Icinga web interface.  If you want to change it later, use the same command. <br>
Remember the password you assign to this account - you'll need it later.
</p>

<pre>
htpasswd -c /usr/local/icinga/etc/htpasswd.users icingaadmin
</pre>



<p>
Reload/Restart Apache to make the new settings take effect.
</p>


<i>Fedora</i>
<pre>
service httpd restart
</pre>

<i>Ubuntu</i>
<pre>
/etc/init.d/apache2 reload
</pre>

<br>

<p>
<strong><u>7) Compile and Install the Nagios Plugins</u></strong>
</p>

<p>
Extract the Nagios plugins source code tarball.
</p>

<pre>
cd /usr/src
tar xvzf nagios-plugins-1.4.13.tar.gz
cd nagios-plugins-1.4.13
</pre>

<p>
Compile and install the plugins by changing install directory to /usr/local/icinga
</p>

<pre>
./configure --prefix=/usr/local/icinga --with-icinga-user=icinga
make
make install
</pre>

<br>

<p>
<strong><u>8) Start IDOUtils and Icinga</u></strong>
</p>


<i><b>Start IDOUtils</b></i><br>
<p>IDOUtils must be started and running <u>before</u> Icinga is started.</p>


<i>Start IDO</i>
<pre>
/usr/local/icinga/bin/ido2db -c /usr/local/icinga/etc/ido2db.cfg
</pre>

<i>Stop IDO</i>
<pre>
killall -9 ido2db
rm -f /usr/local/icinga/var/ido.sock
</pre>

<br>

<i><b>Start Icinga</b></i>
<br>
<p>
Verify the sample Icinga configuration files.
</p>

<pre>
/usr/local/icinga/bin/icinga -v /usr/local/icinga/etc/icinga.cfg
</pre>

<p>
If there are no errors, start Icinga.
</p>


<i>Fedora, openSUSE</i>
<pre>
service icinga start
</pre>

<i>Ubuntu</i>
<pre>
/etc/init.d/icinga start
</pre>

<br>
<i><b>Check IDOUtils</b></i> <br>
<p>Check your database being filled</p>

<pre>
mysql -u root -p
use icinga;
SELECT count(servicecheck_id) as cnt FROM icinga_servicechecks;
quit
</pre>


<br>

<i><b>Configure Icinga Startup</b></i>

<p>
Add Icinga to the list of system services and have it automatically start when the system boots (make sure you have installed the init script before).
</p>

<i>Fedora, openSUSE</i>
<pre>
chkconfig --add icinga
chkconfig icinga on
</pre>

<i>Ubuntu</i>
<pre>
ln -s /etc/init.d/icinga /etc/rcS.d/S99icinga
</pre>

<br>

<p>
<strong><u>8) Login to the Web Interface</u></strong>
</p>

<p>
You should now be able to access the Icinga web interface at the URL below.  You'll be prompted for the username (<i>icingaadmin</i>) and password you specified earlier.
</p>

<pre>
http://localhost/icinga/
or
http://yourdomain.com/icinga/
</pre>

<p>
Click on the "Service Detail" navbar link to see details of what's being monitored on your local machine.  It will take a few minutes for Icinga to check all the services associated with your machine.
</p>

<br>

<p>
<strong><u>9) Other Modifications</u></strong>
</p>



<p>
Make sure your system's firewall rules are configured to allow access to the web server if you want to access the Icinga interface remotely.
</p>
i.e. iptables for http/80
<pre>
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
</pre>


<p>
Setting up your mail transfer agent (MTA) like exim, sendmail or postfix to allow Icinga sending notification emails won't be explained here. Please refer to the <a href="http://www.nagioswiki.org" target="_blank">Nagios Wiki</a> for more ressources.

</p>

<p>
There are several tweaks for the IDOUtils (former NDOUtils of Nagios) available. 

</p>

<br>

<p>
<strong><u>10) You're Done</u></strong>
</p>

<p>
Congratulations!  You sucessfully installed Icinga with IDOUtils.  Your journey into monitoring has just begun.  You'll no doubt want to monitor more than just your local machine, so check out the <a href="http://nagios.sourceforge.net/docs/3_0/toc.html" target="_blank">official Nagios Documentation</a> for more configurations...
</p>


<!--
<ul>

<li><a href="monitoring-windows.html">Monitoring Windows machines</a></li>

<li><a href="monitoring-linux.html">Monitoring Linux/Unix machines</a></li>

<li><a href="monitoring-netware.html">Monitoring Netware servers</a></li>

<li><a href="monitoring-routers.html">Monitoring routers/switches</a></li>

<li><a href="monitoring-publicservices.html">Monitoring publicly available services (HTTP, FTP, SSH, etc.)</a></li>

</ul>
-->

<hr>

</body>
</html>
