<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Installation of the Icinga web frontend from scratch</title>
<meta name="generator" content="DocBook XSL Stylesheets V1.75.1">
<meta name="keywords" content="Supervision, Icinga, Nagios, Linux">
<link rel="home" href="index.html" title="Icinga Version 1.0.1 Documentation">
<link rel="up" href="ch10.html" title="Chapter 10. Development">
<link rel="prev" href="epnplugins.html" title="Developing Plugins For Use With Embedded Perl">
<link rel="next" href="icinga-api.html" title="Installation and use of the Icinga API">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<CENTER><IMG src="../images/logofullsize.png" border="0" alt="Icinga" title="Icinga"></CENTER>
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Installation of the Icinga web frontend from scratch</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="epnplugins.html">Prev</a> </td>
<th width="60%" align="center">Chapter 10. Development</th>
<td width="20%" align="right"> <a accesskey="n" href="icinga-api.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="section" title="Installation of the Icinga web frontend from scratch">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="icinga-web-scratch"></a>Installation of the Icinga web frontend from scratch</h2></div></div></div>
  

  <div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
      <p><span class="bold"><strong>Prerequisites</strong></span></p>

      <p>Based on the fact that you have a running mysql and php (with PEAR and CLI) environment and Icinga, Icinga-API and IDOUtils are
      running as well you can continue with the second step. Otherwise:</p>

      <p><span class="bold"><strong>Ubuntu / Debian</strong></span></p>

      <pre class="programlisting"> # apt-get install php5-cli php-pear php5-xmlrpc php5-xsl</pre>

      <p><span class="bold"><strong>Fedora / RHEL / CentOS</strong></span></p>

      <pre class="programlisting"> # yum install php-cli php-pear php-xmlrpc php-xsl</pre>

      <p><span class="bold"><strong>OpenSuSE</strong></span></p>

      <p>Please use yast to install the packages "php5-pear", "php5-xmlrpc", "php5-xsl", "php5-&lt;rdbm&gt;", "php5-soap",
      "php5-gettext", "php5-ldap" und "php5-gd". The CLI is contained in the php5 package.</p>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
          <p>At least in SLES10 SP2 the function "hash_hmac" is missing.</p>
        </td></tr>
</table></div>

      <p>Installing Icinga with IDOUtils and Icinga-API is described in the <a class="link" href="quickstart.html" title="Quickstart Installation Guides">Icinga Quickstart Guide</a> and
      the <a class="link" href="icinga-api.html" title="Installation and use of the Icinga API">Icinga-API</a> section.</p>

      <p>Take your clone from the icinga-web.git to get a fresh branch</p>

      <pre class="programlisting"> # git clone git://git.icinga.org/icinga-web.git</pre>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>The installation</strong></span></p>

      <p>If you downloaded an archive then please unpack it first</p>

      <pre class="programlisting"> # tar xzvf icinga-web-0.9.1-beta.tar.gz
</pre>

      <p>Then change to the directory:</p>

      <pre class="programlisting"> # cd icinga-web</pre>

      <p>Recently work has been started on setting up an installer for the new Icinga-web UI, so please use:</p>

      <pre class="programlisting"> # ./configure --help</pre>

      <p>to see all configure options.</p>

      <p>Per default the Icinga Webinterface will be installed to /usr/local/icinga-web by:</p>

      <pre class="programlisting"> # ./configure
 # make install</pre>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
        <p>Using no options the installer expects the icinga-API to be found at /usr/local/icinga-api but you can use the option
        "--with-icinga-api" to specify another location. If you installed Icinga using the quickstart guide you should use the following
        syntax:</p>

        <pre class="programlisting"> # ./configure --with-icinga-api=/usr/local/icinga/share/icinga-api</pre>
      </td></tr>
</table></div>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>PHP dependencies</strong></span></p>

      <p>Test the php dependencies with:</p>

      <pre class="programlisting"> # make testdeps</pre>

      <p>All required tests should pass successfully. Maybe you have to alter the php.ini for the framework.</p>

      <p>In case of the gpc_magic_quote setting, you have to disable both entries (apache and cli php.ini). The locations depend on the
      distributions used.</p>

      <pre class="programlisting"> # vi /etc/php5/apache/php.ini
   magic_quotes_gpc = off

 # vi /etc/php5/cli/php.ini
   magic_quotes_gpc = off</pre>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
        <p>If one of these files is missing you'll get an agavi error complaining about the setting of "magic_quotes_qpc" because the
        default is "ON".</p>
      </td></tr>
</table></div>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>Database installation</strong></span></p>

      <p><span class="bold"><strong>Manual creation</strong></span></p>

      <p>Create a database and a user of your choice. The user needs at least the following privileges: SELECT, UPDATE, INSERT, DELETE,
      CREATE, DROP, ALTER, INDEX. Import the following schemes into your database: etc/database/rescue/&lt;rdbm&gt;/rescue_schema.sql and
      etc/database/rescue/&lt;rdbm&gt;/rescue_data.sql. That's all.</p>

      <pre class="programlisting"> # mysql -u root -p
  
 mysql&gt; CREATE DATABASE icinga_web;
  
 GRANT USAGE ON *.* TO 'icinga_user'@'localhost' IDENTIFIED BY 'icinga_pass' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;
   
 GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, ALTER, INDEX ON icinga_web.* TO 'icinga_user'@'localhost';
 
 FLUSH PRIVILEGES ;

 quit</pre>

      <pre class="programlisting"> # cd /path/to/icinga-web/etc/database/deploy/mysql
 # mysql -u root -p icinga_web &lt; init.sql
 # mysql -u root -p icinga_web &lt; db-deploy.sql</pre>

      <p><span class="bold"><strong>Auto creation</strong></span></p>

      <p>Create a database user with scheme and data privileges (CREATE, DROP, ALTER, INDEX). Go to the <span class="emphasis"><em>etc</em></span> dir and
      copy <span class="emphasis"><em>build.properties</em></span> to a safe place (e.g. /tmp). Alter the database settings within the properties file. You
      can also set your database root user to create your scheme. Go to /usr/local/icinga-web/etc and call the phing deploy task:</p>

      <pre class="programlisting"> # cd /usr/local/icinga-web/etc
 # /usr/local/icinga-web/bin/phing -Dproperties=/usr/local/icinga-web/etc/build.properties db-initialize</pre>

      <p>You have to manually create a database user to access your database. Add the default data privileges that icinga-web can work
      with the newly created database.</p>

      <pre class="programlisting"> # mysql -u root -p
  
 mysql&gt; GRANT USAGE ON icinga_web.* TO 'icinga_user'@'localhost' IDENTIFIED BY 'icinga_pass' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0;
   
 GRANT SELECT, INSERT, UPDATE, DELETE ON icinga_web.* TO 'icinga_user'@'localhost';
 
 FLUSH PRIVILEGES ;

 quit</pre>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>Icinga-web settings</strong></span></p>

      <p>Alter the config files: Edit /usr/local/icinga-web/app/config/databases.xml and set database credentials (block should begin at
      line 7, in this Example: DB-User: icinga_user, PW: password):</p>
<pre class="programlisting">    &lt;database name="appkit_default" class="AgaviDoctrineDatabase"&gt;
       &lt;ae:parameter name="dsn"&gt;mysql://icinga_user:password@127.0.0.1:3306/icinga_web&lt;/ae:parameter&gt;
       &lt;ae:parameter name="username"&gt;icinga_user&lt;/ae:parameter&gt;
       &lt;ae:parameter name="password"&gt;password&lt;/ae:parameter&gt;
       &lt;ae:parameter name="charset"&gt;utf8&lt;/ae:parameter&gt;
       &lt;ae:parameter name="manager_attributes"&gt;
            
          &lt;ae:parameter name="MODEL_LOADING"&gt;CONSERVATIVE&lt;/ae:parameter&gt;
       &lt;/ae:parameter&gt;
       &lt;ae:parameter name="load_models"&gt;%de.icinga.appkit.doctrine_model_path%&lt;/ae:parameter&gt;
       &lt;/database&gt;</pre>

      <p>Change the credentials for your database connection</p>

      <p>Edit /usr/local/icinga-web/app/config/icinga.xml and set database credentials to give access to ido-db</p>

      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top">
        <p>Please keep in mind that you have to install IDOUtils before (according to the <a class="link" href="quickstart-idoutils.html" title="Icinga with IDOUtils Quickstart">Icinga IDOUtils Quickstart Guide</a> )</p>
      </td></tr>
</table></div>

      <p>Go to the appkit.factories section and change the path and the credentials for the icinga-api.</p>

      <pre class="programlisting">
 &lt;!-- icinga-api data interface --&gt;
                &lt;parameter name="IcingaData"&gt;
                        &lt;parameter name="class"&gt;IcingaData&lt;/parameter&gt;
                        &lt;parameter name="file"&gt;%core.module_dir%/Web/lib/icinga/factory/IcingaData.class.php &lt;/parameter&gt;

                         &lt;parameter name="requiredClasses"&gt;
                                &lt;!-- NONE --&gt;
                         &lt;/parameter&gt;

                         &lt;parameter name="api_file"&gt;%core.root_dir%/icinga-api/IcingaApi.php/&lt;parameter&gt;
                         &lt;parameter name="api_type"&gt;IcingaApi::CONNECTION_IDO&lt;/parameter&gt;

                         &lt;parameter name="config_type"&gt;mysql&lt;/parameter&gt;
                         &lt;parameter name="config_host"&gt;127.0.0.1&lt;/parameter&gt;


                         &lt;parameter name="config_port"&gt;3306&lt;/parameter&gt;
                         &lt;parameter name="config_database"&gt;icinga&lt;/parameter&gt;

                         &lt;parameter name="config_user"&gt;your-ido-user&lt;/parameter&gt;
                         &lt;parameter name="config_password"&gt;your-ido-pw&lt;/parameter&gt;

                         &lt;parameter name="config_table_prefix"&gt;icinga_&lt;/parameter&gt;
                &lt;/parameter&gt;</pre>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>Apache settings</strong></span></p>

      <p>This should be prepared:</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>mod_rewrite enabled, maybe you have to create a link:</p>
        </li></ul></div>

      <pre class="programlisting"> # ln -s /etc/apache2/mods-available/rewrite.load /etc/apache2/mods-enabled/rewrite.load</pre>

      <p>Using OpenSuSE you can use "a2enmod rewrite" to activate the module. If that doesn't work you have to edit the file
      "/etc/sysconfig/apache2". The module "rewrite" has to be appended to the line "APACHE_MODULES=...".</p>

      <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
          <p>Any htaccess enabled alias settings</p>
        </li></ul></div>

      <p>Edit your .htaccess in /usr/local/icinga-web/pub:</p>

      <p>At line 14, change the RewriteBase direction to suit your needs:</p>
<pre class="programlisting"> DirectoryIndex index.php

 Options -MultiViews -Indexes +FollowSymLinks
 Order allow,deny
 Allow from all

 &lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On

    # This depends on your path
    # on independent hosts the base is '/'
    RewriteBase /icinga-web/

        # If the requested URL does not exist (it's likely an agavi route),
        # pass it as path info to index.php, the Agavi dispatch script.
        RewriteRule ^$ index.php?/ [QSA,L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule (.*) index.php?/$1 [QSA,L]
 &lt;/IfModule&gt;

 &lt;IfModule mod_deflate.c&gt;
        SetOutputFilter DEFLATE

        BrowserMatch ^Mozilla/4 gzip-only-text/html
        BrowserMatch ^Mozilla/4\.0[678] no-gzip

        BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
        BrowserMatch \bMSI[E] !no-gzip !gzip-only-text/html

        Header append Vary User-Agent env=!dont-vary
 &lt;/IfModule&gt;

 &lt;IfDefine APACHE2&gt;
        AcceptPathInf  On
 &lt;/IfDefine&gt;

 #&lt;IfModule mod_auth_basic.c&gt;
 #       AuthType Basic
 #       AuthName "My http basic auth realm"
 #       AuthUserFile /path/to/my/htusers
 #       require valid-user
 #&lt;/IfModule&gt;</pre>

      <p>Go to the webservers configuration directory and create a new alias (maybe in /etc/apache2/conf.d/icinga-web.conf) :</p>

      <pre class="programlisting"> # vi /etc/apache2/conf.d/icinga-web.conf
  Alias /icinga-web /usr/local/icinga-web/pub
  &lt;directory /usr/local/icinga-web/pub&gt;
        AllowOverride All
  &lt;/directory&gt;</pre>

      <p>Clear cache:</p>

      <pre class="programlisting"> # rm /usr/local/icinga-web/app/cache/config/*.php</pre>

      <p>Restart your Webserver:</p>

      <pre class="programlisting"> # service apache2 restart</pre>

      <p>or</p>

      <pre class="programlisting"> # /etc/init.d/apache2 restart</pre>

      <p>or</p>

      <pre class="programlisting"> # /etc/init.d/httpd restart</pre>
    </li>
<li class="listitem">
      <p><span class="bold"><strong>Try</strong></span></p>

      <p><span class="bold"><strong>Please ensure mysql, apache, idoutils and icinga are running!</strong></span></p>

      <p>Go to the webpath (http://localhost/icinga-web/) and check if the webinterface starts without exceptions (database connections
      web and api). You can login with user 'root' and password 'password'.</p>

      <p>If if doesn't work then please have a look at the Apache log files.</p>
    </li>
</ol></div>

  <a class="indexterm" name="id1563947"></a>

  <a class="indexterm" name="id1563971"></a>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="epnplugins.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="ch10.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="icinga-api.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Developing Plugins For Use With Embedded Perl </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Installation and use of the Icinga API</td>
</tr>
</table>
</div>
<P class="copyright">© 2009-2010 Icinga Development Team, http://www.icinga.org</P>
</body>
</html>
