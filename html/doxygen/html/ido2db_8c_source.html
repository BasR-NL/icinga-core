<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Icinga-core: module/idoutils/src/ido2db.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icinga_logo4-300x109.png"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Icinga-core&#160;<span id="projectnumber">1.4.0</span></div>
   <div id="projectbrief">next gen monitoring</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('ido2db_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>module/idoutils/src/ido2db.c</h1>  </div>
</div>
<div class="contents">
<a href="ido2db_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> * IDO2DB.C - IDO To Database Daemon</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (c) 2005-2008 Ethan Galstad</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (c) 2009-2011 Icinga Development Team (http://www.icinga.org)</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> **************************************************************/</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">/*#define DEBUG_MEMORY 1*/</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#ifdef DEBUG_MEMORY</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mcheck.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#endif</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span>
<a name="l00015"></a>00015 <span class="comment">/* include our project&#39;s header files */</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html">../../../include/config.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="module_2idoutils_2include_2common_8h.html">../include/common.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="io_8h.html">../include/io.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html">../include/utils.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="protoapi_8h.html">../include/protoapi.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="ido2db_8h.html">../include/ido2db.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="db_8h.html">../include/db.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="dbhandlers_8h.html">../include/dbhandlers.h</a>&quot;</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#include &quot;../../../include/dh.h&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#endif</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a>00030 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="keyword">extern</span> <span class="keywordtype">char</span> *<a class="code" href="db_8c.html#a7cae92a27d9ba951ce9e956829ac737e">ido2db_db_tablenames</a>[<a class="code" href="db_8h.html#a1d34a98839d0be137a1be7028725bf76">IDO2DB_MAX_DBTABLES</a>];
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#ifdef USE_LIBDBI</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="db_8c.html#a0a046bd8693ce70c5d00a2335b336075">ido2db_check_dbd_driver</a>(<span class="keywordtype">void</span>);
<a name="l00038"></a>00038 <span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>SSL_METHOD *meth;
<a name="l00042"></a>00042 SSL_CTX *ctx;
<a name="l00043"></a>00043 <span class="keywordtype">int</span> allow_weak_random_seed = <a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00044"></a>00044 <span class="preprocessor">#endif</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a><a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">00046</a> <span class="keywordtype">char</span> *<a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>=NULL;
<a name="l00047"></a><a class="code" href="ido2db_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">00047</a> <span class="keywordtype">char</span> *<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>=NULL;
<a name="l00048"></a><a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">00048</a> <span class="keywordtype">char</span> *<a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">ido2db_user</a>=NULL;
<a name="l00049"></a><a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">00049</a> <span class="keywordtype">char</span> *<a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">ido2db_group</a>=NULL;
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">00051</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>=0;
<a name="l00052"></a><a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">00052</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>=<a class="code" href="io_8h.html#a607ea9f9be1d29bfce180bee814534f3">IDO_SINK_UNIXSOCKET</a>;
<a name="l00053"></a><a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">00053</a> <span class="keywordtype">char</span> *<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>=NULL;
<a name="l00054"></a>00054 
<a name="l00055"></a><a class="code" href="ido2db_8c.html#a2c74da3682e346aea9309a83b6ff5807">00055</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a2c74da3682e346aea9309a83b6ff5807">ido2db_tcp_port</a>=<a class="code" href="io_8h.html#a0a3a45b8e59b33c00838012c05319f65">IDO_DEFAULT_TCP_PORT</a>;
<a name="l00056"></a><a class="code" href="ido2db_8c.html#af172d681af5dfa9bda499a4bf35ed63d">00056</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#af172d681af5dfa9bda499a4bf35ed63d">ido2db_use_inetd</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="ido2db_8c.html#a71b1b43061926a8df745df9b8408ef95">00058</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a71b1b43061926a8df745df9b8408ef95">ido2db_show_version</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00059"></a><a class="code" href="ido2db_8c.html#ae857622e4aab1d6fb4ca043a50796d27">00059</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#ae857622e4aab1d6fb4ca043a50796d27">ido2db_show_license</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00060"></a><a class="code" href="ido2db_8c.html#a1e7654960c08f2225c2741d80ecad3e5">00060</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a1e7654960c08f2225c2741d80ecad3e5">ido2db_show_help</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">00062</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="ido2db_8c.html#a73ea372cc1ec7d695565e70aaa8614f4">00064</a> <a class="code" href="structido2db__dbconfig__struct.html">ido2db_dbconfig</a> <a class="code" href="db_8c.html#a73ea372cc1ec7d695565e70aaa8614f4">ido2db_db_settings</a>;
<a name="l00065"></a><a class="code" href="ido2db_8c.html#a1459bf87cdb4dd892ecebbb3e27e92fc">00065</a> <a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> <a class="code" href="ido2db_8c.html#a1459bf87cdb4dd892ecebbb3e27e92fc">thread_idi</a>;
<a name="l00066"></a><a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">00066</a> pthread_t <a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[1];
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="ido2db_8c.html#a3eec52d9d22159ce1967677e33516992">00068</a> time_t <a class="code" href="db_8c.html#a3eec52d9d22159ce1967677e33516992">ido2db_db_last_checkin_time</a>=0L;
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">00070</a> <span class="keywordtype">char</span> *<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>=NULL;
<a name="l00071"></a><a class="code" href="ido2db_8c.html#a8eba9fd4ad64e80e8f2e7a91a4f3d2d0">00071</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a8eba9fd4ad64e80e8f2e7a91a4f3d2d0">ido2db_debug_level</a>=<a class="code" href="ido2db_8h.html#ac726c5df56c46e323a00583134f5e5a0">IDO2DB_DEBUGL_NONE</a>;
<a name="l00072"></a><a class="code" href="ido2db_8c.html#ab58b27ab80d7038b4aed2731e24663ed">00072</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#ab58b27ab80d7038b4aed2731e24663ed">ido2db_debug_verbosity</a>=<a class="code" href="ido2db_8h.html#adb47aada967503ee664597bf96722e39">IDO2DB_DEBUGV_BASIC</a>;
<a name="l00073"></a><a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">00073</a> FILE *<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>=NULL;
<a name="l00074"></a><a class="code" href="ido2db_8c.html#aff7a69c074bd68f4f72fbdabe95dfaf9">00074</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="ido2db_8c.html#aff7a69c074bd68f4f72fbdabe95dfaf9">ido2db_max_debug_file_size</a>=0L;
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="ido2db_8c.html#afff9793851d462486f97259a2228a21e">00076</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#afff9793851d462486f97259a2228a21e">stop_signal_detected</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="ido2db_8c.html#a8b84b2f08d8a7a6a7f1e6dff51b4b7f0">00078</a> <span class="keywordtype">char</span> *<a class="code" href="icinga_8c.html#a8b84b2f08d8a7a6a7f1e6dff51b4b7f0">sigs</a>[35]={<span class="stringliteral">&quot;EXIT&quot;</span>,<span class="stringliteral">&quot;HUP&quot;</span>,<span class="stringliteral">&quot;INT&quot;</span>,<span class="stringliteral">&quot;QUIT&quot;</span>,<span class="stringliteral">&quot;ILL&quot;</span>,<span class="stringliteral">&quot;TRAP&quot;</span>,<span class="stringliteral">&quot;ABRT&quot;</span>,<span class="stringliteral">&quot;BUS&quot;</span>,<span class="stringliteral">&quot;FPE&quot;</span>,<span class="stringliteral">&quot;KILL&quot;</span>,<span class="stringliteral">&quot;USR1&quot;</span>,<span class="stringliteral">&quot;SEGV&quot;</span>,<span class="stringliteral">&quot;USR2&quot;</span>,<span class="stringliteral">&quot;PIPE&quot;</span>,<span class="stringliteral">&quot;ALRM&quot;</span>,<span class="stringliteral">&quot;TERM&quot;</span>,<span class="stringliteral">&quot;STKFLT&quot;</span>,<span class="stringliteral">&quot;CHLD&quot;</span>,<span class="stringliteral">&quot;CONT&quot;</span>,<span class="stringliteral">&quot;STOP&quot;</span>,<span class="stringliteral">&quot;TSTP&quot;</span>,<span class="stringliteral">&quot;TTIN&quot;</span>,<span class="stringliteral">&quot;TTOU&quot;</span>,<span class="stringliteral">&quot;URG&quot;</span>,<span class="stringliteral">&quot;XCPU&quot;</span>,<span class="stringliteral">&quot;XFSZ&quot;</span>,<span class="stringliteral">&quot;VTALRM&quot;</span>,<span class="stringliteral">&quot;PROF&quot;</span>,<span class="stringliteral">&quot;WINCH&quot;</span>,<span class="stringliteral">&quot;IO&quot;</span>,<span class="stringliteral">&quot;PWR&quot;</span>,<span class="stringliteral">&quot;UNUSED&quot;</span>,<span class="stringliteral">&quot;ZERR&quot;</span>,<span class="stringliteral">&quot;DEBUG&quot;</span>,(<span class="keywordtype">char</span> *)NULL};
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#ac480583b46396ce99b422d2c6864f6c7">ido2db_open_debug_log</a>(<span class="keywordtype">void</span>);
<a name="l00082"></a>00082 <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a15b16bfb2ea5d42ffaf8a5ab04c18ae8">ido2db_close_debug_log</a>(<span class="keywordtype">void</span>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">static</span> <span class="keywordtype">void</span> *ido2db_thread_cleanup_exit_handler(<span class="keywordtype">void</span> *);
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="ido2db_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">00086</a> <span class="keywordtype">int</span> <a class="code" href="checks_8c.html#a7c1d654b7b6114d7a0abc8d351dd1bcd">dummy</a>;      <span class="comment">/* reduce compiler warnings */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="ido2db_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">00089</a> <span class="keywordtype">int</span> <a class="code" href="icinga_8c.html#a7b26396c9888d66d997b0007e8ff1e60">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){
<a name="l00090"></a>00090         <span class="keywordtype">int</span> result=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="preprocessor">#ifdef DEBUG_MEMORY</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span>        mtrace();
<a name="l00094"></a>00094 <span class="preprocessor">#endif</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>        DH *dh;
<a name="l00097"></a>00097         <span class="keywordtype">char</span> seedfile[FILENAME_MAX];
<a name="l00098"></a>00098         <span class="keywordtype">int</span> i,<a class="code" href="test__checks_8c.html#a4e1e0e72dd773439e333c84dd762a9c3">c</a>;
<a name="l00099"></a>00099 <span class="preprocessor">#endif</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span><span class="preprocessor">#ifdef USE_LIBDBI</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>        dbi_driver driver;
<a name="l00102"></a>00102         <span class="keywordtype">int</span> numdrivers;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         driver = NULL;
<a name="l00105"></a>00105 <span class="preprocessor">#endif</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>        result=<a class="code" href="ido2db_8h.html#a0b82d263cd575413cee0a2666d4be67f">ido2db_process_arguments</a>(argc,argv);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108         <span class="keywordflow">if</span>(result!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a> || <a class="code" href="ido2db_8c.html#a1e7654960c08f2225c2741d80ecad3e5">ido2db_show_help</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a> || <a class="code" href="ido2db_8c.html#ae857622e4aab1d6fb4ca043a50796d27">ido2db_show_license</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a> || <a class="code" href="ido2db_8c.html#a71b1b43061926a8df745df9b8408ef95">ido2db_show_version</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l00109"></a>00109 
<a name="l00110"></a>00110                 <span class="keywordflow">if</span>(result!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>)
<a name="l00111"></a>00111                         printf(<span class="stringliteral">&quot;Incorrect command line arguments supplied\n&quot;</span>);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113                 printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00114"></a>00114                 printf(<span class="stringliteral">&quot;%s %s\n&quot;</span>,<a class="code" href="ido2db_8h.html#abb1b462ee3d4d7c1cae5e34e5145cbfd">IDO2DB_NAME</a>,<a class="code" href="ido2db_8h.html#ad9dbb956c0cc4e1ea750ae8de3115894">IDO2DB_VERSION</a>);
<a name="l00115"></a>00115                 printf(<span class="stringliteral">&quot;Copyright(c) 2005-2008 Ethan Galstad (nagios@nagios.org)\n&quot;</span>);
<a name="l00116"></a>00116                 printf(<span class="stringliteral">&quot;Copyright(c) 2009-2011 Icinga Development Team (http://www.icinga.org)\n&quot;</span>);
<a name="l00117"></a>00117                 printf(<span class="stringliteral">&quot;Last Modified: %s\n&quot;</span>,<a class="code" href="ido2db_8h.html#a762ca455a57c8009f6ec4cd1e6b08e7a">IDO2DB_DATE</a>);
<a name="l00118"></a>00118                 printf(<span class="stringliteral">&quot;License: GPL v2\n&quot;</span>);
<a name="l00119"></a>00119 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;SSL/TLS Available: Anonymous DH Mode, OpenSSL 0.9.6 or higher required\n&quot;</span>);
<a name="l00121"></a>00121 <span class="preprocessor">#endif</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00123"></a>00123                 printf(<span class="stringliteral">&quot;Stores Icinga event and configuration data to a database for later retrieval\n&quot;</span>);
<a name="l00124"></a>00124                 printf(<span class="stringliteral">&quot;and processing.  Clients that are capable of sending data to the IDO2DB daemon\n&quot;</span>);
<a name="l00125"></a>00125                 printf(<span class="stringliteral">&quot;include the LOG2IDO utility and IDOMOD event broker module.\n&quot;</span>);
<a name="l00126"></a>00126                 printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00127"></a>00127                 printf(<span class="stringliteral">&quot;Usage: %s -c &lt;config_file&gt; [-i] [-f]\n&quot;</span>,argv[0]);
<a name="l00128"></a>00128                 printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00129"></a>00129                 printf(<span class="stringliteral">&quot;-i  = Run under INETD/XINETD.\n&quot;</span>);
<a name="l00130"></a>00130                 printf(<span class="stringliteral">&quot;-f  = Don&#39;t daemonize, run in foreground.\n&quot;</span>);
<a name="l00131"></a>00131                 printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00132"></a>00132                 exit(1);
<a name="l00133"></a>00133                 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="comment">/* initialize variables */</span>
<a name="l00136"></a>00136         <a class="code" href="ido2db_8h.html#abe3340868235fc4287bea47a538b30d9">ido2db_initialize_variables</a>();
<a name="l00137"></a>00137 
<a name="l00138"></a>00138         <span class="comment">/* process config file */</span>
<a name="l00139"></a>00139         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8h.html#ac60a5b22c6070bb6948d21501865fc06">ido2db_process_config_file</a>(<a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>)!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>){
<a name="l00140"></a>00140                 printf(<span class="stringliteral">&quot;Error processing config file &#39;%s&#39;.\n&quot;</span>,<a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>);
<a name="l00141"></a>00141                 exit(1);
<a name="l00142"></a>00142         }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144         <span class="comment">/* print starting info to syslog */</span>
<a name="l00145"></a>00145         syslog(LOG_USER | LOG_INFO, <span class="stringliteral">&quot;%s %s (%s) Copyright (c) 2005-2008 Ethan Galstad (nagios@nagios.org), Copyright (c) 2009-2011 Icinga Development Team (http://www.icinga.org))&quot;</span>, <a class="code" href="ido2db_8h.html#abb1b462ee3d4d7c1cae5e34e5145cbfd">IDO2DB_NAME</a>, <a class="code" href="ido2db_8h.html#ad9dbb956c0cc4e1ea750ae8de3115894">IDO2DB_VERSION</a>, <a class="code" href="ido2db_8h.html#a762ca455a57c8009f6ec4cd1e6b08e7a">IDO2DB_DATE</a>);
<a name="l00146"></a>00146         syslog(LOG_USER | LOG_INFO, <span class="stringliteral">&quot;%s %s starting... (PID=%d)\n&quot;</span>, <a class="code" href="ido2db_8h.html#abb1b462ee3d4d7c1cae5e34e5145cbfd">IDO2DB_NAME</a>, <a class="code" href="ido2db_8h.html#ad9dbb956c0cc4e1ea750ae8de3115894">IDO2DB_VERSION</a>, (<span class="keywordtype">int</span>)getpid() );
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (<a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>==<a class="code" href="io_8h.html#a607ea9f9be1d29bfce180bee814534f3">IDO_SINK_UNIXSOCKET</a> &amp;&amp; <a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a> == <a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l00149"></a>00149                 printf(<span class="stringliteral">&quot;SSL is not allowed on socket_type=unix\n&quot;</span>);
<a name="l00150"></a>00150                 exit(1);
<a name="l00151"></a>00151         }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00154"></a>00154 <span class="preprocessor"></span>                <span class="comment">/* initialize SSL */</span>
<a name="l00155"></a>00155                 <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l00156"></a>00156                         SSL_library_init();
<a name="l00157"></a>00157                         SSLeay_add_ssl_algorithms();
<a name="l00158"></a>00158                         meth=SSLv23_server_method();
<a name="l00159"></a>00159                         SSL_load_error_strings();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161                         <span class="comment">/* use week random seed if necessary */</span>
<a name="l00162"></a>00162                         <span class="keywordflow">if</span>(allow_weak_random_seed &amp;&amp; (RAND_status()==0)){
<a name="l00163"></a>00163 
<a name="l00164"></a>00164                                 <span class="keywordflow">if</span>(RAND_file_name(seedfile,<span class="keyword">sizeof</span>(seedfile)-1))
<a name="l00165"></a>00165                                         <span class="keywordflow">if</span>(RAND_load_file(seedfile,-1))
<a name="l00166"></a>00166                                                 RAND_write_file(seedfile);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                                 <span class="keywordflow">if</span>(RAND_status()==0){
<a name="l00169"></a>00169                                         syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: SSL/TLS uses a weak random seed which is highly discouraged&quot;</span>);
<a name="l00170"></a>00170                                         srand(time(NULL));
<a name="l00171"></a>00171                                         <span class="keywordflow">for</span>(i=0;i&lt;500 &amp;&amp; RAND_status()==0;i++){
<a name="l00172"></a>00172                                                 <span class="keywordflow">for</span>(c=0;c&lt;<span class="keyword">sizeof</span>(seedfile);c+=<span class="keyword">sizeof</span>(int)){
<a name="l00173"></a>00173                                                         *((<span class="keywordtype">int</span> *)(seedfile+c))=rand();
<a name="l00174"></a>00174                                                         }
<a name="l00175"></a>00175                                                 RAND_seed(seedfile,<span class="keyword">sizeof</span>(seedfile));
<a name="l00176"></a>00176                                                 }
<a name="l00177"></a>00177                                         }
<a name="l00178"></a>00178                                 }
<a name="l00179"></a>00179                         <span class="keywordflow">if</span>((ctx=SSL_CTX_new(meth))==NULL){
<a name="l00180"></a>00180                                 syslog(LOG_ERR,<span class="stringliteral">&quot;Error: could not create SSL context.\n&quot;</span>);
<a name="l00181"></a>00181                                 exit(1);
<a name="l00182"></a>00182                                 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184                         <span class="comment">/* ADDED 01/19/2004 */</span>
<a name="l00185"></a>00185                         <span class="comment">/* use only TLSv1 protocol */</span>
<a name="l00186"></a>00186                         SSL_CTX_set_options(ctx,SSL_OP_NO_SSLv2 | SSL_OP_NO_SSLv3);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188                         <span class="comment">/* use anonymous DH ciphers */</span>
<a name="l00189"></a>00189                         SSL_CTX_set_cipher_list(ctx,<span class="stringliteral">&quot;ADH&quot;</span>);
<a name="l00190"></a>00190                         dh=get_dh512();
<a name="l00191"></a>00191                         SSL_CTX_set_tmp_dh(ctx,dh);
<a name="l00192"></a>00192                         DH_free(dh);
<a name="l00193"></a>00193                         syslog(LOG_INFO,<span class="stringliteral">&quot;INFO: SSL/TLS initialized. All network traffic will be encrypted.&quot;</span>);
<a name="l00194"></a>00194                         }
<a name="l00195"></a>00195                 <span class="keywordflow">else</span>{
<a name="l00196"></a>00196                         syslog(LOG_INFO,<span class="stringliteral">&quot;INFO: SSL/TLS NOT initialized. Network encryption DISABLED.&quot;</span>);
<a name="l00197"></a>00197                         }
<a name="l00198"></a>00198                 <span class="comment">/*Fin Hack SSL*/</span>
<a name="l00199"></a>00199 <span class="preprocessor">#endif</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>
<a name="l00201"></a>00201         <span class="comment">/* make sure we&#39;re good to go */</span>
<a name="l00202"></a>00202         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8h.html#a4dcf53a8a4f6eaa24974641ffe33e8c3">ido2db_check_init_reqs</a>()!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>){
<a name="l00203"></a>00203                 printf(<span class="stringliteral">&quot;One or more required parameters is missing or incorrect.\n&quot;</span>);
<a name="l00204"></a>00204                 exit(1);
<a name="l00205"></a>00205                 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="comment">/* make sure we support the db option chosen... */</span>
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="comment">/******************************/</span>
<a name="l00210"></a>00210 <span class="preprocessor">#ifdef USE_LIBDBI </span><span class="comment">/* everything else will be libdbi */</span>
<a name="l00211"></a>00211         <span class="keywordflow">if</span>(<a class="code" href="db_8c.html#a0a046bd8693ce70c5d00a2335b336075">ido2db_check_dbd_driver</a>()==<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>){
<a name="l00212"></a>00212                 printf(<span class="stringliteral">&quot;Support for the specified database server is either not yet supported, or was not found on your system.\n&quot;</span>);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214                 numdrivers = dbi_initialize(NULL);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216                 fprintf(stderr, <span class="stringliteral">&quot;%d drivers available: &quot;</span>, numdrivers);
<a name="l00217"></a>00217                 <span class="keywordflow">while</span> ((driver = dbi_driver_list(driver)) != NULL) {
<a name="l00218"></a>00218 
<a name="l00219"></a>00219                         fprintf(stderr, <span class="stringliteral">&quot;%s &quot;</span>, dbi_driver_get_name(driver));
<a name="l00220"></a>00220                 }
<a name="l00221"></a>00221                 fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00224"></a>00224 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>)
<a name="l00225"></a>00225                         SSL_CTX_free(ctx);
<a name="l00226"></a>00226 <span class="preprocessor">#endif</span>
<a name="l00227"></a>00227 <span class="preprocessor"></span>
<a name="l00228"></a>00228                 exit(1);
<a name="l00229"></a>00229                 }
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         <span class="comment">/* 2009-10-16 Michael Friedrich: libdbi Oracle driver is not yet working, remains broken */</span>
<a name="l00232"></a>00232         <span class="keywordflow">if</span>(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>==<a class="code" href="ido2db_8h.html#a0d0de9f405aad359889c88121cad5ddf">IDO2DB_DBSERVER_ORACLE</a>) {
<a name="l00233"></a>00233                 printf(<span class="stringliteral">&quot;Support for libdbi Oracle driver is not yet working.\n&quot;</span>);
<a name="l00234"></a>00234                 exit(1);
<a name="l00235"></a>00235         }
<a name="l00236"></a>00236 <span class="preprocessor">#endif</span>
<a name="l00237"></a>00237 <span class="preprocessor"></span>
<a name="l00238"></a>00238 <span class="comment">/******************************/</span>
<a name="l00239"></a>00239 <span class="preprocessor">#ifdef USE_PGSQL </span><span class="comment">/* pgsql */</span>
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="comment">/* we don&#39;t have a driver check here */</span>
<a name="l00242"></a>00242 <span class="preprocessor">#endif</span>
<a name="l00243"></a>00243 <span class="preprocessor"></span>
<a name="l00244"></a>00244 <span class="comment">/******************************/</span>
<a name="l00245"></a>00245 <span class="preprocessor">#ifdef USE_ORACLE </span><span class="comment">/* Oracle ocilib specific */</span>
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db with ocilib() driver check\n&quot;</span>);
<a name="l00248"></a>00248         <span class="keywordflow">if</span>(OCI_GetOCIRuntimeVersion == OCI_UNKNOWN) {
<a name="l00249"></a>00249                 printf(<span class="stringliteral">&quot;Unknown ocilib runtime version detected. Exiting...\n&quot;</span>);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00252"></a>00252 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>)
<a name="l00253"></a>00253                         SSL_CTX_free(ctx);
<a name="l00254"></a>00254 <span class="preprocessor">#endif</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span>
<a name="l00256"></a>00256                 exit(1);
<a name="l00257"></a>00257         }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 <span class="preprocessor">#endif </span><span class="comment">/* Oracle ocilib specific */</span>
<a name="l00260"></a>00260 <span class="comment">/******************************/</span>
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         <span class="comment">/* initialize signal handling */</span>
<a name="l00263"></a>00263         signal(SIGQUIT,<a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>);
<a name="l00264"></a>00264         signal(SIGTERM,<a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>);
<a name="l00265"></a>00265         signal(SIGINT,<a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>);
<a name="l00266"></a>00266         signal(SIGSEGV,<a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>);
<a name="l00267"></a>00267         signal(SIGFPE,<a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>);
<a name="l00268"></a>00268         signal(SIGCHLD,<a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="comment">/* drop privileges */</span>
<a name="l00271"></a>00271         <a class="code" href="ido2db_8h.html#a18ba617fb4b4fc0fa8981f3f6b8166a2">ido2db_drop_privileges</a>(<a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">ido2db_user</a>,<a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">ido2db_group</a>);
<a name="l00272"></a>00272 
<a name="l00273"></a>00273         <span class="comment">/* open debug log */</span>
<a name="l00274"></a>00274         <a class="code" href="ido2db_8c.html#ac480583b46396ce99b422d2c6864f6c7">ido2db_open_debug_log</a>();
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="comment">/* if we&#39;re running under inetd... */</span>
<a name="l00277"></a>00277         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af172d681af5dfa9bda499a4bf35ed63d">ido2db_use_inetd</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                 <span class="comment">/* redirect STDERR to /dev/null */</span>
<a name="l00280"></a>00280                 close(2);
<a name="l00281"></a>00281                 open(<span class="stringliteral">&quot;/dev/null&quot;</span>,O_WRONLY);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283                 <span class="comment">/* handle the connection */</span>
<a name="l00284"></a>00284                 <a class="code" href="ido2db_8h.html#ad8670e8992b6bff3724859a95c47cb9a">ido2db_handle_client_connection</a>(0);
<a name="l00285"></a>00285                 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287         <span class="comment">/* standalone daemon... */</span>
<a name="l00288"></a>00288         <span class="keywordflow">else</span>{
<a name="l00289"></a>00289 
<a name="l00290"></a>00290                 <span class="comment">/* create socket and wait for clients to connect */</span>
<a name="l00291"></a>00291                 <span class="keywordflow">if</span>(<a class="code" href="ido2db_8h.html#aaa5047944a02bf110d06e511fb877b98">ido2db_wait_for_connections</a>()==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>)
<a name="l00292"></a>00292                         <span class="keywordflow">return</span> 1;
<a name="l00293"></a>00293                 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="comment">/* tell the log we&#39;re done */</span>
<a name="l00296"></a>00296         syslog(LOG_USER | LOG_INFO, <span class="stringliteral">&quot;Successfully shutdown... (PID=%d)\n&quot;</span>,(<span class="keywordtype">int</span>)getpid());
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <span class="comment">/* close debug log */</span>
<a name="l00299"></a>00299         <a class="code" href="ido2db_8c.html#a15b16bfb2ea5d42ffaf8a5ab04c18ae8">ido2db_close_debug_log</a>();
<a name="l00300"></a>00300 
<a name="l00301"></a>00301         <span class="comment">/* free memory */</span>
<a name="l00302"></a>00302         <a class="code" href="ido2db_8h.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">ido2db_free_program_memory</a>();
<a name="l00303"></a>00303 
<a name="l00304"></a>00304 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>)
<a name="l00306"></a>00306                 SSL_CTX_free(ctx);
<a name="l00307"></a>00307 <span class="preprocessor">#endif</span>
<a name="l00308"></a>00308 <span class="preprocessor"></span>
<a name="l00309"></a>00309         <span class="keywordflow">return</span> 0;
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="comment">/* process command line arguments */</span>
<a name="l00314"></a><a class="code" href="ido2db_8c.html#a3457dae7cc24f72dc9895bb3207cebd8">00314</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a0b82d263cd575413cee0a2666d4be67f">ido2db_process_arguments</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){
<a name="l00315"></a>00315         <span class="keywordtype">char</span> optchars[32];
<a name="l00316"></a>00316         <span class="keywordtype">int</span> <a class="code" href="test__checks_8c.html#a4e1e0e72dd773439e333c84dd762a9c3">c</a>=1;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="preprocessor">#ifdef HAVE_GETOPT_H</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>        <span class="keywordtype">int</span> option_index=0;
<a name="l00320"></a>00320         <span class="keyword">static</span> <span class="keyword">struct </span>option long_options[]={
<a name="l00321"></a>00321                 {<span class="stringliteral">&quot;configfile&quot;</span>, required_argument, 0, <span class="charliteral">&#39;c&#39;</span>},
<a name="l00322"></a>00322                 {<span class="stringliteral">&quot;inetd&quot;</span>, no_argument, 0, <span class="charliteral">&#39;i&#39;</span>},
<a name="l00323"></a>00323                 {<span class="stringliteral">&quot;foreground&quot;</span>, no_argument, 0, <span class="charliteral">&#39;f&#39;</span>},
<a name="l00324"></a>00324                 {<span class="stringliteral">&quot;help&quot;</span>, no_argument, 0, <span class="charliteral">&#39;h&#39;</span>},
<a name="l00325"></a>00325                 {<span class="stringliteral">&quot;license&quot;</span>, no_argument, 0, <span class="charliteral">&#39;l&#39;</span>},
<a name="l00326"></a>00326                 {<span class="stringliteral">&quot;version&quot;</span>, no_argument, 0, <span class="charliteral">&#39;V&#39;</span>},
<a name="l00327"></a>00327                 {0, 0, 0, 0}
<a name="l00328"></a>00328                 };
<a name="l00329"></a>00329 <span class="preprocessor">#endif</span>
<a name="l00330"></a>00330 <span class="preprocessor"></span>
<a name="l00331"></a>00331         <span class="comment">/* no options were supplied */</span>
<a name="l00332"></a>00332         <span class="keywordflow">if</span>(argc&lt;2){
<a name="l00333"></a>00333                 <a class="code" href="ido2db_8c.html#a1e7654960c08f2225c2741d80ecad3e5">ido2db_show_help</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00334"></a>00334                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00335"></a>00335                 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337         <a class="code" href="snprintf_8c.html#aa367b75c5aed883fef5befbdf04835a4">snprintf</a>(optchars,<span class="keyword">sizeof</span>(optchars),<span class="stringliteral">&quot;c:ifhlV&quot;</span>);
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="keywordflow">while</span>(1){
<a name="l00340"></a>00340 <span class="preprocessor">#ifdef HAVE_GETOPT_H</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span>                c=getopt_long(argc,argv,optchars,long_options,&amp;option_index);
<a name="l00342"></a>00342 <span class="preprocessor">#else</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>                c=getopt(argc,argv,optchars);
<a name="l00344"></a>00344 <span class="preprocessor">#endif</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(c==-1 || c==EOF)
<a name="l00346"></a>00346                         <span class="keywordflow">break</span>;
<a name="l00347"></a>00347 
<a name="l00348"></a>00348                 <span class="comment">/* process all arguments */</span>
<a name="l00349"></a>00349                 <span class="keywordflow">switch</span>(c){
<a name="l00350"></a>00350 
<a name="l00351"></a>00351                 <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:
<a name="l00352"></a>00352                 <span class="keywordflow">case</span> <span class="charliteral">&#39;h&#39;</span>:
<a name="l00353"></a>00353                         <a class="code" href="ido2db_8c.html#a1e7654960c08f2225c2741d80ecad3e5">ido2db_show_help</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00354"></a>00354                         <span class="keywordflow">break</span>;
<a name="l00355"></a>00355                 <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:
<a name="l00356"></a>00356                         <a class="code" href="ido2db_8c.html#a71b1b43061926a8df745df9b8408ef95">ido2db_show_version</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00357"></a>00357                         <span class="keywordflow">break</span>;
<a name="l00358"></a>00358                 <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:
<a name="l00359"></a>00359                         <a class="code" href="ido2db_8c.html#ae857622e4aab1d6fb4ca043a50796d27">ido2db_show_license</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00360"></a>00360                         <span class="keywordflow">break</span>;
<a name="l00361"></a>00361                 <span class="keywordflow">case</span> <span class="charliteral">&#39;c&#39;</span>:
<a name="l00362"></a>00362                         <a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>=strdup(optarg);
<a name="l00363"></a>00363                         <span class="keywordflow">break</span>;
<a name="l00364"></a>00364                 <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:
<a name="l00365"></a>00365                         <a class="code" href="ido2db_8c.html#af172d681af5dfa9bda499a4bf35ed63d">ido2db_use_inetd</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00366"></a>00366                         <span class="keywordflow">break</span>;
<a name="l00367"></a>00367                 <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:
<a name="l00368"></a>00368                         <a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00369"></a>00369                         <span class="keywordflow">break</span>;
<a name="l00370"></a>00370                 <span class="keywordflow">default</span>:
<a name="l00371"></a>00371                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00372"></a>00372                         <span class="keywordflow">break</span>;
<a name="l00373"></a>00373                         }
<a name="l00374"></a>00374                 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376         <span class="comment">/* make sure required args were supplied */</span>
<a name="l00377"></a>00377         <span class="keywordflow">if</span>((<a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>==NULL) &amp;&amp; <a class="code" href="ido2db_8c.html#a1e7654960c08f2225c2741d80ecad3e5">ido2db_show_help</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a> &amp;&amp; <a class="code" href="ido2db_8c.html#a71b1b43061926a8df745df9b8408ef95">ido2db_show_version</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>  &amp;&amp; <a class="code" href="ido2db_8c.html#ae857622e4aab1d6fb4ca043a50796d27">ido2db_show_license</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>)
<a name="l00378"></a>00378                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="comment">/****************************************************************************/</span>
<a name="l00386"></a>00386 <span class="comment">/* CONFIG FUNCTIONS                                                         */</span>
<a name="l00387"></a>00387 <span class="comment">/****************************************************************************/</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/* process all config vars in a file */</span>
<a name="l00390"></a><a class="code" href="ido2db_8c.html#a7c6634794a94eac63600373614fa1b7a">00390</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ac60a5b22c6070bb6948d21501865fc06">ido2db_process_config_file</a>(<span class="keywordtype">char</span> *filename){
<a name="l00391"></a>00391         <a class="code" href="structido__mmapfile__struct.html">ido_mmapfile</a> *thefile=NULL;
<a name="l00392"></a>00392         <span class="keywordtype">char</span> *buf=NULL;
<a name="l00393"></a>00393         <span class="keywordtype">int</span> result=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395         <span class="comment">/* open the file */</span>
<a name="l00396"></a>00396         <span class="keywordflow">if</span>((thefile=<a class="code" href="io_8h.html#a0cab4680c7e760a25d7b4e21fd251c19">ido_mmap_fopen</a>(filename))==NULL){
<a name="l00397"></a>00397                 syslog(LOG_ERR, <span class="stringliteral">&quot;Error: Unable to open configuration file %s: %s\n&quot;</span>, filename, strerror(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l00398"></a>00398                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401         <span class="comment">/* process each line of the file */</span>
<a name="l00402"></a>00402         <span class="keywordflow">while</span>((buf=<a class="code" href="io_8h.html#a320945b0735c887009ad8c82c8cdc790">ido_mmap_fgets</a>(thefile))){
<a name="l00403"></a>00403 
<a name="l00404"></a>00404                 <span class="comment">/* skip comments */</span>
<a name="l00405"></a>00405                 <span class="keywordflow">if</span>(buf[0]==<span class="charliteral">&#39;#&#39;</span>){
<a name="l00406"></a>00406                         free(buf);
<a name="l00407"></a>00407                         <span class="keywordflow">continue</span>;
<a name="l00408"></a>00408                         }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410                 <span class="comment">/* skip blank lines */</span>
<a name="l00411"></a>00411                 <span class="keywordflow">if</span>(!strcmp(buf,<span class="stringliteral">&quot;&quot;</span>)){
<a name="l00412"></a>00412                         free(buf);
<a name="l00413"></a>00413                         <span class="keywordflow">continue</span>;
<a name="l00414"></a>00414                         }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416                 <span class="comment">/* process the variable */</span>
<a name="l00417"></a>00417                 result=<a class="code" href="ido2db_8h.html#a42dc50520bc5b9e6f3af3846d8d27c18">ido2db_process_config_var</a>(buf);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                 <span class="comment">/* free memory */</span>
<a name="l00420"></a>00420                 free(buf);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                 <span class="keywordflow">if</span>(result!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>)
<a name="l00423"></a>00423                         <span class="keywordflow">break</span>;
<a name="l00424"></a>00424                 }
<a name="l00425"></a>00425 
<a name="l00426"></a>00426         <span class="comment">/* close the file */</span>
<a name="l00427"></a>00427         <a class="code" href="io_8h.html#adf9db5340ae5d215489aab3642daccaf">ido_mmap_fclose</a>(thefile);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429         <span class="keywordflow">return</span> result;
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 <span class="comment">/* process a single module config variable */</span>
<a name="l00434"></a><a class="code" href="ido2db_8c.html#aa60cf7effcc13621e151826c96cc8b12">00434</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a42dc50520bc5b9e6f3af3846d8d27c18">ido2db_process_config_var</a>(<span class="keywordtype">char</span> *arg){
<a name="l00435"></a>00435         <span class="keywordtype">char</span> *var=NULL;
<a name="l00436"></a>00436         <span class="keywordtype">char</span> *val=NULL;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_process_config_var() start\n&quot;</span>);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440         <span class="comment">/* split var/val */</span>
<a name="l00441"></a>00441         var=strtok(arg,<span class="stringliteral">&quot;=&quot;</span>);
<a name="l00442"></a>00442         val=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="comment">/* skip incomplete var/val pairs */</span>
<a name="l00445"></a>00445         <span class="keywordflow">if</span>(var==NULL || val==NULL)
<a name="l00446"></a>00446                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448         <span class="comment">/* process the variable... */</span>
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;lock_file&quot;</span>)){
<a name="l00451"></a>00451                 <span class="keywordflow">if</span>((<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>=strdup(val))==NULL)
<a name="l00452"></a>00452                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00453"></a>00453                 }
<a name="l00454"></a>00454         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;socket_type&quot;</span>)){
<a name="l00455"></a>00455                 <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;tcp&quot;</span>))
<a name="l00456"></a>00456                         <a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>=<a class="code" href="io_8h.html#a55998c4058fa96daf21dc2ef39120d39">IDO_SINK_TCPSOCKET</a>;
<a name="l00457"></a>00457                 <span class="keywordflow">else</span>
<a name="l00458"></a>00458                         <a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>=<a class="code" href="io_8h.html#a607ea9f9be1d29bfce180bee814534f3">IDO_SINK_UNIXSOCKET</a>;
<a name="l00459"></a>00459                 }
<a name="l00460"></a>00460         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;socket_name&quot;</span>)){
<a name="l00461"></a>00461                 <span class="keywordflow">if</span>((<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>=strdup(val))==NULL)
<a name="l00462"></a>00462                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00463"></a>00463                 }
<a name="l00464"></a>00464         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;tcp_port&quot;</span>)){
<a name="l00465"></a>00465                 <a class="code" href="ido2db_8c.html#a2c74da3682e346aea9309a83b6ff5807">ido2db_tcp_port</a>=atoi(val);
<a name="l00466"></a>00466                 }
<a name="l00467"></a>00467         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_servertype&quot;</span>)){
<a name="l00468"></a>00468                 <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;mysql&quot;</span>)) {
<a name="l00469"></a>00469                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#ad48b29b133cd17ceb8553d9847dcf499">IDO2DB_DBSERVER_MYSQL</a>;
<a name="l00470"></a>00470                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00471"></a>00471                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;pgsql&quot;</span>)) {
<a name="l00472"></a>00472                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#a5d7a222e12362117452ccbb845cd81ed">IDO2DB_DBSERVER_PGSQL</a>;
<a name="l00473"></a>00473                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00474"></a>00474                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;db2&quot;</span>)) {
<a name="l00475"></a>00475                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#a761887a09a9a83299a66c376f31d737b">IDO2DB_DBSERVER_DB2</a>;
<a name="l00476"></a>00476                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00477"></a>00477                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;firebird&quot;</span>)) {
<a name="l00478"></a>00478                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#a2d5595a882963a78529260b349020b46">IDO2DB_DBSERVER_FIREBIRD</a>;
<a name="l00479"></a>00479                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00480"></a>00480                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;freetds&quot;</span>)) {
<a name="l00481"></a>00481                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#a52b1a6064015c5a92f3e9c0f8fdabcc4">IDO2DB_DBSERVER_FREETDS</a>;
<a name="l00482"></a>00482                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00483"></a>00483                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;ingres&quot;</span>)) {
<a name="l00484"></a>00484                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#adb80417dfd7dea54d775e5b5c0ce0b10">IDO2DB_DBSERVER_INGRES</a>;
<a name="l00485"></a>00485                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00486"></a>00486                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;msql&quot;</span>)) {
<a name="l00487"></a>00487                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#ac23466026dee32aadb5b68c6a6baf670">IDO2DB_DBSERVER_MSQL</a>;
<a name="l00488"></a>00488                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00489"></a>00489                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;oracle&quot;</span>)) {
<a name="l00490"></a>00490                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#a0d0de9f405aad359889c88121cad5ddf">IDO2DB_DBSERVER_ORACLE</a>;
<a name="l00491"></a>00491                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00492"></a>00492                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;sqlite&quot;</span>)) {
<a name="l00493"></a>00493                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#ad87af856abd328c61e755406e25b4063">IDO2DB_DBSERVER_SQLITE</a>;
<a name="l00494"></a>00494                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00495"></a>00495                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(val,<span class="stringliteral">&quot;sqlite3&quot;</span>)) {
<a name="l00496"></a>00496                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#a812dd4132c371ca56a9558f460bbefa0">IDO2DB_DBSERVER_SQLITE3</a>;
<a name="l00497"></a>00497                         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aeeac5fed41515564d98d853ae32afb56">dbserver</a>=strdup(val);
<a name="l00498"></a>00498                 } <span class="keywordflow">else</span>
<a name="l00499"></a>00499                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00500"></a>00500                 }
<a name="l00501"></a>00501         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_host&quot;</span>)){
<a name="l00502"></a>00502                 <span class="keywordflow">if</span>((ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad03d4afc3fabcd7dff9232177e744072">host</a>=strdup(val))==NULL)
<a name="l00503"></a>00503                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00504"></a>00504                 }
<a name="l00505"></a>00505         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_port&quot;</span>)){
<a name="l00506"></a>00506                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#abb9668584548c41f3731a474c15a9b17">port</a>=atoi(val);
<a name="l00507"></a>00507                 }
<a name="l00508"></a>00508         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_user&quot;</span>)){
<a name="l00509"></a>00509                 <span class="keywordflow">if</span>((ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aadac8aa3dfecc74e4ad80985cafedf53">username</a>=strdup(val))==NULL)
<a name="l00510"></a>00510                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00511"></a>00511                 }
<a name="l00512"></a>00512         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_pass&quot;</span>)){
<a name="l00513"></a>00513                 <span class="keywordflow">if</span>((ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad83b6cdac6497473cbccebce408bcac3">password</a>=strdup(val))==NULL)
<a name="l00514"></a>00514                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00515"></a>00515                 }
<a name="l00516"></a>00516         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_name&quot;</span>)){
<a name="l00517"></a>00517                 <span class="keywordflow">if</span>((ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aabf41f521f6984a22813970d66496a0b">dbname</a>=strdup(val))==NULL)
<a name="l00518"></a>00518                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00519"></a>00519                 }
<a name="l00520"></a>00520         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;db_prefix&quot;</span>)){
<a name="l00521"></a>00521                 <span class="keywordflow">if</span>((ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ae5e83b2066f85f1f9df6a261d5f17921">dbprefix</a>=strdup(val))==NULL)
<a name="l00522"></a>00522                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00523"></a>00523                 }
<a name="l00524"></a>00524         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_timedevents_age&quot;</span>))
<a name="l00525"></a>00525                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a5d1a9397e68b922f877d65441dbd418e">max_timedevents_age</a>=strtoul(val,NULL,0)*60;
<a name="l00526"></a>00526         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_systemcommands_age&quot;</span>))
<a name="l00527"></a>00527                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a98becbc71c6a3139d820d5522f1b7b6b">max_systemcommands_age</a>=strtoul(val,NULL,0)*60;
<a name="l00528"></a>00528         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_servicechecks_age&quot;</span>))
<a name="l00529"></a>00529                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#acb175cbd370be1e3146e0af345113466">max_servicechecks_age</a>=strtoul(val,NULL,0)*60;
<a name="l00530"></a>00530         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_hostchecks_age&quot;</span>))
<a name="l00531"></a>00531                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ada6f874e22499b5f14178cbb289d871e">max_hostchecks_age</a>=strtoul(val,NULL,0)*60;
<a name="l00532"></a>00532         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_eventhandlers_age&quot;</span>))
<a name="l00533"></a>00533                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a1a1e83211e55128977c75bbea43bf7f7">max_eventhandlers_age</a>=strtoul(val,NULL,0)*60;
<a name="l00534"></a>00534         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_externalcommands_age&quot;</span>))
<a name="l00535"></a>00535                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ac673ce7549c7783f4f200d2d1d9eb4d6">max_externalcommands_age</a>=strtoul(val,NULL,0)*60;
<a name="l00536"></a>00536         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_logentries_age&quot;</span>))
<a name="l00537"></a>00537                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a5a3708ec5deba1e4eb3d849ab1f28307">max_logentries_age</a>=strtoul(val,NULL,0)*60;
<a name="l00538"></a>00538         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_acknowledgements_age&quot;</span>))
<a name="l00539"></a>00539                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ab089bfb9d504871b6d2eb32a313b7620">max_acknowledgements_age</a>=strtoul(val,NULL,0)*60;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;trim_db_interval&quot;</span>))
<a name="l00542"></a>00542                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a7391940771863e08135a4c924d535a81">trim_db_interval</a>=strtoul(val,NULL,0);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;housekeeping_thread_startup_delay&quot;</span>))
<a name="l00545"></a>00545                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad79df68423cbb2c5887ab727f6a85341">housekeeping_thread_startup_delay</a>=strtoul(val,NULL,0);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((!strcmp(var,<span class="stringliteral">&quot;ido2db_user&quot;</span>))||(!strcmp(var,<span class="stringliteral">&quot;ido2db_user&quot;</span>)))
<a name="l00548"></a>00548                 <a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">ido2db_user</a>=strdup(val);
<a name="l00549"></a>00549         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((!strcmp(var,<span class="stringliteral">&quot;ido2db_group&quot;</span>))||(!strcmp(var,<span class="stringliteral">&quot;ido2db_group&quot;</span>)))
<a name="l00550"></a>00550                 <a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">ido2db_group</a>=strdup(val);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;debug_file&quot;</span>)){
<a name="l00553"></a>00553                 <span class="keywordflow">if</span>((<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>=strdup(val))==NULL)
<a name="l00554"></a>00554                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00555"></a>00555                 }
<a name="l00556"></a>00556         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;debug_level&quot;</span>))
<a name="l00557"></a>00557                 <a class="code" href="ido2db_8c.html#a8eba9fd4ad64e80e8f2e7a91a4f3d2d0">ido2db_debug_level</a>=atoi(val);
<a name="l00558"></a>00558         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;debug_verbosity&quot;</span>))
<a name="l00559"></a>00559                 <a class="code" href="ido2db_8c.html#ab58b27ab80d7038b4aed2731e24663ed">ido2db_debug_verbosity</a>=atoi(val);
<a name="l00560"></a>00560         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;max_debug_file_size&quot;</span>))
<a name="l00561"></a>00561                 <a class="code" href="ido2db_8c.html#aff7a69c074bd68f4f72fbdabe95dfaf9">ido2db_max_debug_file_size</a>=strtoul(val,NULL,0);
<a name="l00562"></a>00562         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;use_ssl&quot;</span>)){
<a name="l00563"></a>00563                 <span class="keywordflow">if</span> (strlen(val) == 1) {
<a name="l00564"></a>00564                         <span class="keywordflow">if</span> (isdigit((<span class="keywordtype">int</span>)val[strlen(val)-1]) != <a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>)
<a name="l00565"></a>00565                                 <a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a> = atoi(val);
<a name="l00566"></a>00566                         <span class="keywordflow">else</span>
<a name="l00567"></a>00567                                 <a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a> = 0;
<a name="l00568"></a>00568                 }
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var, <span class="stringliteral">&quot;clean_realtime_tables_on_core_startup&quot;</span>)) {
<a name="l00571"></a>00571                 <span class="keywordflow">if</span>(strlen(val)!=1||val[0]&lt;<span class="charliteral">&#39;0&#39;</span>||val[0]&gt;<span class="charliteral">&#39;1&#39;</span>){
<a name="l00572"></a>00572                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00573"></a>00573                 }
<a name="l00574"></a>00574                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a95f6f8f6b266e673191c7bfa7fb5d0af">clean_realtime_tables_on_core_startup</a>=(atoi(val)&gt;0)?<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>:<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var, <span class="stringliteral">&quot;clean_config_tables_on_core_startup&quot;</span>)) {
<a name="l00577"></a>00577                 <span class="keywordflow">if</span>(strlen(val)!=1||val[0]&lt;<span class="charliteral">&#39;0&#39;</span>||val[0]&gt;<span class="charliteral">&#39;1&#39;</span>){
<a name="l00578"></a>00578                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00579"></a>00579                 }
<a name="l00580"></a>00580                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad2081d64cc9071664dedce8742ad980a">clean_config_tables_on_core_startup</a>=(atoi(val)&gt;0)?<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>:<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00581"></a>00581         }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<span class="stringliteral">&quot;oci_errors_to_syslog&quot;</span>)){
<a name="l00584"></a>00584                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a58fc443560612c05f11967c3889b5a3f">oci_errors_to_syslog</a>=(atoi(val)&gt;0)?<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>:<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l00585"></a>00585         }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_process_config_var() end\n&quot;</span>);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 <span class="comment">/* initialize variables */</span>
<a name="l00594"></a><a class="code" href="ido2db_8c.html#abe3340868235fc4287bea47a538b30d9">00594</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#abe3340868235fc4287bea47a538b30d9">ido2db_initialize_variables</a>(<span class="keywordtype">void</span>){
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_initialize_variables() start\n&quot;</span>);
<a name="l00597"></a>00597 
<a name="l00598"></a>00598         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a92e2a8c64bdc73dd9009e145930a4592">server_type</a>=<a class="code" href="ido2db_8h.html#abbe50b533a13f418c5ffacbe19b2d47c">IDO2DB_DBSERVER_NONE</a>;
<a name="l00599"></a>00599         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad03d4afc3fabcd7dff9232177e744072">host</a>=NULL;
<a name="l00600"></a>00600         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#abb9668584548c41f3731a474c15a9b17">port</a>=0;
<a name="l00601"></a>00601         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aadac8aa3dfecc74e4ad80985cafedf53">username</a>=NULL;
<a name="l00602"></a>00602         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad83b6cdac6497473cbccebce408bcac3">password</a>=NULL;
<a name="l00603"></a>00603         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aabf41f521f6984a22813970d66496a0b">dbname</a>=NULL;
<a name="l00604"></a>00604         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ae5e83b2066f85f1f9df6a261d5f17921">dbprefix</a>=NULL;
<a name="l00605"></a>00605         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a5d1a9397e68b922f877d65441dbd418e">max_timedevents_age</a>=0L;
<a name="l00606"></a>00606         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a98becbc71c6a3139d820d5522f1b7b6b">max_systemcommands_age</a>=0L;
<a name="l00607"></a>00607         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#acb175cbd370be1e3146e0af345113466">max_servicechecks_age</a>=0L;
<a name="l00608"></a>00608         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ada6f874e22499b5f14178cbb289d871e">max_hostchecks_age</a>=0L;
<a name="l00609"></a>00609         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a1a1e83211e55128977c75bbea43bf7f7">max_eventhandlers_age</a>=0L;
<a name="l00610"></a>00610         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ac673ce7549c7783f4f200d2d1d9eb4d6">max_externalcommands_age</a>=0L;
<a name="l00611"></a>00611         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a5a3708ec5deba1e4eb3d849ab1f28307">max_logentries_age</a>=0L;
<a name="l00612"></a>00612         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ab089bfb9d504871b6d2eb32a313b7620">max_acknowledgements_age</a>=0L;
<a name="l00613"></a>00613         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a7391940771863e08135a4c924d535a81">trim_db_interval</a>=(<span class="keywordtype">unsigned</span> long)<a class="code" href="ido2db_8h.html#aeb99fefc675eea40f306f1f4084a0b45">DEFAULT_TRIM_DB_INTERVAL</a>; <span class="comment">/* set the default if missing in ido2db.cfg */</span>
<a name="l00614"></a>00614         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad79df68423cbb2c5887ab727f6a85341">housekeeping_thread_startup_delay</a>=(<span class="keywordtype">unsigned</span> long)<a class="code" href="ido2db_8h.html#a7b1898c7c4f8336479304cc4b827870b">DEFAULT_HOUSEKEEPING_THREAD_STARTUP_DELAY</a>; <span class="comment">/* set the default if missing in ido2db.cfg */</span>
<a name="l00615"></a>00615         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a95f6f8f6b266e673191c7bfa7fb5d0af">clean_realtime_tables_on_core_startup</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>; <span class="comment">/* default is cleaning on startup */</span>
<a name="l00616"></a>00616         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad2081d64cc9071664dedce8742ad980a">clean_config_tables_on_core_startup</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l00617"></a>00617         ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#a58fc443560612c05f11967c3889b5a3f">oci_errors_to_syslog</a>=<a class="code" href="ido2db_8h.html#a703bc322be4ccb6bd4155d485daeb285">DEFAULT_OCI_ERRORS_TO_SYSLOG</a>;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_initialize_variables() end\n&quot;</span>);
<a name="l00620"></a>00620         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="comment">/****************************************************************************/</span>
<a name="l00626"></a>00626 <span class="comment">/* CLEANUP FUNCTIONS                                                       */</span>
<a name="l00627"></a>00627 <span class="comment">/****************************************************************************/</span>
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 <span class="comment">/* free program memory */</span>
<a name="l00630"></a><a class="code" href="ido2db_8c.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">00630</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">ido2db_free_program_memory</a>(<span class="keywordtype">void</span>){
<a name="l00631"></a>00631 
<a name="l00632"></a>00632         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_free_program_memory() start\n&quot;</span>);
<a name="l00633"></a>00633 
<a name="l00634"></a>00634         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>){
<a name="l00635"></a>00635                 free(<a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>);
<a name="l00636"></a>00636                 <a class="code" href="ido2db_8c.html#ab22f928e5f6ed10f07e963fa69fea08d">ido2db_config_file</a>=NULL;
<a name="l00637"></a>00637                 }
<a name="l00638"></a>00638         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">ido2db_user</a>){
<a name="l00639"></a>00639                 free(<a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">ido2db_user</a>);
<a name="l00640"></a>00640                 <a class="code" href="ido2db_8c.html#a0e85febd10a687dab3e712e276b25b29">ido2db_user</a>=NULL;
<a name="l00641"></a>00641                 }
<a name="l00642"></a>00642         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">ido2db_group</a>){
<a name="l00643"></a>00643                 free(<a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">ido2db_group</a>);
<a name="l00644"></a>00644                 <a class="code" href="ido2db_8c.html#a1df09461e28cb02c1fed3ede21b648b7">ido2db_group</a>=NULL;
<a name="l00645"></a>00645                 }
<a name="l00646"></a>00646         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>){
<a name="l00647"></a>00647                 free(<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>);
<a name="l00648"></a>00648                 <a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>=NULL;
<a name="l00649"></a>00649                 }
<a name="l00650"></a>00650         <span class="keywordflow">if</span>(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad03d4afc3fabcd7dff9232177e744072">host</a>){
<a name="l00651"></a>00651                 free(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad03d4afc3fabcd7dff9232177e744072">host</a>);
<a name="l00652"></a>00652                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad03d4afc3fabcd7dff9232177e744072">host</a>=NULL;
<a name="l00653"></a>00653                 }
<a name="l00654"></a>00654         <span class="keywordflow">if</span>(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aadac8aa3dfecc74e4ad80985cafedf53">username</a>){
<a name="l00655"></a>00655                 free(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aadac8aa3dfecc74e4ad80985cafedf53">username</a>);
<a name="l00656"></a>00656                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aadac8aa3dfecc74e4ad80985cafedf53">username</a>=NULL;
<a name="l00657"></a>00657                 }
<a name="l00658"></a>00658         <span class="keywordflow">if</span>(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad83b6cdac6497473cbccebce408bcac3">password</a>){
<a name="l00659"></a>00659                 free(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad83b6cdac6497473cbccebce408bcac3">password</a>);
<a name="l00660"></a>00660                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad83b6cdac6497473cbccebce408bcac3">password</a>=NULL;
<a name="l00661"></a>00661                 }
<a name="l00662"></a>00662         <span class="keywordflow">if</span>(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aabf41f521f6984a22813970d66496a0b">dbname</a>){
<a name="l00663"></a>00663                 free(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aabf41f521f6984a22813970d66496a0b">dbname</a>);
<a name="l00664"></a>00664                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#aabf41f521f6984a22813970d66496a0b">dbname</a>=NULL;
<a name="l00665"></a>00665                 }
<a name="l00666"></a>00666         <span class="keywordflow">if</span>(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ae5e83b2066f85f1f9df6a261d5f17921">dbprefix</a>){
<a name="l00667"></a>00667                 free(ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ae5e83b2066f85f1f9df6a261d5f17921">dbprefix</a>);
<a name="l00668"></a>00668                 ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ae5e83b2066f85f1f9df6a261d5f17921">dbprefix</a>=NULL;
<a name="l00669"></a>00669                 }
<a name="l00670"></a>00670         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>){
<a name="l00671"></a>00671                 free(<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>);
<a name="l00672"></a>00672                 <a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>=NULL;
<a name="l00673"></a>00673                 }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_free_program_memory() end\n&quot;</span>);
<a name="l00676"></a>00676         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00677"></a>00677         }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 <span class="comment">/****************************************************************************/</span>
<a name="l00682"></a>00682 <span class="comment">/* UTILITY FUNCTIONS                                                        */</span>
<a name="l00683"></a>00683 <span class="comment">/****************************************************************************/</span>
<a name="l00684"></a>00684 
<a name="l00685"></a><a class="code" href="ido2db_8c.html#a4dcf53a8a4f6eaa24974641ffe33e8c3">00685</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a4dcf53a8a4f6eaa24974641ffe33e8c3">ido2db_check_init_reqs</a>(<span class="keywordtype">void</span>){
<a name="l00686"></a>00686 
<a name="l00687"></a>00687         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_check_init_reqs() start\n&quot;</span>);
<a name="l00688"></a>00688 
<a name="l00689"></a>00689         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>==<a class="code" href="io_8h.html#a607ea9f9be1d29bfce180bee814534f3">IDO_SINK_UNIXSOCKET</a>){
<a name="l00690"></a>00690                 <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>==NULL){
<a name="l00691"></a>00691                         printf(<span class="stringliteral">&quot;No socket name specified.\n&quot;</span>);
<a name="l00692"></a>00692                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00693"></a>00693                         }
<a name="l00694"></a>00694                 }
<a name="l00695"></a>00695         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_check_init_reqs() end\n&quot;</span>);
<a name="l00696"></a>00696         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="comment">/* drops privileges */</span>
<a name="l00702"></a><a class="code" href="ido2db_8c.html#a5e54349157e5d42d3a630723913eea29">00702</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a18ba617fb4b4fc0fa8981f3f6b8166a2">ido2db_drop_privileges</a>(<span class="keywordtype">char</span> *user, <span class="keywordtype">char</span> *group){
<a name="l00703"></a>00703         uid_t uid=-1;
<a name="l00704"></a>00704         gid_t gid=-1;
<a name="l00705"></a>00705         <span class="keyword">struct </span>group *grp;
<a name="l00706"></a>00706         <span class="keyword">struct </span>passwd *pw;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_drop_privileges() start\n&quot;</span>);
<a name="l00709"></a>00709 
<a name="l00710"></a>00710         <span class="comment">/* set effective group ID */</span>
<a name="l00711"></a>00711         <span class="keywordflow">if</span>(group!=NULL){
<a name="l00712"></a>00712 
<a name="l00713"></a>00713                 <span class="comment">/* see if this is a group name */</span>
<a name="l00714"></a>00714                 <span class="keywordflow">if</span>(strspn(group,<span class="stringliteral">&quot;0123456789&quot;</span>)&lt;strlen(group)){
<a name="l00715"></a>00715                         grp=(<span class="keyword">struct </span>group *)getgrnam(group);
<a name="l00716"></a>00716                         <span class="keywordflow">if</span>(grp!=NULL)
<a name="l00717"></a>00717                                 gid=(gid_t)(grp-&gt;gr_gid);
<a name="l00718"></a>00718                         <span class="keywordflow">else</span>
<a name="l00719"></a>00719                                 syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: Could not get group entry for &#39;%s&#39;&quot;</span>,group);
<a name="l00720"></a>00720                         endgrent();
<a name="l00721"></a>00721                         }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723                 <span class="comment">/* else we were passed the GID */</span>
<a name="l00724"></a>00724                 <span class="keywordflow">else</span>
<a name="l00725"></a>00725                         gid=(gid_t)atoi(group);
<a name="l00726"></a>00726 
<a name="l00727"></a>00727                 <span class="comment">/* set effective group ID if other than current EGID */</span>
<a name="l00728"></a>00728                 <span class="keywordflow">if</span>(gid!=getegid()){
<a name="l00729"></a>00729 
<a name="l00730"></a>00730                         <span class="keywordflow">if</span>(setgid(gid)==-1)
<a name="l00731"></a>00731                                 syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: Could not set effective GID=%d&quot;</span>,(<span class="keywordtype">int</span>)gid);
<a name="l00732"></a>00732                         }
<a name="l00733"></a>00733                 }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 
<a name="l00736"></a>00736         <span class="comment">/* set effective user ID */</span>
<a name="l00737"></a>00737         <span class="keywordflow">if</span>(user!=NULL){
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                 <span class="comment">/* see if this is a user name */</span>
<a name="l00740"></a>00740                 <span class="keywordflow">if</span>(strspn(user,<span class="stringliteral">&quot;0123456789&quot;</span>)&lt;strlen(user)){
<a name="l00741"></a>00741                         pw=(<span class="keyword">struct </span>passwd *)getpwnam(user);
<a name="l00742"></a>00742                         <span class="keywordflow">if</span>(pw!=NULL)
<a name="l00743"></a>00743                                 uid=(uid_t)(pw-&gt;pw_uid);
<a name="l00744"></a>00744                         <span class="keywordflow">else</span>
<a name="l00745"></a>00745                                 syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: Could not get passwd entry for &#39;%s&#39;&quot;</span>,user);
<a name="l00746"></a>00746                         endpwent();
<a name="l00747"></a>00747                         }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749                 <span class="comment">/* else we were passed the UID */</span>
<a name="l00750"></a>00750                 <span class="keywordflow">else</span>
<a name="l00751"></a>00751                         uid=(uid_t)atoi(user);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753                 <span class="comment">/* set effective user ID if other than current EUID */</span>
<a name="l00754"></a>00754                 <span class="keywordflow">if</span>(uid!=geteuid()){
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 <span class="preprocessor">#ifdef HAVE_INITGROUPS</span>
<a name="l00757"></a>00757 <span class="preprocessor"></span>                        <span class="comment">/* initialize supplementary groups */</span>
<a name="l00758"></a>00758                         <span class="keywordflow">if</span>(initgroups(user,gid)==-1){
<a name="l00759"></a>00759                                 <span class="keywordflow">if</span>(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==EPERM)
<a name="l00760"></a>00760                                         syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: Unable to change supplementary groups using initgroups()&quot;</span>);
<a name="l00761"></a>00761                                 <span class="keywordflow">else</span>{
<a name="l00762"></a>00762                                         syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: Possibly root user failed dropping privileges with initgroups()&quot;</span>);
<a name="l00763"></a>00763                                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00764"></a>00764                                         }
<a name="l00765"></a>00765                                 }
<a name="l00766"></a>00766 <span class="preprocessor">#endif</span>
<a name="l00767"></a>00767 <span class="preprocessor"></span>
<a name="l00768"></a>00768                         <span class="keywordflow">if</span>(setuid(uid)==-1)
<a name="l00769"></a>00769                                 syslog(LOG_ERR,<span class="stringliteral">&quot;Warning: Could not set effective UID=%d&quot;</span>,(<span class="keywordtype">int</span>)uid);
<a name="l00770"></a>00770                         }
<a name="l00771"></a>00771                 }
<a name="l00772"></a>00772         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_drop_privileges() end\n&quot;</span>);
<a name="l00773"></a>00773         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00774"></a>00774         }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 
<a name="l00777"></a><a class="code" href="ido2db_8c.html#ae73828bd7a8365222a330c20aef6f2a1">00777</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ae73828bd7a8365222a330c20aef6f2a1">ido2db_daemonize</a>(<span class="keywordtype">void</span>){
<a name="l00778"></a>00778         pid_t pid=-1;
<a name="l00779"></a>00779         <span class="comment">/* int pidno=0; */</span>
<a name="l00780"></a>00780         <span class="keywordtype">int</span> lockfile=0;
<a name="l00781"></a>00781         <span class="keyword">struct </span>flock lock;
<a name="l00782"></a>00782         <span class="keywordtype">int</span> val=0;
<a name="l00783"></a>00783         <span class="keywordtype">char</span> buf[256];
<a name="l00784"></a>00784         <span class="keywordtype">char</span> *msg=NULL;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() start\n&quot;</span>);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788         umask(S_IWGRP|S_IWOTH);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790         <span class="comment">/* get a lock on the lockfile */</span>
<a name="l00791"></a>00791         <span class="keywordflow">if</span>(<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>){
<a name="l00792"></a>00792                 lockfile=open(<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>,O_RDWR | O_CREAT, S_IWUSR | S_IRUSR | S_IRGRP | S_IROTH);
<a name="l00793"></a>00793                 <span class="keywordflow">if</span>(lockfile&lt;0){
<a name="l00794"></a>00794                         <span class="keywordflow">if</span>(<a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">asprintf</a>(&amp;msg,<span class="stringliteral">&quot;Failed to obtain lock on file %s: %s\n&quot;</span>, <a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>, strerror(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>))==-1)
<a name="l00795"></a>00795                                 msg=NULL;
<a name="l00796"></a>00796                         perror(msg);
<a name="l00797"></a>00797                         <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00798"></a>00798                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00799"></a>00799                         }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801                 <span class="comment">/* see if we can read the contents of the lockfile */</span>
<a name="l00802"></a>00802                 <span class="keywordflow">if</span>((val=read(lockfile,buf,(<span class="keywordtype">size_t</span>)10))&lt;0){
<a name="l00803"></a>00803                         <span class="keywordflow">if</span>(<a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">asprintf</a>(&amp;msg,<span class="stringliteral">&quot;Lockfile exists but cannot be read&quot;</span>)==-1)
<a name="l00804"></a>00804                                 msg=NULL;
<a name="l00805"></a>00805                         perror(msg);
<a name="l00806"></a>00806                         <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00807"></a>00807                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00808"></a>00808                         }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810                 <span class="comment">/* place a file lock on the lock file */</span>
<a name="l00811"></a>00811                 lock.l_type=F_WRLCK;
<a name="l00812"></a>00812                 lock.l_start=0;
<a name="l00813"></a>00813                 lock.l_whence=SEEK_SET;
<a name="l00814"></a>00814                 lock.l_len=0;
<a name="l00815"></a>00815                 <span class="keywordflow">if</span>(fcntl(lockfile,F_SETLK,&amp;lock)&lt;0){
<a name="l00816"></a>00816                         <span class="keywordflow">if</span>(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==EACCES || <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==EAGAIN){
<a name="l00817"></a>00817                                 fcntl(lockfile,F_GETLK,&amp;lock);
<a name="l00818"></a>00818                                 <span class="keywordflow">if</span>(<a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">asprintf</a>(&amp;msg,<span class="stringliteral">&quot;Lockfile &#39;%s&#39; looks like its already held by another instance (%d).  Bailing out...&quot;</span>,<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>,(<span class="keywordtype">int</span>)lock.l_pid)==-1)
<a name="l00819"></a>00819                                         msg=NULL;
<a name="l00820"></a>00820                         }
<a name="l00821"></a>00821                         <span class="keywordflow">else</span>  {
<a name="l00822"></a>00822                                 <span class="keywordflow">if</span>(<a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">asprintf</a>(&amp;msg,<span class="stringliteral">&quot;Cannot lock lockfile &#39;%s&#39;: %s. Bailing out...&quot;</span>,<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>,strerror(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>))==-1)
<a name="l00823"></a>00823                                         msg=NULL;
<a name="l00824"></a>00824                         }
<a name="l00825"></a>00825                         perror(msg);
<a name="l00826"></a>00826                         <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00827"></a>00827                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00828"></a>00828                         }
<a name="l00829"></a>00829                 }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="comment">/* fork */</span>
<a name="l00832"></a>00832         <span class="keywordflow">if</span>((pid=fork())&lt;0){
<a name="l00833"></a>00833                 perror(<span class="stringliteral">&quot;Fork error&quot;</span>);
<a name="l00834"></a>00834                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() parent fork error\n&quot;</span>);
<a name="l00835"></a>00835                 <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00836"></a>00836                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00837"></a>00837                 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839         <span class="comment">/* parent process goes away... */</span>
<a name="l00840"></a>00840         <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)pid!=0){
<a name="l00841"></a>00841                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() parent process goes away\n&quot;</span>);
<a name="l00842"></a>00842                 <a class="code" href="ido2db_8h.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">ido2db_free_program_memory</a>();
<a name="l00843"></a>00843                 exit(0);
<a name="l00844"></a>00844                 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846         <span class="comment">/* child forks again... */</span>
<a name="l00847"></a>00847         <span class="keywordflow">else</span>{
<a name="l00848"></a>00848                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() child forks again\n&quot;</span>);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850                 <span class="keywordflow">if</span>((pid=fork())&lt;0){
<a name="l00851"></a>00851                         perror(<span class="stringliteral">&quot;Fork error&quot;</span>);
<a name="l00852"></a>00852                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() child fork error\n&quot;</span>);
<a name="l00853"></a>00853                         <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00854"></a>00854                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l00855"></a>00855                         }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857                 <span class="comment">/* first child process goes away.. */</span>
<a name="l00858"></a>00858                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)pid!=0){
<a name="l00859"></a>00859                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() first child process goes away\n&quot;</span>);
<a name="l00860"></a>00860                         <a class="code" href="ido2db_8h.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">ido2db_free_program_memory</a>();
<a name="l00861"></a>00861                         exit(0);
<a name="l00862"></a>00862                         }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864                 <span class="comment">/* grandchild continues... */</span>
<a name="l00865"></a>00865                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() grandchild continues and  becomes session leader\n&quot;</span>);
<a name="l00866"></a>00866                 <span class="comment">/* grandchild becomes session leader... */</span>
<a name="l00867"></a>00867                 setsid();
<a name="l00868"></a>00868                 }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870         <span class="keywordflow">if</span>(<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>){
<a name="l00871"></a>00871                 <span class="comment">/* write PID to lockfile... */</span>
<a name="l00872"></a>00872                 lseek(lockfile,0,SEEK_SET);
<a name="l00873"></a>00873                 dummy=ftruncate(lockfile,0);
<a name="l00874"></a>00874                 sprintf(buf,<span class="stringliteral">&quot;%d\n&quot;</span>,(<span class="keywordtype">int</span>)getpid());
<a name="l00875"></a>00875                 dummy=write(lockfile,buf,strlen(buf));
<a name="l00876"></a>00876 
<a name="l00877"></a>00877                 <span class="comment">/* make sure lock file stays open while program is executing... */</span>
<a name="l00878"></a>00878                 val=fcntl(lockfile,F_GETFD,0);
<a name="l00879"></a>00879                 val|=FD_CLOEXEC;
<a name="l00880"></a>00880                 fcntl(lockfile,F_SETFD,val);
<a name="l00881"></a>00881                 }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883         <span class="comment">/* close existing stdin, stdout, stderr */</span>
<a name="l00884"></a>00884         close(0);
<a name="l00885"></a>00885         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a> == <a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>)
<a name="l00886"></a>00886                 close(1);
<a name="l00887"></a>00887         close(2);
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="comment">/* re-open stdin, stdout, stderr with known values */</span>
<a name="l00890"></a>00890         open(<span class="stringliteral">&quot;/dev/null&quot;</span>,O_RDONLY);
<a name="l00891"></a>00891         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a> == <a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>)
<a name="l00892"></a>00892                 open(<span class="stringliteral">&quot;/dev/null&quot;</span>,O_WRONLY);
<a name="l00893"></a>00893         open(<span class="stringliteral">&quot;/dev/null&quot;</span>,O_WRONLY);
<a name="l00894"></a>00894 
<a name="l00895"></a>00895         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_daemonize() end\n&quot;</span>);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00898"></a>00898         }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 
<a name="l00901"></a><a class="code" href="ido2db_8c.html#a4f80ddc0f869f3f0f35aea3eb012de9c">00901</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>(<span class="keywordtype">void</span>){
<a name="l00902"></a>00902 
<a name="l00903"></a>00903         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_cleanup_socket() start\n&quot;</span>);
<a name="l00904"></a>00904 
<a name="l00905"></a>00905         <span class="comment">/* we&#39;re running under INETD */</span>
<a name="l00906"></a>00906         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af172d681af5dfa9bda499a4bf35ed63d">ido2db_use_inetd</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>)
<a name="l00907"></a>00907                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00908"></a>00908 
<a name="l00909"></a>00909         <span class="comment">/* close the socket */</span>
<a name="l00910"></a>00910         shutdown(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>,2);
<a name="l00911"></a>00911         close(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>);
<a name="l00912"></a>00912 
<a name="l00913"></a>00913         <span class="comment">/* unlink the file */</span>
<a name="l00914"></a>00914         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>==<a class="code" href="io_8h.html#a607ea9f9be1d29bfce180bee814534f3">IDO_SINK_UNIXSOCKET</a>)
<a name="l00915"></a>00915                 unlink(<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917         <span class="keywordflow">if</span>(<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>)
<a name="l00918"></a>00918                 unlink(<a class="code" href="base_2config_8c.html#a55d7cb41b1bacf3965ecc3592b0502fa">lock_file</a>);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_cleanup_socket() end\n&quot;</span>);
<a name="l00921"></a>00921         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l00922"></a>00922         }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 
<a name="l00925"></a><a class="code" href="ido2db_8c.html#a2b228f210f36b47f252e852cd49622ac">00925</a> <span class="keywordtype">void</span> <a class="code" href="ido2db_8h.html#a42e2172f45b5c08748b1178eac984490">ido2db_parent_sighandler</a>(<span class="keywordtype">int</span> sig){
<a name="l00926"></a>00926 
<a name="l00927"></a>00927         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_parent_sighandler() start\n&quot;</span>);
<a name="l00928"></a>00928         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;processing signal &#39;%d&#39;\n&quot;</span>, sig);
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         <span class="comment">/* not possible as parent */</span>
<a name="l00931"></a>00931         <span class="comment">/* syslog(LOG_USER | LOG_INFO, &quot;Processing SIG%s...\n&quot;, sigs[sig]); */</span>
<a name="l00932"></a>00932 
<a name="l00933"></a>00933         <span class="keywordflow">switch</span> (sig){
<a name="l00934"></a>00934         <span class="keywordflow">case</span> SIGTERM:
<a name="l00935"></a>00935         <span class="keywordflow">case</span> SIGINT:
<a name="l00936"></a>00936                 <span class="comment">/* forward signal to all members of this group of processes */</span>
<a name="l00937"></a>00937                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;forward signal to all members of this group of processes\n&quot;</span>);
<a name="l00938"></a>00938                 kill(0, sig);
<a name="l00939"></a>00939                 <span class="keywordflow">break</span>;
<a name="l00940"></a>00940         <span class="keywordflow">case</span> SIGCHLD:
<a name="l00941"></a>00941                 <span class="comment">/* cleanup children that exit, so we don&#39;t have zombies */</span>
<a name="l00942"></a>00942                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;cleanup children that exit, so we don&#39;t have zombies\n&quot;</span>);
<a name="l00943"></a>00943                 <span class="keywordflow">while</span>(waitpid(-1,NULL,WNOHANG)&gt;0);
<a name="l00944"></a>00944                 <span class="keywordflow">return</span>;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         <span class="keywordflow">default</span>:
<a name="l00947"></a>00947                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 0, <span class="stringliteral">&quot;Caught the Signal &#39;%d&#39; but don&#39;t care about this.\n&quot;</span>, sig);
<a name="l00948"></a>00948         }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950         <span class="comment">/* cleanup the socket */</span>
<a name="l00951"></a>00951         <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00952"></a>00952 
<a name="l00953"></a>00953         <span class="comment">/* free memory */</span>
<a name="l00954"></a>00954         <a class="code" href="ido2db_8h.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">ido2db_free_program_memory</a>();
<a name="l00955"></a>00955 
<a name="l00956"></a>00956         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_parent_sighandler() end\n&quot;</span>);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958         exit(0);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960         <span class="keywordflow">return</span>;
<a name="l00961"></a>00961         }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 
<a name="l00964"></a><a class="code" href="ido2db_8c.html#a0cc7c3854d7c6c3bbd1d75031db08c6b">00964</a> <span class="keywordtype">void</span> <a class="code" href="ido2db_8h.html#ad4935b6ff0f26364fc23b1a046e7adfa">ido2db_child_sighandler</a>(<span class="keywordtype">int</span> sig){
<a name="l00965"></a>00965 
<a name="l00966"></a>00966         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_child_sighandler() start\n&quot;</span>);
<a name="l00967"></a>00967         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;Child caught signal &#39;%d&#39; exiting\n&quot;</span>, sig);
<a name="l00968"></a>00968         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_child_sighandler() end\n&quot;</span>);
<a name="l00969"></a>00969 
<a name="l00970"></a>00970         <span class="comment">/* don&#39;t run into a race condition */</span>
<a name="l00971"></a>00971         <span class="comment">//syslog(LOG_USER | LOG_INFO, &quot;Caught SIG%s, cleaning up and exiting...\n&quot;, sigs[sig]);</span>
<a name="l00972"></a>00972 
<a name="l00973"></a>00973         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a> == <a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l00974"></a>00974                 <span class="comment">/* cleanup the socket */</span>
<a name="l00975"></a>00975                 <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l00976"></a>00976 
<a name="l00977"></a>00977                 <span class="comment">/* free memory */</span>
<a name="l00978"></a>00978                 <a class="code" href="ido2db_8h.html#a03fc2cfd8ac8eaa50ca06d22adbd7336">ido2db_free_program_memory</a>();
<a name="l00979"></a>00979         }
<a name="l00980"></a>00980 
<a name="l00981"></a>00981         <a class="code" href="ido2db_8h.html#a2736c793ca4023019d32b38245cafce5">ido2db_kill_threads</a>();
<a name="l00982"></a>00982 
<a name="l00983"></a>00983         _exit(0);
<a name="l00984"></a>00984 
<a name="l00985"></a>00985         <span class="keywordflow">return</span>;
<a name="l00986"></a>00986         }
<a name="l00987"></a>00987 
<a name="l00988"></a>00988 
<a name="l00989"></a>00989 <span class="comment">/****************************************************************************/</span>
<a name="l00990"></a>00990 <span class="comment">/* UTILITY FUNCTIONS                                                        */</span>
<a name="l00991"></a>00991 <span class="comment">/****************************************************************************/</span>
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 
<a name="l00994"></a><a class="code" href="ido2db_8c.html#aaa5047944a02bf110d06e511fb877b98">00994</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#aaa5047944a02bf110d06e511fb877b98">ido2db_wait_for_connections</a>(<span class="keywordtype">void</span>){
<a name="l00995"></a>00995         <span class="keywordtype">int</span> sd_flag=1;
<a name="l00996"></a>00996         <span class="keywordtype">int</span> new_sd=0;
<a name="l00997"></a>00997         pid_t new_pid=-1;
<a name="l00998"></a>00998         <span class="keyword">struct </span>sockaddr_un server_address_u;
<a name="l00999"></a>00999         <span class="keyword">struct </span>sockaddr_in server_address_i;
<a name="l01000"></a>01000         <span class="keyword">struct </span>sockaddr_un client_address_u;
<a name="l01001"></a>01001         <span class="keyword">struct </span>sockaddr_in client_address_i;
<a name="l01002"></a>01002         socklen_t client_address_length;
<a name="l01003"></a>01003 
<a name="l01004"></a>01004         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_wait_for_connections() start\n&quot;</span>);
<a name="l01005"></a>01005 
<a name="l01006"></a>01006         <span class="comment">/* TCP socket */</span>
<a name="l01007"></a>01007         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>==<a class="code" href="io_8h.html#a55998c4058fa96daf21dc2ef39120d39">IDO_SINK_TCPSOCKET</a>){
<a name="l01008"></a>01008 
<a name="l01009"></a>01009                 <span class="comment">/* create a socket */</span>
<a name="l01010"></a>01010                 <span class="keywordflow">if</span>(!(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>=socket(PF_INET,SOCK_STREAM,0))){
<a name="l01011"></a>01011                         perror(<span class="stringliteral">&quot;Cannot create socket&quot;</span>);
<a name="l01012"></a>01012                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01013"></a>01013                         }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015                 <span class="comment">/* set the reuse address flag so we don&#39;t get errors when restarting */</span>
<a name="l01016"></a>01016                 sd_flag=1;
<a name="l01017"></a>01017                 <span class="keywordflow">if</span>(setsockopt(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>,SOL_SOCKET,SO_REUSEADDR,(<span class="keywordtype">char</span> *)&amp;sd_flag,<span class="keyword">sizeof</span>(sd_flag))&lt;0){
<a name="l01018"></a>01018                         printf(<span class="stringliteral">&quot;Could not set reuse address option on socket!\n&quot;</span>);
<a name="l01019"></a>01019                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01020"></a>01020                         }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022                 <span class="comment">/* clear the address */</span>
<a name="l01023"></a>01023                 bzero((<span class="keywordtype">char</span> *)&amp;server_address_i,<span class="keyword">sizeof</span>(server_address_i));
<a name="l01024"></a>01024                 server_address_i.sin_family=AF_INET;
<a name="l01025"></a>01025                 server_address_i.sin_addr.s_addr=INADDR_ANY;
<a name="l01026"></a>01026                 server_address_i.sin_port=htons(<a class="code" href="ido2db_8c.html#a2c74da3682e346aea9309a83b6ff5807">ido2db_tcp_port</a>);
<a name="l01027"></a>01027 
<a name="l01028"></a>01028                 <span class="comment">/* bind the socket */</span>
<a name="l01029"></a>01029                 <span class="keywordflow">if</span>((bind(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>,(<span class="keyword">struct</span> sockaddr *)&amp;server_address_i,<span class="keyword">sizeof</span>(server_address_i)))){
<a name="l01030"></a>01030                         close(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>);
<a name="l01031"></a>01031                         perror(<span class="stringliteral">&quot;Could not bind socket&quot;</span>);
<a name="l01032"></a>01032                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01033"></a>01033                         }
<a name="l01034"></a>01034 
<a name="l01035"></a>01035                 client_address_length=(socklen_t)<span class="keyword">sizeof</span>(client_address_i);
<a name="l01036"></a>01036                 }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038         <span class="comment">/* UNIX domain socket */</span>
<a name="l01039"></a>01039         <span class="keywordflow">else</span>{
<a name="l01040"></a>01040 
<a name="l01041"></a>01041                 <span class="comment">/* create a socket */</span>
<a name="l01042"></a>01042                 <span class="keywordflow">if</span>(!(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>=socket(AF_UNIX,SOCK_STREAM,0))){
<a name="l01043"></a>01043                         perror(<span class="stringliteral">&quot;Cannot create socket&quot;</span>);
<a name="l01044"></a>01044                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01045"></a>01045                         }
<a name="l01046"></a>01046 
<a name="l01047"></a>01047                 <span class="comment">/* copy the socket path */</span>
<a name="l01048"></a>01048                 strncpy(server_address_u.sun_path,<a class="code" href="ido2db_8c.html#aa3cd9f2db9baab7e9b0c76ed9288382b">ido2db_socket_name</a>,<span class="keyword">sizeof</span>(server_address_u.sun_path));
<a name="l01049"></a>01049                 server_address_u.sun_family=AF_UNIX;
<a name="l01050"></a>01050 
<a name="l01051"></a>01051                 <span class="comment">/* bind the socket */</span>
<a name="l01052"></a>01052                 <span class="keywordflow">if</span>((bind(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>,(<span class="keyword">struct</span> sockaddr *)&amp;server_address_u,<a class="code" href="io_8h.html#acccb2b570ccf4e9d1169635babf16b13">SUN_LEN</a>(&amp;server_address_u)))){
<a name="l01053"></a>01053                         close(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>);
<a name="l01054"></a>01054                         perror(<span class="stringliteral">&quot;Could not bind socket&quot;</span>);
<a name="l01055"></a>01055                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01056"></a>01056                         }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058                 client_address_length=(socklen_t)<span class="keyword">sizeof</span>(client_address_u);
<a name="l01059"></a>01059                 }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061         <span class="comment">/* listen for connections */</span>
<a name="l01062"></a>01062         <span class="keywordflow">if</span>((listen(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>,1))){
<a name="l01063"></a>01063                 perror(<span class="stringliteral">&quot;Cannot listen on socket&quot;</span>);
<a name="l01064"></a>01064                 <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l01065"></a>01065                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01066"></a>01066                 }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <span class="comment">/* daemonize */</span>
<a name="l01070"></a>01070         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a> == <a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>) {
<a name="l01071"></a>01071                 <span class="keywordflow">if</span>(<a class="code" href="ido2db_8h.html#ae73828bd7a8365222a330c20aef6f2a1">ido2db_daemonize</a>()!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>)
<a name="l01072"></a>01072                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01073"></a>01073                 syslog(LOG_USER | LOG_INFO, <span class="stringliteral">&quot;Finished daemonizing... (New PID=%d)\n&quot;</span>,(<span class="keywordtype">int</span>)getpid());
<a name="l01074"></a>01074         }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076         <span class="comment">/* accept connections... */</span>
<a name="l01077"></a>01077         <span class="keywordflow">while</span>(1){
<a name="l01078"></a>01078 
<a name="l01079"></a>01079                 <span class="keywordflow">while</span>(1){
<a name="l01080"></a>01080 
<a name="l01081"></a>01081                         new_sd=accept(<a class="code" href="ido2db_8c.html#aadbd50380c906a27ab1cf881f8cc445c">ido2db_sd</a>,(<a class="code" href="ido2db_8c.html#a21e722cdd92e9bfc9503a70aa720a7d2">ido2db_socket_type</a>==<a class="code" href="io_8h.html#a55998c4058fa96daf21dc2ef39120d39">IDO_SINK_TCPSOCKET</a>)?(<span class="keyword">struct</span> sockaddr *)&amp;client_address_i:(<span class="keyword">struct</span> sockaddr *)&amp;client_address_u,(socklen_t *)&amp;client_address_length);
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 
<a name="l01084"></a>01084                         <span class="comment">/* ToDo:  Hendrik 08/12/2009</span>
<a name="l01085"></a>01085 <span class="comment">                         * If both ends think differently about SSL encryption, data from a idomod will</span>
<a name="l01086"></a>01086 <span class="comment">                         * be lost forever (likewise on database errors/misconfiguration)</span>
<a name="l01087"></a>01087 <span class="comment">                         * This seems a good place to output some information from which client</span>
<a name="l01088"></a>01088 <span class="comment">                         * a possible misconfiguration comes from.</span>
<a name="l01089"></a>01089 <span class="comment">                         * Logging the ip address together with the idomod instance name might be</span>
<a name="l01090"></a>01090 <span class="comment">                         * a great hint for further error hunting</span>
<a name="l01091"></a>01091 <span class="comment">                         */</span>
<a name="l01092"></a>01092 
<a name="l01093"></a>01093                         <span class="keywordflow">if</span>(new_sd&gt;=0)
<a name="l01094"></a>01094                                 <span class="comment">/* data available */</span>
<a name="l01095"></a>01095                                 syslog(LOG_USER | LOG_INFO, <span class="stringliteral">&quot;Client connected, data available.\n&quot;</span>);
<a name="l01096"></a>01096                                 <span class="keywordflow">break</span>;
<a name="l01097"></a>01097                         <span class="keywordflow">if</span>(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == EINTR) {
<a name="l01098"></a>01098                                 <span class="comment">/* continue */</span>
<a name="l01099"></a>01099                         }
<a name="l01100"></a>01100                         <span class="keywordflow">else</span> {
<a name="l01101"></a>01101                                 perror(<span class="stringliteral">&quot;Accept error&quot;</span>);
<a name="l01102"></a>01102                                 <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l01103"></a>01103                                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01104"></a>01104                         }
<a name="l01105"></a>01105                 }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107                 <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#aa48a9822fc8c1d210aa53c9952aef401">ido2db_run_foreground</a> == <a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>) {
<a name="l01108"></a>01108                         <span class="comment">/* fork... */</span>
<a name="l01109"></a>01109                         new_pid=fork();
<a name="l01110"></a>01110 
<a name="l01111"></a>01111                         <span class="keywordflow">switch</span>(new_pid){
<a name="l01112"></a>01112                         <span class="keywordflow">case</span> -1:
<a name="l01113"></a>01113                                 <span class="comment">/* parent simply prints an error message and keeps on going... */</span>
<a name="l01114"></a>01114                                 perror(<span class="stringliteral">&quot;Fork error&quot;</span>);
<a name="l01115"></a>01115                                 close(new_sd);
<a name="l01116"></a>01116                                 <span class="keywordflow">break</span>;
<a name="l01117"></a>01117 
<a name="l01118"></a>01118                         <span class="keywordflow">case</span> 0:
<a name="l01119"></a>01119                                 <span class="comment">/* child processes data... */</span>
<a name="l01120"></a>01120                                 <a class="code" href="ido2db_8h.html#ad8670e8992b6bff3724859a95c47cb9a">ido2db_handle_client_connection</a>(new_sd);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122                                 <span class="comment">/* close socket when we&#39;re done */</span>
<a name="l01123"></a>01123                                 close(new_sd);
<a name="l01124"></a>01124                                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01125"></a>01125                                 <span class="keywordflow">break</span>;
<a name="l01126"></a>01126 
<a name="l01127"></a>01127                         <span class="keywordflow">default</span>:
<a name="l01128"></a>01128                                 <span class="comment">/* parent keeps on going... */</span>
<a name="l01129"></a>01129                                 close(new_sd);
<a name="l01130"></a>01130                                 <span class="keywordflow">break</span>;
<a name="l01131"></a>01131                         }
<a name="l01132"></a>01132                 }
<a name="l01133"></a>01133                 <span class="keywordflow">else</span>{
<a name="l01134"></a>01134                         <span class="comment">/* child processes data... */</span>
<a name="l01135"></a>01135                         <a class="code" href="ido2db_8h.html#ad8670e8992b6bff3724859a95c47cb9a">ido2db_handle_client_connection</a>(new_sd);
<a name="l01136"></a>01136 
<a name="l01137"></a>01137                         <span class="comment">/* close socket when we&#39;re done */</span>
<a name="l01138"></a>01138                         close(new_sd);
<a name="l01139"></a>01139                 }
<a name="l01140"></a>01140 
<a name="l01141"></a>01141 <span class="preprocessor">#ifdef DEBUG_IDO2DB_EXIT_AFTER_CONNECTION</span>
<a name="l01142"></a>01142 <span class="preprocessor"></span>                <span class="keywordflow">break</span>;
<a name="l01143"></a>01143 <span class="preprocessor">#endif</span>
<a name="l01144"></a>01144 <span class="preprocessor"></span>                }
<a name="l01145"></a>01145 
<a name="l01146"></a>01146         <span class="comment">/* cleanup after ourselves */</span>
<a name="l01147"></a>01147         <a class="code" href="ido2db_8h.html#a4f80ddc0f869f3f0f35aea3eb012de9c">ido2db_cleanup_socket</a>();
<a name="l01148"></a>01148 
<a name="l01149"></a>01149         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_wait_for_connections() end\n&quot;</span>);
<a name="l01150"></a>01150 
<a name="l01151"></a>01151         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01152"></a>01152         }
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 
<a name="l01155"></a><a class="code" href="ido2db_8c.html#adbac221129dc33c1eab91e63565d9001">01155</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ad8670e8992b6bff3724859a95c47cb9a">ido2db_handle_client_connection</a>(<span class="keywordtype">int</span> <a class="code" href="sockdebug_8c.html#a06b0afe769d54ae94259d8532bc878b0">sd</a>){
<a name="l01156"></a>01156         <a class="code" href="structido__dbuf__struct.html">ido_dbuf</a> <a class="code" href="icinga_8h.html#a81e73ddd5893b96b528c00be05e66d7a">dbuf</a>;
<a name="l01157"></a>01157         <span class="keywordtype">int</span> dbuf_chunk=2048;
<a name="l01158"></a>01158         <a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> idi;
<a name="l01159"></a>01159         <span class="keywordtype">char</span> buf[512];
<a name="l01160"></a>01160         <span class="keywordtype">int</span> result=0;
<a name="l01161"></a>01161         <span class="keywordtype">int</span> <a class="code" href="cmd_8c.html#aa6a44bb7540c4f54ca854e7eccc677c0">error</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <span class="keywordtype">int</span> pthread_ret=0;
<a name="l01164"></a>01164 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l01165"></a>01165 <span class="preprocessor"></span>        SSL *ssl=NULL;
<a name="l01166"></a>01166 <span class="preprocessor">#endif</span>
<a name="l01167"></a>01167 <span class="preprocessor"></span>
<a name="l01168"></a>01168         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_connection() start\n&quot;</span>);
<a name="l01169"></a>01169 
<a name="l01170"></a>01170         <span class="comment">/* open syslog facility */</span>
<a name="l01171"></a>01171         <span class="comment">/*openlog(&quot;ido2db&quot;,0,LOG_DAEMON);*/</span>
<a name="l01172"></a>01172 
<a name="l01173"></a>01173         syslog(LOG_USER | LOG_INFO, <span class="stringliteral">&quot;Handling client connection...\n&quot;</span>);
<a name="l01174"></a>01174         <span class="comment">/* re-open debug log */</span>
<a name="l01175"></a>01175         <a class="code" href="ido2db_8c.html#a15b16bfb2ea5d42ffaf8a5ab04c18ae8">ido2db_close_debug_log</a>();
<a name="l01176"></a>01176         <a class="code" href="ido2db_8c.html#ac480583b46396ce99b422d2c6864f6c7">ido2db_open_debug_log</a>();
<a name="l01177"></a>01177 
<a name="l01178"></a>01178         <span class="comment">/* reset signal handling */</span>
<a name="l01179"></a>01179         signal(SIGQUIT,<a class="code" href="ido2db_8h.html#ad4935b6ff0f26364fc23b1a046e7adfa">ido2db_child_sighandler</a>);
<a name="l01180"></a>01180         signal(SIGTERM,<a class="code" href="ido2db_8h.html#ad4935b6ff0f26364fc23b1a046e7adfa">ido2db_child_sighandler</a>);
<a name="l01181"></a>01181         signal(SIGINT,<a class="code" href="ido2db_8h.html#ad4935b6ff0f26364fc23b1a046e7adfa">ido2db_child_sighandler</a>);
<a name="l01182"></a>01182         signal(SIGSEGV,<a class="code" href="ido2db_8h.html#ad4935b6ff0f26364fc23b1a046e7adfa">ido2db_child_sighandler</a>);
<a name="l01183"></a>01183         signal(SIGFPE,<a class="code" href="ido2db_8h.html#ad4935b6ff0f26364fc23b1a046e7adfa">ido2db_child_sighandler</a>);
<a name="l01184"></a>01184 
<a name="l01185"></a>01185         <span class="comment">/* create cleanup thread */</span>
<a name="l01186"></a>01186         <span class="keywordflow">if</span> ((pthread_ret = pthread_create(&amp;<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0], NULL, <a class="code" href="ido2db_8h.html#ab3ef4313a21d2353ecc8eb5ffb15086f">ido2db_thread_cleanup</a>, &amp;idi)) != 0) {
<a name="l01187"></a>01187                 syslog(LOG_ERR,<span class="stringliteral">&quot;Could not create thread... exiting with error &#39;%s&#39;\n&quot;</span>, strerror(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01188"></a>01188                 exit(EXIT_FAILURE);
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191         <span class="comment">/* initialize input data information */</span>
<a name="l01192"></a>01192         <a class="code" href="ido2db_8h.html#a918617b0d7fa8c9e95119bdc9fead47e">ido2db_idi_init</a>(&amp;idi);
<a name="l01193"></a>01193 
<a name="l01194"></a>01194 
<a name="l01195"></a>01195         <span class="comment">/* initialize dynamic buffer (2KB chunk size) */</span>
<a name="l01196"></a>01196         <a class="code" href="utils_8h.html#ae9f1cad57e2f46c321f8a7a96d18b5be">ido_dbuf_init</a>(&amp;dbuf,dbuf_chunk);
<a name="l01197"></a>01197 
<a name="l01198"></a>01198         <span class="comment">/* initialize database connection */</span>
<a name="l01199"></a>01199         <a class="code" href="db_8h.html#a43b388ea23f1f456d3a3c4bba0762792">ido2db_db_init</a>(&amp;idi);
<a name="l01200"></a>01200 
<a name="l01201"></a>01201         <span class="comment">/* check if connection to database was successful */</span>
<a name="l01202"></a>01202         <span class="keywordflow">if</span>(<a class="code" href="db_8h.html#a3587cb89a643965537b1533b9cc3678d">ido2db_db_connect</a>(&amp;idi)==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>) {
<a name="l01203"></a>01203                 <span class="keywordflow">if</span>(idi.<a class="code" href="structido2db__input__data__info__struct.html#a09c3d285310fe1c3abc5cac74719aa1a">dbinfo</a>.<a class="code" href="structido2db__dbconninfo__struct.html#aff4ab8672fcb1b2219d82438f9cf6960">connected</a>!=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>) {
<a name="l01204"></a>01204 
<a name="l01205"></a>01205                         <span class="comment">/* we did not get a db connection and the client should be disconnected */</span>
<a name="l01206"></a>01206                         syslog(LOG_USER | LOG_INFO,<span class="stringliteral">&quot;Error: database connection failed, forced client disconnect...\n&quot;</span>);
<a name="l01207"></a>01207                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_connection() idi.dbinfo.connected is &#39;%d&#39;\n&quot;</span>, idi.<a class="code" href="structido2db__input__data__info__struct.html#a09c3d285310fe1c3abc5cac74719aa1a">dbinfo</a>.<a class="code" href="structido2db__dbconninfo__struct.html#aff4ab8672fcb1b2219d82438f9cf6960">connected</a>);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209                         <span class="comment">/* kill sub threads */</span>
<a name="l01210"></a>01210                         pthread_kill(<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0], SIGINT);
<a name="l01211"></a>01211                         pthread_cancel(<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0]);
<a name="l01212"></a>01212 
<a name="l01213"></a>01213                         <span class="comment">/* free memory allocated to dynamic buffer */</span>
<a name="l01214"></a>01214                         <a class="code" href="utils_8h.html#ab01072b58c97dcad10d70f4ba27a0acb">ido_dbuf_free</a>(&amp;dbuf);
<a name="l01215"></a>01215 
<a name="l01216"></a>01216                         <span class="comment">/* reset db credentials */</span>
<a name="l01217"></a>01217                         <a class="code" href="db_8h.html#a61a5fddb76c111a1689fd5dd95f9d7b7">ido2db_db_deinit</a>(&amp;idi);
<a name="l01218"></a>01218 
<a name="l01219"></a>01219                         <span class="comment">/* free memory */</span>
<a name="l01220"></a>01220                         <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(&amp;idi);
<a name="l01221"></a>01221                         <a class="code" href="ido2db_8h.html#affc50ec47a6ba3154814cf0ef77f0928">ido2db_free_connection_memory</a>(&amp;idi);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223                         <span class="comment">/* return error signalling that child is terminating */</span>
<a name="l01224"></a>01224                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01225"></a>01225                 }
<a name="l01226"></a>01226         }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l01229"></a>01229 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l01230"></a>01230                 <span class="keywordflow">if</span>((ssl=SSL_new(ctx))!=NULL){
<a name="l01231"></a>01231 
<a name="l01232"></a>01232                         SSL_set_fd(ssl,sd);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234                         <span class="comment">/* keep attempting the request if needed */</span>
<a name="l01235"></a>01235                         <span class="keywordflow">while</span>(((result=SSL_accept(ssl))!=1) &amp;&amp; (SSL_get_error(ssl,result)==SSL_ERROR_WANT_READ));
<a name="l01236"></a>01236 
<a name="l01237"></a>01237                         <span class="keywordflow">if</span>(result!=1){
<a name="l01238"></a>01238                                 syslog(LOG_ERR,<span class="stringliteral">&quot;Error: Could not complete SSL handshake. %d\n&quot;</span>,SSL_get_error(ssl,result));
<a name="l01239"></a>01239 
<a name="l01240"></a>01240                                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01241"></a>01241                         }
<a name="l01242"></a>01242                 }
<a name="l01243"></a>01243         }
<a name="l01244"></a>01244 <span class="preprocessor">#endif</span>
<a name="l01245"></a>01245 <span class="preprocessor"></span>
<a name="l01246"></a>01246         <span class="comment">/* read all data from client */</span>
<a name="l01247"></a>01247         <span class="keywordflow">while</span>(1){
<a name="l01248"></a>01248 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l01249"></a>01249 <span class="preprocessor"></span>                <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#af8f2d7fa6511db9cf490b81cbe39ab31">use_ssl</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>)
<a name="l01250"></a>01250                         result=read(sd,buf,<span class="keyword">sizeof</span>(buf)-1);
<a name="l01251"></a>01251                 <span class="keywordflow">else</span>{
<a name="l01252"></a>01252                         result=SSL_read(ssl,buf,<span class="keyword">sizeof</span>(buf)-1);
<a name="l01253"></a>01253                         <span class="keywordflow">if</span>(result==-1 &amp;&amp; (SSL_get_error(ssl,result)==SSL_ERROR_WANT_READ)){
<a name="l01254"></a>01254                                 syslog(LOG_ERR,<span class="stringliteral">&quot;SSL read error\n&quot;</span>);
<a name="l01255"></a>01255                         }
<a name="l01256"></a>01256                 }
<a name="l01257"></a>01257 <span class="preprocessor">#else</span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>                result=read(sd,buf,<span class="keyword">sizeof</span>(buf)-1);
<a name="l01259"></a>01259 <span class="preprocessor">#endif</span>
<a name="l01260"></a>01260 <span class="preprocessor"></span>
<a name="l01261"></a>01261                 <span class="comment">/* bail out on hard errors */</span>
<a name="l01262"></a>01262                 <span class="keywordflow">if</span>(result==-1) {
<a name="l01263"></a>01263                                 <span class="comment">/* EAGAIN and EINTR are soft errors, so try another read() */</span>
<a name="l01264"></a>01264                                 <span class="keywordflow">if</span> (<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==EAGAIN || <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==EINTR)
<a name="l01265"></a>01265                                         <span class="keywordflow">continue</span>;
<a name="l01266"></a>01266                                 <span class="keywordflow">else</span> {
<a name="l01267"></a>01267                                         error=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l01268"></a>01268 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l01269"></a>01269 <span class="preprocessor"></span>                                <span class="keywordflow">if</span>(ssl){
<a name="l01270"></a>01270                                         SSL_shutdown(ssl);
<a name="l01271"></a>01271                                         SSL_free(ssl);
<a name="l01272"></a>01272                                         syslog(LOG_INFO,<span class="stringliteral">&quot;INFO: SSL Socket Shutdown.\n&quot;</span>);
<a name="l01273"></a>01273                                 }
<a name="l01274"></a>01274 <span class="preprocessor">#endif</span>
<a name="l01275"></a>01275 <span class="preprocessor"></span>                                        <span class="keywordflow">break</span>;
<a name="l01276"></a>01276                                 }
<a name="l01277"></a>01277                 }
<a name="l01278"></a>01278 
<a name="l01279"></a>01279                 <span class="comment">/* zero bytes read means we lost the connection with the client */</span>
<a name="l01280"></a>01280                 <span class="keywordflow">if</span>(result==0){
<a name="l01281"></a>01281 <span class="preprocessor">#ifdef HAVE_SSL</span>
<a name="l01282"></a>01282 <span class="preprocessor"></span>                        <span class="keywordflow">if</span>(ssl){
<a name="l01283"></a>01283                                 SSL_shutdown(ssl);
<a name="l01284"></a>01284                                 SSL_free(ssl);
<a name="l01285"></a>01285                                 syslog(LOG_INFO,<span class="stringliteral">&quot;INFO: SSL Socket Shutdown.\n&quot;</span>);
<a name="l01286"></a>01286                         }
<a name="l01287"></a>01287 <span class="preprocessor">#endif</span>
<a name="l01288"></a>01288 <span class="preprocessor"></span>
<a name="l01289"></a>01289                         <span class="comment">/* gracefully back out of current operation... */</span>
<a name="l01290"></a>01290                         <a class="code" href="db_8h.html#a8f7271af7f540e62f3acf72672fe34fb">ido2db_db_goodbye</a>(&amp;idi);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292                         <span class="keywordflow">break</span>;
<a name="l01293"></a>01293                         }
<a name="l01294"></a>01294 
<a name="l01295"></a>01295 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01296"></a>01296 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;BYTESREAD: %d\n&quot;</span>,result);
<a name="l01297"></a>01297 <span class="preprocessor">#endif</span>
<a name="l01298"></a>01298 <span class="preprocessor"></span>
<a name="l01299"></a>01299                 <span class="comment">/* append data we just read to dynamic buffer */</span>
<a name="l01300"></a>01300                 buf[result]=<span class="stringliteral">&#39;\x0&#39;</span>;
<a name="l01301"></a>01301                 <a class="code" href="utils_8h.html#a4d2311724e39d6a47b17e5e18daff139">ido_dbuf_strcat</a>(&amp;dbuf,buf);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303                 <span class="comment">/* check for completed lines of input */</span>
<a name="l01304"></a>01304                 <a class="code" href="ido2db_8h.html#ada596f92ef607f40db1e38d1bcad07c1">ido2db_check_for_client_input</a>(&amp;idi,&amp;dbuf, <a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306                 <span class="comment">/* should we disconnect the client? */</span>
<a name="l01307"></a>01307                 <span class="keywordflow">if</span>(idi.<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l01308"></a>01308 
<a name="l01309"></a>01309                         <span class="comment">/* gracefully back out of current operation... */</span>
<a name="l01310"></a>01310                         <a class="code" href="db_8h.html#a8f7271af7f540e62f3acf72672fe34fb">ido2db_db_goodbye</a>(&amp;idi);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312                         <span class="keywordflow">break</span>;
<a name="l01313"></a>01313                         }
<a name="l01314"></a>01314                 }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01317"></a>01317 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;BYTES: %lu, LINES: %lu\n&quot;</span>,idi.<a class="code" href="structido2db__input__data__info__struct.html#ad27e836a460c762a64423139ffb2fa92">bytes_processed</a>,idi.<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>);
<a name="l01318"></a>01318 <span class="preprocessor">#endif</span>
<a name="l01319"></a>01319 <span class="preprocessor"></span>
<a name="l01320"></a>01320         <span class="comment">/* Kill all sub threads */</span>
<a name="l01321"></a>01321         <span class="comment">/* Experimental and may be dangerous... */</span>
<a name="l01322"></a>01322         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_connection() idi.disconnect_client is &#39;%d&#39;\n&quot;</span>, idi.<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>);
<a name="l01323"></a>01323         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_connection() Cancel cleanup thread to terminate\n&quot;</span>);
<a name="l01324"></a>01324         <span class="comment">// pthread_join(thread_pool[0], NULL);</span>
<a name="l01325"></a>01325         pthread_kill(<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0], SIGINT);
<a name="l01326"></a>01326         pthread_cancel(<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0]);
<a name="l01327"></a>01327         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_connection() cleanup thread terminated\n&quot;</span>);
<a name="l01328"></a>01328 
<a name="l01329"></a>01329         <span class="comment">/* free memory allocated to dynamic buffer */</span>
<a name="l01330"></a>01330         <a class="code" href="utils_8h.html#ab01072b58c97dcad10d70f4ba27a0acb">ido_dbuf_free</a>(&amp;dbuf);
<a name="l01331"></a>01331 
<a name="l01332"></a>01332         <span class="comment">/* disconnect from database */</span>
<a name="l01333"></a>01333         <a class="code" href="db_8h.html#aa3f184ab38d15b8ce774c348ed0e0d46">ido2db_db_disconnect</a>(&amp;idi);
<a name="l01334"></a>01334         <a class="code" href="db_8h.html#a61a5fddb76c111a1689fd5dd95f9d7b7">ido2db_db_deinit</a>(&amp;idi);
<a name="l01335"></a>01335 
<a name="l01336"></a>01336         <span class="comment">/* free memory */</span>
<a name="l01337"></a>01337         <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(&amp;idi);
<a name="l01338"></a>01338         <a class="code" href="ido2db_8h.html#affc50ec47a6ba3154814cf0ef77f0928">ido2db_free_connection_memory</a>(&amp;idi);
<a name="l01339"></a>01339 
<a name="l01340"></a>01340         <span class="comment">/* close syslog facility */</span>
<a name="l01341"></a>01341         <span class="comment">/*closelog();*/</span>
<a name="l01342"></a>01342 
<a name="l01343"></a>01343         <span class="keywordflow">if</span>(error==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>)
<a name="l01344"></a>01344                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01345"></a>01345 
<a name="l01346"></a>01346         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_connection() end\n&quot;</span>);
<a name="l01347"></a>01347 
<a name="l01348"></a>01348         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01349"></a>01349         }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 <span class="comment">/* initializes structure for tracking data */</span>
<a name="l01353"></a><a class="code" href="ido2db_8c.html#a44bb8114f8cab0bae95ce39a4484d40d">01353</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a918617b0d7fa8c9e95119bdc9fead47e">ido2db_idi_init</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi){
<a name="l01354"></a>01354         <span class="keywordtype">int</span> x=0;
<a name="l01355"></a>01355 
<a name="l01356"></a>01356         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_idi_init() start\n&quot;</span>);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358         <span class="keywordflow">if</span>(idi==NULL)
<a name="l01359"></a>01359                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01360"></a>01360 
<a name="l01361"></a>01361         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l01362"></a>01362         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abcd90fac4c88b6623211d6b7a5fff2b6">ignore_client_data</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l01363"></a>01363         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a73402bce361e09752f20f6a5cee32f50">protocol_version</a>=0;
<a name="l01364"></a>01364         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>=NULL;
<a name="l01365"></a>01365         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>=NULL;
<a name="l01366"></a>01366         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abf6e1df34a8c51b8b6b4c350e76c9337">agent_name</a>=NULL;
<a name="l01367"></a>01367         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a>=NULL;
<a name="l01368"></a>01368         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a>=NULL;
<a name="l01369"></a>01369         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a>=NULL;
<a name="l01370"></a>01370         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a>=NULL;
<a name="l01371"></a>01371         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a0145cefa8493fb75bfad4b47c34ef561">current_input_section</a>=<a class="code" href="ido2db_8h.html#a426f360367c9f3186f630a16924c103c">IDO2DB_INPUT_SECTION_NONE</a>;
<a name="l01372"></a>01372         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a05d25af73991258d2ee9a8ccb72cab1d">IDO2DB_INPUT_DATA_NONE</a>;
<a name="l01373"></a>01373         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#ad27e836a460c762a64423139ffb2fa92">bytes_processed</a>=0L;
<a name="l01374"></a>01374         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>=0L;
<a name="l01375"></a>01375         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a700ef2c38019a55dab560d3da266536d">entries_processed</a>=0L;
<a name="l01376"></a>01376         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a57397bec140021f1e26d4ff309c512e3">current_object_config_type</a>=<a class="code" href="ido2db_8h.html#a9473075924959c0cccf815b5895b5a26">IDO2DB_CONFIGTYPE_ORIGINAL</a>;
<a name="l01377"></a>01377         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aabf5e84b156ca8582cd9aa874c8a0986">data_start_time</a>=0L;
<a name="l01378"></a>01378         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#ad5245b2e414833375fb7ebad7d68b6ff">data_end_time</a>=0L;
<a name="l01379"></a>01379 
<a name="l01380"></a>01380         <span class="comment">/* initialize mbuf */</span>
<a name="l01381"></a>01381         <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="ido2db_8h.html#aae764517d9446fd4d3524d344190b874">IDO2DB_MAX_MBUF_ITEMS</a>;x++){
<a name="l01382"></a>01382                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#a599c5a116f9cbbf65365bec52c99f962">used_lines</a>=0;
<a name="l01383"></a>01383                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#a167eb3433ec458d100d88de5a3fdea1a">allocated_lines</a>=0;
<a name="l01384"></a>01384                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>=NULL;
<a name="l01385"></a>01385                 }
<a name="l01386"></a>01386 
<a name="l01387"></a>01387         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_idi_init() end\n&quot;</span>);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01390"></a>01390         }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 <span class="comment">/* checks for single lines of input from a client connection */</span>
<a name="l01394"></a><a class="code" href="ido2db_8c.html#ab44d5e63cb34510e5f8a4b7ff8682503">01394</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ada596f92ef607f40db1e38d1bcad07c1">ido2db_check_for_client_input</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi,<a class="code" href="structido__dbuf__struct.html">ido_dbuf</a> *<a class="code" href="structdbuf__struct.html">dbuf</a>, pthread_t *<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>){
<a name="l01395"></a>01395         <span class="keywordtype">char</span> *buf=NULL;
<a name="l01396"></a>01396         <span class="keyword">register</span> <span class="keywordtype">int</span> x;
<a name="l01397"></a>01397 
<a name="l01398"></a>01398         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_check_for_client_input() start\n&quot;</span>);
<a name="l01399"></a>01399 
<a name="l01400"></a>01400         <span class="keywordflow">if</span>(dbuf==NULL)
<a name="l01401"></a>01401                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01402"></a>01402         <span class="keywordflow">if</span>(dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>==NULL)
<a name="l01403"></a>01403                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01404"></a>01404 
<a name="l01405"></a>01405 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01406"></a>01406 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;RAWBUF: %s\n&quot;</span>,dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>);
<a name="l01407"></a>01407         printf(<span class="stringliteral">&quot;  USED1: %lu, BYTES: %lu, LINES: %lu\n&quot;</span>,dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#a985e59b087717a5fa4a0c450672a31f7">used_size</a>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#ad27e836a460c762a64423139ffb2fa92">bytes_processed</a>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>);
<a name="l01408"></a>01408 <span class="preprocessor">#endif</span>
<a name="l01409"></a>01409 <span class="preprocessor"></span>
<a name="l01410"></a>01410         <span class="comment">/* search for complete lines of input */</span>
<a name="l01411"></a>01411         <span class="keywordflow">for</span>(x=0;dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>[x]!=<span class="stringliteral">&#39;\x0&#39;</span>;x++){
<a name="l01412"></a>01412 
<a name="l01413"></a>01413                 <span class="comment">/* we found the end of a line */</span>
<a name="l01414"></a>01414                 <span class="keywordflow">if</span>(dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>[x]==<span class="charliteral">&#39;\n&#39;</span>){
<a name="l01415"></a>01415 
<a name="l01416"></a>01416 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01417"></a>01417 <span class="preprocessor"></span>                        printf(<span class="stringliteral">&quot;BUF[%d]=&#39;\\n&#39;\n&quot;</span>,x);
<a name="l01418"></a>01418 <span class="preprocessor">#endif</span>
<a name="l01419"></a>01419 <span class="preprocessor"></span>
<a name="l01420"></a>01420                         <span class="comment">/* handle this line of input */</span>
<a name="l01421"></a>01421                         dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>[x]=<span class="stringliteral">&#39;\x0&#39;</span>;
<a name="l01422"></a>01422                         <span class="keywordflow">if</span>((buf=strdup(dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>))){
<a name="l01423"></a>01423                                 <a class="code" href="ido2db_8h.html#a69ddb9e731a669833add85617c3fd749">ido2db_handle_client_input</a>(idi,buf, thread_pool);
<a name="l01424"></a>01424                                 free(buf);
<a name="l01425"></a>01425                                 buf=NULL;
<a name="l01426"></a>01426                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>++;
<a name="l01427"></a>01427                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#ad27e836a460c762a64423139ffb2fa92">bytes_processed</a>+=(x+1);
<a name="l01428"></a>01428                                 }
<a name="l01429"></a>01429 
<a name="l01430"></a>01430                         <span class="comment">/* shift data back to front of buffer and adjust counters */</span>
<a name="l01431"></a>01431                         memmove((<span class="keywordtype">void</span> *)&amp;dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>[0],(<span class="keywordtype">void</span> *)&amp;dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>[x+1],(<span class="keywordtype">size_t</span>)((<span class="keywordtype">int</span>)dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#a985e59b087717a5fa4a0c450672a31f7">used_size</a>-x-1));
<a name="l01432"></a>01432                         dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#a985e59b087717a5fa4a0c450672a31f7">used_size</a>-=(x+1);
<a name="l01433"></a>01433                         dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#ac2f39c609b40a8cd7bf2b8f5248dd804">buf</a>[dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#a985e59b087717a5fa4a0c450672a31f7">used_size</a>]=<span class="stringliteral">&#39;\x0&#39;</span>;
<a name="l01434"></a>01434                         x=-1;
<a name="l01435"></a>01435 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01436"></a>01436 <span class="preprocessor"></span>                        printf(<span class="stringliteral">&quot;  USED2: %lu, BYTES: %lu, LINES: %lu\n&quot;</span>,dbuf-&gt;<a class="code" href="structido__dbuf__struct.html#a985e59b087717a5fa4a0c450672a31f7">used_size</a>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#ad27e836a460c762a64423139ffb2fa92">bytes_processed</a>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>);
<a name="l01437"></a>01437 <span class="preprocessor">#endif</span>
<a name="l01438"></a>01438 <span class="preprocessor"></span>                        }
<a name="l01439"></a>01439                 }
<a name="l01440"></a>01440 
<a name="l01441"></a>01441         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_check_for_client_input() end\n&quot;</span>);
<a name="l01442"></a>01442         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01443"></a>01443         }
<a name="l01444"></a>01444 
<a name="l01445"></a>01445 
<a name="l01446"></a>01446 <span class="comment">/* handles a single line of input from a client connection */</span>
<a name="l01447"></a><a class="code" href="ido2db_8c.html#a4f6332e5aa0edea3f53e16fedeb3f1de">01447</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a69ddb9e731a669833add85617c3fd749">ido2db_handle_client_input</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi, <span class="keywordtype">char</span> *buf, pthread_t *<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>){
<a name="l01448"></a>01448         <span class="keywordtype">char</span> *var=NULL;
<a name="l01449"></a>01449         <span class="keywordtype">char</span> *val=NULL;
<a name="l01450"></a>01450         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> data_type_long=0L;
<a name="l01451"></a>01451         <span class="keywordtype">int</span> data_type=<a class="code" href="protoapi_8h.html#a3a8b4f563e85995d09a33e9602e36118">IDO_DATA_NONE</a>;
<a name="l01452"></a>01452         <span class="keywordtype">int</span> <a class="code" href="histogram_8c.html#a395840769da8369299fac09efb0d0895">input_type</a>=<a class="code" href="ido2db_8h.html#a05d25af73991258d2ee9a8ccb72cab1d">IDO2DB_INPUT_DATA_NONE</a>;
<a name="l01453"></a>01453 
<a name="l01454"></a>01454         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_input() start\n&quot;</span>);
<a name="l01455"></a>01455 
<a name="l01456"></a>01456 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01457"></a>01457 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;HANDLING: &#39;%s&#39;\n&quot;</span>,buf);
<a name="l01458"></a>01458 <span class="preprocessor">#endif</span>
<a name="l01459"></a>01459 <span class="preprocessor"></span>
<a name="l01460"></a>01460         <span class="keywordflow">if</span>(buf==NULL || idi==NULL)
<a name="l01461"></a>01461                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01462"></a>01462 
<a name="l01463"></a>01463         <span class="comment">/* we&#39;re ignoring client data because of wrong protocol version, etc...  */</span>
<a name="l01464"></a>01464         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abcd90fac4c88b6623211d6b7a5fff2b6">ignore_client_data</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>)
<a name="l01465"></a>01465                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01466"></a>01466 
<a name="l01467"></a>01467         <span class="comment">/* skip empty lines */</span>
<a name="l01468"></a>01468         <span class="keywordflow">if</span>(buf[0]==<span class="stringliteral">&#39;\x0&#39;</span>)
<a name="l01469"></a>01469                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01470"></a>01470 
<a name="l01471"></a>01471         <span class="keywordflow">switch</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a0145cefa8493fb75bfad4b47c34ef561">current_input_section</a>){
<a name="l01472"></a>01472 
<a name="l01473"></a>01473         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a426f360367c9f3186f630a16924c103c">IDO2DB_INPUT_SECTION_NONE</a>:
<a name="l01474"></a>01474 
<a name="l01475"></a>01475                 var=strtok(buf,<span class="stringliteral">&quot;:&quot;</span>);
<a name="l01476"></a>01476                 val=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01477"></a>01477 
<a name="l01478"></a>01478                 <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#ae6ffbc64c88e64b9650cd77795fb7a70">IDO_API_HELLO</a>)){
<a name="l01479"></a>01479 
<a name="l01480"></a>01480                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a0145cefa8493fb75bfad4b47c34ef561">current_input_section</a>=<a class="code" href="ido2db_8h.html#a1e8b6d5df1c79b260bf2d47e7f8ae453">IDO2DB_INPUT_SECTION_HEADER</a>;
<a name="l01481"></a>01481                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a05d25af73991258d2ee9a8ccb72cab1d">IDO2DB_INPUT_DATA_NONE</a>;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483                         <span class="comment">/* free old connection memory (necessary in some cases) */</span>
<a name="l01484"></a>01484                         <a class="code" href="ido2db_8h.html#affc50ec47a6ba3154814cf0ef77f0928">ido2db_free_connection_memory</a>(idi);
<a name="l01485"></a>01485                         }
<a name="l01486"></a>01486 
<a name="l01487"></a>01487                 <span class="keywordflow">break</span>;
<a name="l01488"></a>01488 
<a name="l01489"></a>01489         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a1e8b6d5df1c79b260bf2d47e7f8ae453">IDO2DB_INPUT_SECTION_HEADER</a>:
<a name="l01490"></a>01490 
<a name="l01491"></a>01491                 var=strtok(buf,<span class="stringliteral">&quot;:&quot;</span>);
<a name="l01492"></a>01492                 val=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01493"></a>01493 
<a name="l01494"></a>01494                 <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a6af37667dc2dfdee38ff49bc39e9ad05">IDO_API_STARTDATADUMP</a>)){
<a name="l01495"></a>01495 
<a name="l01496"></a>01496                         <span class="comment">/* client is using wrong protocol version, bail out here... */</span>
<a name="l01497"></a>01497                         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a73402bce361e09752f20f6a5cee32f50">protocol_version</a>!=<a class="code" href="protoapi_8h.html#ad5989f94432afe29e8b4262470c4a68b">IDO_API_PROTOVERSION</a>){
<a name="l01498"></a>01498                                 syslog(LOG_USER|LOG_INFO,<span class="stringliteral">&quot;Error: Client protocol version %d is incompatible with server version %d.  Disconnecting client...&quot;</span>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a73402bce361e09752f20f6a5cee32f50">protocol_version</a>,<a class="code" href="protoapi_8h.html#ad5989f94432afe29e8b4262470c4a68b">IDO_API_PROTOVERSION</a>);
<a name="l01499"></a>01499                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l01500"></a>01500                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abcd90fac4c88b6623211d6b7a5fff2b6">ignore_client_data</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l01501"></a>01501                                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01502"></a>01502                                 }
<a name="l01503"></a>01503 
<a name="l01504"></a>01504                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a0145cefa8493fb75bfad4b47c34ef561">current_input_section</a>=<a class="code" href="ido2db_8h.html#acf6b573ef99f3c18a00c2ac79811a187">IDO2DB_INPUT_SECTION_DATA</a>;
<a name="l01505"></a>01505 
<a name="l01506"></a>01506                         <span class="comment">/* save connection info to DB */</span>
<a name="l01507"></a>01507                         <a class="code" href="db_8h.html#a28563a787cce74f9244e44af829c618c">ido2db_db_hello</a>(idi);
<a name="l01508"></a>01508 
<a name="l01509"></a>01509                         }
<a name="l01510"></a>01510 
<a name="l01511"></a>01511                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a23d90edbe21368a73edb054f0ba90770">IDO_API_PROTOCOL</a>))
<a name="l01512"></a>01512                         <a class="code" href="ido2db_8h.html#ae6d3a21e7e24fd41a088c5a8b1878a91">ido2db_convert_string_to_int</a>((val+1),&amp;idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a73402bce361e09752f20f6a5cee32f50">protocol_version</a>);
<a name="l01513"></a>01513 
<a name="l01514"></a>01514                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#af5f558761ca32b16e242f8407b67e094">IDO_API_INSTANCENAME</a>))
<a name="l01515"></a>01515                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>=strdup(val+1);
<a name="l01516"></a>01516 
<a name="l01517"></a>01517                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#ad15287c149b99d9931a6a746c6d5e059">IDO_API_AGENT</a>))
<a name="l01518"></a>01518                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abf6e1df34a8c51b8b6b4c350e76c9337">agent_name</a>=strdup(val+1);
<a name="l01519"></a>01519 
<a name="l01520"></a>01520                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a0651b4fc7f2ef420338e44f1dc60de5a">IDO_API_AGENTVERSION</a>))
<a name="l01521"></a>01521                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a>=strdup(val+1);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a4fece8e1afdca4d1a2b99514542c9d16">IDO_API_DISPOSITION</a>))
<a name="l01524"></a>01524                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a>=strdup(val+1);
<a name="l01525"></a>01525 
<a name="l01526"></a>01526                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a998359ea235e69ef92e48f2ebecada43">IDO_API_CONNECTION</a>))
<a name="l01527"></a>01527                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a>=strdup(val+1);
<a name="l01528"></a>01528 
<a name="l01529"></a>01529                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#aad067296813dde40f02870f8591f00dd">IDO_API_CONNECTTYPE</a>))
<a name="l01530"></a>01530                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a>=strdup(val+1);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a36374d2475bcffb2f57a0c7de6317cbf">IDO_API_STARTTIME</a>))
<a name="l01533"></a>01533                         <a class="code" href="ido2db_8h.html#ab16d6b78a295991bcce24494c93509ac">ido2db_convert_string_to_unsignedlong</a>((val+1),&amp;idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aabf5e84b156ca8582cd9aa874c8a0986">data_start_time</a>);
<a name="l01534"></a>01534 
<a name="l01535"></a>01535                 <span class="keywordflow">break</span>;
<a name="l01536"></a>01536 
<a name="l01537"></a>01537         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aeed0f465591b647f97e7f2ff2d8d9a2f">IDO2DB_INPUT_SECTION_FOOTER</a>:
<a name="l01538"></a>01538 
<a name="l01539"></a>01539                 var=strtok(buf,<span class="stringliteral">&quot;:&quot;</span>);
<a name="l01540"></a>01540                 val=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01541"></a>01541 
<a name="l01542"></a>01542                 <span class="comment">/* client is saying goodbye... */</span>
<a name="l01543"></a>01543                 <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a90a1466dbcc50b41f0c15bf0f197eb05">IDO_API_GOODBYE</a>))
<a name="l01544"></a>01544                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a0145cefa8493fb75bfad4b47c34ef561">current_input_section</a>=<a class="code" href="ido2db_8h.html#a426f360367c9f3186f630a16924c103c">IDO2DB_INPUT_SECTION_NONE</a>;
<a name="l01545"></a>01545 
<a name="l01546"></a>01546                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!strcmp(var,<a class="code" href="protoapi_8h.html#a1d467e7fd651a7cedeba1dc0f0746494">IDO_API_ENDTIME</a>))
<a name="l01547"></a>01547                         <a class="code" href="ido2db_8h.html#ab16d6b78a295991bcce24494c93509ac">ido2db_convert_string_to_unsignedlong</a>((val+1),&amp;idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#ad5245b2e414833375fb7ebad7d68b6ff">data_end_time</a>);
<a name="l01548"></a>01548 
<a name="l01549"></a>01549                 <span class="keywordflow">break</span>;
<a name="l01550"></a>01550 
<a name="l01551"></a>01551         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#acf6b573ef99f3c18a00c2ac79811a187">IDO2DB_INPUT_SECTION_DATA</a>:
<a name="l01552"></a>01552 
<a name="l01553"></a>01553                 <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>==<a class="code" href="ido2db_8h.html#a05d25af73991258d2ee9a8ccb72cab1d">IDO2DB_INPUT_DATA_NONE</a>){
<a name="l01554"></a>01554 
<a name="l01555"></a>01555                         var=strtok(buf,<span class="stringliteral">&quot;:&quot;</span>);
<a name="l01556"></a>01556                         val=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01557"></a>01557 
<a name="l01558"></a>01558                         input_type=atoi(var);
<a name="l01559"></a>01559 
<a name="l01560"></a>01560                         <span class="keywordflow">switch</span>(input_type){
<a name="l01561"></a>01561 
<a name="l01562"></a>01562                         <span class="comment">/* we&#39;re reached the end of all of the data... */</span>
<a name="l01563"></a>01563                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a2c7d2f76286ee5d02e188e16d65fffef">IDO_API_ENDDATADUMP</a>:
<a name="l01564"></a>01564                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a0145cefa8493fb75bfad4b47c34ef561">current_input_section</a>=<a class="code" href="ido2db_8h.html#aeed0f465591b647f97e7f2ff2d8d9a2f">IDO2DB_INPUT_SECTION_FOOTER</a>;
<a name="l01565"></a>01565                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a05d25af73991258d2ee9a8ccb72cab1d">IDO2DB_INPUT_DATA_NONE</a>;
<a name="l01566"></a>01566                                 <span class="keywordflow">break</span>;
<a name="l01567"></a>01567 
<a name="l01568"></a>01568                         <span class="comment">/* config dumps */</span>
<a name="l01569"></a>01569                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6f75d31569b169ec2a9379c117cb85df">IDO_API_STARTCONFIGDUMP</a>:
<a name="l01570"></a>01570                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ae24444e4f53bcb4738ca810405442b01">IDO2DB_INPUT_DATA_CONFIGDUMPSTART</a>;
<a name="l01571"></a>01571                                 <span class="keywordflow">break</span>;
<a name="l01572"></a>01572                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a1a91c197f1928a648e3cfd089e552050">IDO_API_ENDCONFIGDUMP</a>:
<a name="l01573"></a>01573                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a9fd2024907cc7dd108598ebc1736ede7">IDO2DB_INPUT_DATA_CONFIGDUMPEND</a>;
<a name="l01574"></a>01574                                 <span class="keywordflow">break</span>;
<a name="l01575"></a>01575 
<a name="l01576"></a>01576                         <span class="comment">/* archived data */</span>
<a name="l01577"></a>01577                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a065032861de1b15090764315cbf78728">IDO_API_LOGENTRY</a>:
<a name="l01578"></a>01578                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ae55f7551c60a4fc595aced690e766b91">IDO2DB_INPUT_DATA_LOGENTRY</a>;
<a name="l01579"></a>01579                                 <span class="keywordflow">break</span>;
<a name="l01580"></a>01580 
<a name="l01581"></a>01581                         <span class="comment">/* realtime data */</span>
<a name="l01582"></a>01582                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a2defaf6aa13ed283c0fbc79af064e63a">IDO_API_PROCESSDATA</a>:
<a name="l01583"></a>01583                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aba6dcd19e88227ffa1b76cc816470783">IDO2DB_INPUT_DATA_PROCESSDATA</a>;
<a name="l01584"></a>01584                                 <span class="keywordflow">break</span>;
<a name="l01585"></a>01585                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6a8d0b985cfaad4366c8ac01d33c5759">IDO_API_TIMEDEVENTDATA</a>:
<a name="l01586"></a>01586                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a463900824595d351ffdac6f3663509ce">IDO2DB_INPUT_DATA_TIMEDEVENTDATA</a>;
<a name="l01587"></a>01587                                 <span class="keywordflow">break</span>;
<a name="l01588"></a>01588                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6deb62675655343189dd6bd772c552e6">IDO_API_LOGDATA</a>:
<a name="l01589"></a>01589                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a45e4da936e8dc297f0f3b4ccefce3475">IDO2DB_INPUT_DATA_LOGDATA</a>;
<a name="l01590"></a>01590                                 <span class="keywordflow">break</span>;
<a name="l01591"></a>01591                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab7372cef50e6aafc989f793e19d9b3a1">IDO_API_SYSTEMCOMMANDDATA</a>:
<a name="l01592"></a>01592                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a98a0644960497c978f1dad0ddf329e42">IDO2DB_INPUT_DATA_SYSTEMCOMMANDDATA</a>;
<a name="l01593"></a>01593                                 <span class="keywordflow">break</span>;
<a name="l01594"></a>01594                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ae1b0cae555a16c90be0e8459a8818c79">IDO_API_EVENTHANDLERDATA</a>:
<a name="l01595"></a>01595                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aa4c52e4f2d70f1b2187f014215515914">IDO2DB_INPUT_DATA_EVENTHANDLERDATA</a>;
<a name="l01596"></a>01596                                 <span class="keywordflow">break</span>;
<a name="l01597"></a>01597                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a113509b3ed26625996faef6fe503019a">IDO_API_NOTIFICATIONDATA</a>:
<a name="l01598"></a>01598                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ae12c0ae2e47689c515e2fb2eff843580">IDO2DB_INPUT_DATA_NOTIFICATIONDATA</a>;
<a name="l01599"></a>01599                                 <span class="keywordflow">break</span>;
<a name="l01600"></a>01600                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9316cbbfef444028dab7bb3e7610b3db">IDO_API_SERVICECHECKDATA</a>:
<a name="l01601"></a>01601                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aa89e2e5facd49e1fc4bdc8d6005429a5">IDO2DB_INPUT_DATA_SERVICECHECKDATA</a>;
<a name="l01602"></a>01602                                 <span class="keywordflow">break</span>;
<a name="l01603"></a>01603                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a651a493fe0d4996d9befd34d959fbd1f">IDO_API_HOSTCHECKDATA</a>:
<a name="l01604"></a>01604                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a976d5a798ac05f29e974c41efe1fa1c3">IDO2DB_INPUT_DATA_HOSTCHECKDATA</a>;
<a name="l01605"></a>01605                                 <span class="keywordflow">break</span>;
<a name="l01606"></a>01606                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad9d292303f055f3f91997a84a3819fa2">IDO_API_COMMENTDATA</a>:
<a name="l01607"></a>01607                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a077d61efa1bd4c83a9b8af2de64d9f42">IDO2DB_INPUT_DATA_COMMENTDATA</a>;
<a name="l01608"></a>01608                                 <span class="keywordflow">break</span>;
<a name="l01609"></a>01609                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a0272d60c9929fb0351c16684f93143b8">IDO_API_DOWNTIMEDATA</a>:
<a name="l01610"></a>01610                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a07d1af5133054388c727466f068ca287">IDO2DB_INPUT_DATA_DOWNTIMEDATA</a>;
<a name="l01611"></a>01611                                 <span class="keywordflow">break</span>;
<a name="l01612"></a>01612                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a1e48d08089a794b71e0b57cde370bedc">IDO_API_FLAPPINGDATA</a>:
<a name="l01613"></a>01613                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a4b685ff934743579170dff79611cc4d9">IDO2DB_INPUT_DATA_FLAPPINGDATA</a>;
<a name="l01614"></a>01614                                 <span class="keywordflow">break</span>;
<a name="l01615"></a>01615                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a1efa41e276716d1bdc7684e0891d169a">IDO_API_PROGRAMSTATUSDATA</a>:
<a name="l01616"></a>01616                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a5a3d56e7511365ed4eae9f03ac56b270">IDO2DB_INPUT_DATA_PROGRAMSTATUSDATA</a>;
<a name="l01617"></a>01617                                 <span class="keywordflow">break</span>;
<a name="l01618"></a>01618                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad211722289e34c55d8eac7c264e42aa6">IDO_API_HOSTSTATUSDATA</a>:
<a name="l01619"></a>01619                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ab522462670d3ebebaa6a4d269281758e">IDO2DB_INPUT_DATA_HOSTSTATUSDATA</a>;
<a name="l01620"></a>01620                                 <span class="keywordflow">break</span>;
<a name="l01621"></a>01621                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a368f42135c403bf14f2d6d098a372308">IDO_API_SERVICESTATUSDATA</a>:
<a name="l01622"></a>01622                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a45290b363ae9831633b91f534622f59b">IDO2DB_INPUT_DATA_SERVICESTATUSDATA</a>;
<a name="l01623"></a>01623                                 <span class="keywordflow">break</span>;
<a name="l01624"></a>01624                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a51f94d8160dffad7452bf78145c9ab9a">IDO_API_CONTACTSTATUSDATA</a>:
<a name="l01625"></a>01625                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aabe3325ec54f9f7b088472dee377cf1a">IDO2DB_INPUT_DATA_CONTACTSTATUSDATA</a>;
<a name="l01626"></a>01626                                 <span class="keywordflow">break</span>;
<a name="l01627"></a>01627                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad45eb9500bafa9d7a04961415ffaeb25">IDO_API_ADAPTIVEPROGRAMDATA</a>:
<a name="l01628"></a>01628                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ab7e5d392fdd136f751a90547c99b9fbd">IDO2DB_INPUT_DATA_ADAPTIVEPROGRAMDATA</a>;
<a name="l01629"></a>01629                                 <span class="keywordflow">break</span>;
<a name="l01630"></a>01630                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6312ac69cd6e67d20092daab4d69e31f">IDO_API_ADAPTIVEHOSTDATA</a>:
<a name="l01631"></a>01631                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aad2ec0da03b42f2c0ea1570994449595">IDO2DB_INPUT_DATA_ADAPTIVEHOSTDATA</a>;
<a name="l01632"></a>01632                                 <span class="keywordflow">break</span>;
<a name="l01633"></a>01633                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a97dc6dcfe88bde8ce9c71622681bcfcc">IDO_API_ADAPTIVESERVICEDATA</a>:
<a name="l01634"></a>01634                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a17180271e2111c8661be53092ab671b6">IDO2DB_INPUT_DATA_ADAPTIVESERVICEDATA</a>;
<a name="l01635"></a>01635                                 <span class="keywordflow">break</span>;
<a name="l01636"></a>01636                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#acb112fd6fefd570380d1b87cc92eae73">IDO_API_ADAPTIVECONTACTDATA</a>:
<a name="l01637"></a>01637                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a82c67be65acc2c0b017245c2c9d46d19">IDO2DB_INPUT_DATA_ADAPTIVECONTACTDATA</a>;
<a name="l01638"></a>01638                                 <span class="keywordflow">break</span>;
<a name="l01639"></a>01639                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a74b6c984d13b8101e03efc746df09324">IDO_API_EXTERNALCOMMANDDATA</a>:
<a name="l01640"></a>01640                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aa51473e1cf440375b8b2820778573585">IDO2DB_INPUT_DATA_EXTERNALCOMMANDDATA</a>;
<a name="l01641"></a>01641                                 <span class="keywordflow">break</span>;
<a name="l01642"></a>01642                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a128a78c29d10ff243f28d0cb66c16093">IDO_API_AGGREGATEDSTATUSDATA</a>:
<a name="l01643"></a>01643                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ae7e835babfe4d8cf566335c711450e8e">IDO2DB_INPUT_DATA_AGGREGATEDSTATUSDATA</a>;
<a name="l01644"></a>01644                                 <span class="keywordflow">break</span>;
<a name="l01645"></a>01645                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a2bd5ed469bdc58f3c90f29674812c082">IDO_API_RETENTIONDATA</a>:
<a name="l01646"></a>01646                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ac8abb120180feb320b4556f572412a0a">IDO2DB_INPUT_DATA_RETENTIONDATA</a>;
<a name="l01647"></a>01647                                 <span class="keywordflow">break</span>;
<a name="l01648"></a>01648                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a1119824e68893cc49278b34a9a5f0d63">IDO_API_CONTACTNOTIFICATIONDATA</a>:
<a name="l01649"></a>01649                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a22281a2b34b2a8f38dae8008dffd427f">IDO2DB_INPUT_DATA_CONTACTNOTIFICATIONDATA</a>;
<a name="l01650"></a>01650                                 <span class="keywordflow">break</span>;
<a name="l01651"></a>01651                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a5d3607ed9ae2f7286b7a20f29d2a2dfa">IDO_API_CONTACTNOTIFICATIONMETHODDATA</a>:
<a name="l01652"></a>01652                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ada595d54cb66460e46c3af6fd66330f7">IDO2DB_INPUT_DATA_CONTACTNOTIFICATIONMETHODDATA</a>;
<a name="l01653"></a>01653                                 <span class="keywordflow">break</span>;
<a name="l01654"></a>01654                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a28bf428e7e4649b9e28bc88e3377d098">IDO_API_ACKNOWLEDGEMENTDATA</a>:
<a name="l01655"></a>01655                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ad2d413760ca1ec56b0d0d3e05c0cf8b9">IDO2DB_INPUT_DATA_ACKNOWLEDGEMENTDATA</a>;
<a name="l01656"></a>01656                                 <span class="keywordflow">break</span>;
<a name="l01657"></a>01657                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a13cd7cd75555de79e4e354ba19781a41">IDO_API_STATECHANGEDATA</a>:
<a name="l01658"></a>01658                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aeaf5acac8867843c04bde64c649cd4a3">IDO2DB_INPUT_DATA_STATECHANGEDATA</a>;
<a name="l01659"></a>01659                                 <span class="keywordflow">break</span>;
<a name="l01660"></a>01660 
<a name="l01661"></a>01661                         <span class="comment">/* config variables */</span>
<a name="l01662"></a>01662                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab92d83168940986633a7e65bc363af83">IDO_API_MAINCONFIGFILEVARIABLES</a>:
<a name="l01663"></a>01663                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a730a5d733ee3a61c4f65bb0b94b08c77">IDO2DB_INPUT_DATA_MAINCONFIGFILEVARIABLES</a>;
<a name="l01664"></a>01664                                 <span class="keywordflow">break</span>;
<a name="l01665"></a>01665                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad8392b407149b9ee9118aa68ad5b2a84">IDO_API_RESOURCECONFIGFILEVARIABLES</a>:
<a name="l01666"></a>01666                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aa91ad13945ed3e7ef5a72a3eca51eac4">IDO2DB_INPUT_DATA_RESOURCECONFIGFILEVARIABLES</a>;
<a name="l01667"></a>01667                                 <span class="keywordflow">break</span>;
<a name="l01668"></a>01668                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a75b7048cfe255c308ecf978bf326f029">IDO_API_CONFIGVARIABLES</a>:
<a name="l01669"></a>01669                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#af25c94aaadcdf06774f4a40bda95447e">IDO2DB_INPUT_DATA_CONFIGVARIABLES</a>;
<a name="l01670"></a>01670                                 <span class="keywordflow">break</span>;
<a name="l01671"></a>01671                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a0993854a21f0b85577d47389809267b6">IDO_API_RUNTIMEVARIABLES</a>:
<a name="l01672"></a>01672                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a63cfc4262d9d589f069864d723c90eb9">IDO2DB_INPUT_DATA_RUNTIMEVARIABLES</a>;
<a name="l01673"></a>01673                                 <span class="keywordflow">break</span>;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675                         <span class="comment">/* object configuration */</span>
<a name="l01676"></a>01676                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a7185e8d58ca68fa2623ea28dcea5f295">IDO_API_HOSTDEFINITION</a>:
<a name="l01677"></a>01677                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a9548a8f244bc4c0ec629c5878f83d49a">IDO2DB_INPUT_DATA_HOSTDEFINITION</a>;
<a name="l01678"></a>01678                                 <span class="keywordflow">break</span>;
<a name="l01679"></a>01679                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a3578a2b6b4922e539f16b611fc6bef07">IDO_API_HOSTGROUPDEFINITION</a>:
<a name="l01680"></a>01680                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ad314d0c45fef6911e9a4dd91280841df">IDO2DB_INPUT_DATA_HOSTGROUPDEFINITION</a>;
<a name="l01681"></a>01681                                 <span class="keywordflow">break</span>;
<a name="l01682"></a>01682                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a3b1766fa10604a2e625dbafe6b6b83d5">IDO_API_SERVICEDEFINITION</a>:
<a name="l01683"></a>01683                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a169571becf6fe1083e762b7808874540">IDO2DB_INPUT_DATA_SERVICEDEFINITION</a>;
<a name="l01684"></a>01684                                 <span class="keywordflow">break</span>;
<a name="l01685"></a>01685                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad21c07aa65190aa3d87a682bb0117d29">IDO_API_SERVICEGROUPDEFINITION</a>:
<a name="l01686"></a>01686                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a660509757ba32b341ee84b57a99c2083">IDO2DB_INPUT_DATA_SERVICEGROUPDEFINITION</a>;
<a name="l01687"></a>01687                                 <span class="keywordflow">break</span>;
<a name="l01688"></a>01688                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ace1063e4e7d20d45e420d307c38979ee">IDO_API_HOSTDEPENDENCYDEFINITION</a>:
<a name="l01689"></a>01689                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#af703687a4f37025d69d20c7a9e359f73">IDO2DB_INPUT_DATA_HOSTDEPENDENCYDEFINITION</a>;
<a name="l01690"></a>01690                                 <span class="keywordflow">break</span>;
<a name="l01691"></a>01691                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a75d264f0d2b5a62f99efe846459e4fed">IDO_API_SERVICEDEPENDENCYDEFINITION</a>:
<a name="l01692"></a>01692                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a324bcbd3e369f5290c48f5dadf431e38">IDO2DB_INPUT_DATA_SERVICEDEPENDENCYDEFINITION</a>;
<a name="l01693"></a>01693                                 <span class="keywordflow">break</span>;
<a name="l01694"></a>01694                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ae4464ad55f5c0671c4a1522992897f91">IDO_API_HOSTESCALATIONDEFINITION</a>:
<a name="l01695"></a>01695                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#ab3fa7b636ac96216a770f76cb46eeeaa">IDO2DB_INPUT_DATA_HOSTESCALATIONDEFINITION</a>;
<a name="l01696"></a>01696                                 <span class="keywordflow">break</span>;
<a name="l01697"></a>01697                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6f54f5d39cc91fcb7c16c87eb9d2e8f5">IDO_API_SERVICEESCALATIONDEFINITION</a>:
<a name="l01698"></a>01698                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a2e52c86b600246690497e92e161482af">IDO2DB_INPUT_DATA_SERVICEESCALATIONDEFINITION</a>;
<a name="l01699"></a>01699                                 <span class="keywordflow">break</span>;
<a name="l01700"></a>01700                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a0f0501da15ed9e4dc191d124268bc9b8">IDO_API_COMMANDDEFINITION</a>:
<a name="l01701"></a>01701                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#aa17be51ed856d24b521ae12e9286b86e">IDO2DB_INPUT_DATA_COMMANDDEFINITION</a>;
<a name="l01702"></a>01702                                 <span class="keywordflow">break</span>;
<a name="l01703"></a>01703                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ae239ff81f9d2f603e254f38e892b35b0">IDO_API_TIMEPERIODDEFINITION</a>:
<a name="l01704"></a>01704                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a132d711ee5c5382d44a46f9f9b6a2cda">IDO2DB_INPUT_DATA_TIMEPERIODDEFINITION</a>;
<a name="l01705"></a>01705                                 <span class="keywordflow">break</span>;
<a name="l01706"></a>01706                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#aac3b32eedf8ea1327f153e6983b01ced">IDO_API_CONTACTDEFINITION</a>:
<a name="l01707"></a>01707                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a3c96b889ad72dc294dbfbd81fdbdea17">IDO2DB_INPUT_DATA_CONTACTDEFINITION</a>;
<a name="l01708"></a>01708                                 <span class="keywordflow">break</span>;
<a name="l01709"></a>01709                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a3e293b1c0129f49e17200d1e0fca7ce8">IDO_API_CONTACTGROUPDEFINITION</a>:
<a name="l01710"></a>01710                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a5dd3bdfbc6ea50a001ee7eff61f6a954">IDO2DB_INPUT_DATA_CONTACTGROUPDEFINITION</a>;
<a name="l01711"></a>01711                                 <span class="keywordflow">break</span>;
<a name="l01712"></a>01712                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a647c20bc6d54ce02f3b07a53b9813ec3">IDO_API_HOSTEXTINFODEFINITION</a>:
<a name="l01713"></a>01713                                 <span class="comment">/* deprecated - merged with host definitions */</span>
<a name="l01714"></a>01714                         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a8832f83bc45337d0e139c9a973fc253a">IDO_API_SERVICEEXTINFODEFINITION</a>:
<a name="l01715"></a>01715                                 <span class="comment">/* deprecated - merged with service definitions */</span>
<a name="l01716"></a>01716                         <span class="keywordflow">default</span>:
<a name="l01717"></a>01717                                 <span class="keywordflow">break</span>;
<a name="l01718"></a>01718                                 }
<a name="l01719"></a>01719 
<a name="l01720"></a>01720                         <span class="comment">/* initialize input data */</span>
<a name="l01721"></a>01721                         <a class="code" href="ido2db_8h.html#a73187baaf63ec3a09e047b92413d91b4">ido2db_start_input_data</a>(idi);
<a name="l01722"></a>01722                         }
<a name="l01723"></a>01723 
<a name="l01724"></a>01724                 <span class="comment">/* we are processing some type of data already... */</span>
<a name="l01725"></a>01725                 <span class="keywordflow">else</span>{
<a name="l01726"></a>01726 
<a name="l01727"></a>01727                         var=strtok(buf,<span class="stringliteral">&quot;=&quot;</span>);
<a name="l01728"></a>01728                         val=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01729"></a>01729 
<a name="l01730"></a>01730                         <span class="comment">/* get the data type */</span>
<a name="l01731"></a>01731                         data_type_long=strtoul(var,NULL,0);
<a name="l01732"></a>01732 
<a name="l01733"></a>01733                         <span class="comment">/* there was an error with the data type - throw it out */</span>
<a name="l01734"></a>01734                         <span class="keywordflow">if</span>(data_type_long==ULONG_MAX &amp;&amp; <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE)
<a name="l01735"></a>01735                                 <span class="keywordflow">break</span>;
<a name="l01736"></a>01736 
<a name="l01737"></a>01737                         data_type=(int)data_type_long;
<a name="l01738"></a>01738 
<a name="l01739"></a>01739                         <span class="comment">/* the current data section is ending... */</span>
<a name="l01740"></a>01740                         <span class="keywordflow">if</span>(data_type==<a class="code" href="protoapi_8h.html#afb49a02615087b9499b78fa0d81dc911">IDO_API_ENDDATA</a>){
<a name="l01741"></a>01741 
<a name="l01742"></a>01742                                 <span class="comment">/* finish current data processing */</span>
<a name="l01743"></a>01743                                 <a class="code" href="ido2db_8h.html#a2a53502607f308fd66122c7d9930e2eb">ido2db_end_input_data</a>(idi);
<a name="l01744"></a>01744 
<a name="l01745"></a>01745                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>=<a class="code" href="ido2db_8h.html#a05d25af73991258d2ee9a8ccb72cab1d">IDO2DB_INPUT_DATA_NONE</a>;
<a name="l01746"></a>01746                                 }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748                         <span class="comment">/* add data for already existing data type... */</span>
<a name="l01749"></a>01749                         <span class="keywordflow">else</span>{
<a name="l01750"></a>01750 
<a name="l01751"></a>01751                                 <span class="comment">/* the data type is out of range - throw it out */</span>
<a name="l01752"></a>01752                                 <span class="keywordflow">if</span>(data_type&gt;<a class="code" href="protoapi_8h.html#a226c26c0bc87fc3edb55886244bc0ed3">IDO_MAX_DATA_TYPES</a>){
<a name="l01753"></a>01753                                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_input() line: %lu, type: %d, VAL: %s\n&quot;</span>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>,data_type,val);
<a name="l01754"></a>01754 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01755"></a>01755 <span class="preprocessor"></span>                                        printf(<span class="stringliteral">&quot;## DISCARD! LINE: %lu, TYPE: %d, VAL: %s\n&quot;</span>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>,data_type,val);
<a name="l01756"></a>01756 <span class="preprocessor">#endif</span>
<a name="l01757"></a>01757 <span class="preprocessor"></span>                                        <span class="keywordflow">break</span>;
<a name="l01758"></a>01758                                         }
<a name="l01759"></a>01759 
<a name="l01760"></a>01760                                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_input() line: %lu, type: %d, VAL: %s\n&quot;</span>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>,data_type,val);
<a name="l01761"></a>01761 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l01762"></a>01762 <span class="preprocessor"></span>                                printf(<span class="stringliteral">&quot;LINE: %lu, TYPE: %d, VAL:%s\n&quot;</span>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a7ae40ad98850f429d421005e08e1f0e8">lines_processed</a>,data_type,val);
<a name="l01763"></a>01763 <span class="preprocessor">#endif</span>
<a name="l01764"></a>01764 <span class="preprocessor"></span>                                <a class="code" href="ido2db_8h.html#a4903aa7f59080e3d03b3fd34eb16a11e">ido2db_add_input_data_item</a>(idi,data_type,val);
<a name="l01765"></a>01765                                 }
<a name="l01766"></a>01766                         }
<a name="l01767"></a>01767 
<a name="l01768"></a>01768                 <span class="keywordflow">break</span>;
<a name="l01769"></a>01769 
<a name="l01770"></a>01770         <span class="keywordflow">default</span>:
<a name="l01771"></a>01771                 <span class="keywordflow">break</span>;
<a name="l01772"></a>01772                 }
<a name="l01773"></a>01773 
<a name="l01774"></a>01774         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_handle_client_input() end\n&quot;</span>);
<a name="l01775"></a>01775         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01776"></a>01776         }
<a name="l01777"></a>01777 
<a name="l01778"></a>01778 
<a name="l01779"></a><a class="code" href="ido2db_8c.html#a145a88c78f350abbe575dce2f156b856">01779</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a73187baaf63ec3a09e047b92413d91b4">ido2db_start_input_data</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi){
<a name="l01780"></a>01780         <span class="keywordtype">int</span> x;
<a name="l01781"></a>01781 
<a name="l01782"></a>01782         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_start_input_data() start\n&quot;</span>);
<a name="l01783"></a>01783 
<a name="l01784"></a>01784         <span class="keywordflow">if</span>(idi==NULL)
<a name="l01785"></a>01785                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01786"></a>01786 
<a name="l01787"></a>01787         <span class="comment">/* sometimes ido2db_end_input_data() isn&#39;t called, so free memory if we find it */</span>
<a name="l01788"></a>01788         <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(idi);
<a name="l01789"></a>01789 
<a name="l01790"></a>01790         <span class="comment">/* allocate memory for holding buffered input */</span>
<a name="l01791"></a>01791         <span class="keywordflow">if</span>((idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>=(<span class="keywordtype">char</span> **)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*<a class="code" href="protoapi_8h.html#a226c26c0bc87fc3edb55886244bc0ed3">IDO_MAX_DATA_TYPES</a>))==NULL)
<a name="l01792"></a>01792                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794         <span class="comment">/* initialize buffered input slots */</span>
<a name="l01795"></a>01795         <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="protoapi_8h.html#a226c26c0bc87fc3edb55886244bc0ed3">IDO_MAX_DATA_TYPES</a>;x++)
<a name="l01796"></a>01796                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[x]=NULL;
<a name="l01797"></a>01797 
<a name="l01798"></a>01798         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_start_input_data() end\n&quot;</span>);
<a name="l01799"></a>01799 
<a name="l01800"></a>01800         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01801"></a>01801         }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803 
<a name="l01804"></a><a class="code" href="ido2db_8c.html#a8c6679f274cf3d1dae206df5e385adf5">01804</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a4903aa7f59080e3d03b3fd34eb16a11e">ido2db_add_input_data_item</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi, <span class="keywordtype">int</span> type, <span class="keywordtype">char</span> *buf){
<a name="l01805"></a>01805         <span class="keywordtype">char</span> *newbuf=NULL;
<a name="l01806"></a>01806         <span class="keywordtype">int</span> mbuf_used=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l01807"></a>01807 
<a name="l01808"></a>01808         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_add_input_data_item() start\n&quot;</span>);
<a name="l01809"></a>01809 
<a name="l01810"></a>01810         <span class="keywordflow">if</span>(idi==NULL)
<a name="l01811"></a>01811                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01812"></a>01812 
<a name="l01813"></a>01813         <span class="comment">/* escape data if necessary */</span>
<a name="l01814"></a>01814         <span class="keywordflow">switch</span>(type){
<a name="l01815"></a>01815 
<a name="l01816"></a>01816         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad8d3de276c4361e82c2352b277fdf3e7">IDO_DATA_ACKAUTHOR</a>:
<a name="l01817"></a>01817         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a423e564a457c280dee4aa194a35e9f14">IDO_DATA_ACKDATA</a>:
<a name="l01818"></a>01818         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab3a119d01ae07a248bd6124a5c629f21">IDO_DATA_AUTHORNAME</a>:
<a name="l01819"></a>01819         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a22c2c55984fe735894800dd7d6291ff5">IDO_DATA_CHECKCOMMAND</a>:
<a name="l01820"></a>01820         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a2009df1a3aaffebe6119b36976b49ee2">IDO_DATA_COMMANDARGS</a>:
<a name="l01821"></a>01821         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a797b41343ddb6ee93294ae3b46734315">IDO_DATA_COMMANDLINE</a>:
<a name="l01822"></a>01822         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ac5c1918bad922e05637cad47ce7a8ad1">IDO_DATA_COMMANDSTRING</a>:
<a name="l01823"></a>01823         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad89736cc384a59b6f243b8426f6a591a">IDO_DATA_COMMENT</a>:
<a name="l01824"></a>01824         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a55a641eb3c07c01454c96b2b5ec3cd20">IDO_DATA_EVENTHANDLER</a>:
<a name="l01825"></a>01825         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a75a5bf22b32552d00e9f8716abddbe05">IDO_DATA_GLOBALHOSTEVENTHANDLER</a>:
<a name="l01826"></a>01826         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a4fb3f40bc2d2afeeeea20fe7488f15b1">IDO_DATA_GLOBALSERVICEEVENTHANDLER</a>:
<a name="l01827"></a>01827         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a2d4dd7c961eff6cb482ae1e3602d1ebc">IDO_DATA_HOST</a>:
<a name="l01828"></a>01828         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ac38e904406aaae2e5e2ba1367ffe1cca">IDO_DATA_LOGENTRY</a>:
<a name="l01829"></a>01829         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a79b9988701ece77b5d4238c52587d9e2">IDO_DATA_OUTPUT</a>:
<a name="l01830"></a>01830         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a7f458d11ea6db92724ab27d4d53687c9">IDO_DATA_LONGOUTPUT</a>:
<a name="l01831"></a>01831         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad9bf2e95ab220a518ceb0b8efe2473c6">IDO_DATA_PERFDATA</a>:
<a name="l01832"></a>01832         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a66fedabedf301d9bfc1c5867cda997db">IDO_DATA_SERVICE</a>:
<a name="l01833"></a>01833         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a0e648a4ba7e96bee86d2111efef55b3e">IDO_DATA_PROGRAMNAME</a>:
<a name="l01834"></a>01834         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#adc3931ef384a3e8176fab2d0a1a7a8d4">IDO_DATA_PROGRAMVERSION</a>:
<a name="l01835"></a>01835         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#aa703803b04dfab92e1cb05b40de545f5">IDO_DATA_PROGRAMDATE</a>:
<a name="l01836"></a>01836 
<a name="l01837"></a>01837         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#acd73f50c26ee48cbf61683f4df596d6b">IDO_DATA_COMMANDNAME</a>:
<a name="l01838"></a>01838         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a7a10468d179339e6c2e20c2e8a861319">IDO_DATA_CONTACTADDRESS</a>:
<a name="l01839"></a>01839         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#aa1cb621c64f4b5b73424f265689c67b9">IDO_DATA_CONTACTALIAS</a>:
<a name="l01840"></a>01840         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6a08def40893965a6bf9ff532721119b">IDO_DATA_CONTACTGROUP</a>:
<a name="l01841"></a>01841         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a64269e7b8e0b3d2006a8a462dfe550b2">IDO_DATA_CONTACTGROUPALIAS</a>:
<a name="l01842"></a>01842         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a3124fe2651872de8c7a9b998cdb8588c">IDO_DATA_CONTACTGROUPMEMBER</a>:
<a name="l01843"></a>01843         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a77efcd7b912af77396f445dc7984978f">IDO_DATA_CONTACTGROUPNAME</a>:
<a name="l01844"></a>01844         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a40c2b39a2d3512c80cfbd7bfebc2a4d3">IDO_DATA_CONTACTNAME</a>:
<a name="l01845"></a>01845         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9965ca221d5f5c1de3240da206b904f0">IDO_DATA_DEPENDENTHOSTNAME</a>:
<a name="l01846"></a>01846         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a30147797366073ad27ade5e6413510e1">IDO_DATA_DEPENDENTSERVICEDESCRIPTION</a>:
<a name="l01847"></a>01847         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a139c55155142d13bc5b9fe052441ded4">IDO_DATA_DISPLAYNAME</a>:
<a name="l01848"></a>01848         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a291463e93a0feb6ac4d551764dd88c2c">IDO_DATA_EMAILADDRESS</a>:
<a name="l01849"></a>01849         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a7db32a6dd916a25282e85959d10e8c3c">IDO_DATA_HOSTADDRESS</a>:
<a name="l01850"></a>01850         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#af4455d12644a801619e6c563412f769b">IDO_DATA_HOSTADDRESS6</a>:
<a name="l01851"></a>01851         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6c3375377b434bdf798fa8faa5976176">IDO_DATA_HOSTALIAS</a>:
<a name="l01852"></a>01852         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a44b0ddf963160ea7707b3e6f0696e926">IDO_DATA_HOSTCHECKCOMMAND</a>:
<a name="l01853"></a>01853         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#aec31295096f9bf4492afe73b6e2526c3">IDO_DATA_HOSTCHECKPERIOD</a>:
<a name="l01854"></a>01854         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ade530a50304eaa76b16f6079b0e55027">IDO_DATA_HOSTEVENTHANDLER</a>:
<a name="l01855"></a>01855         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#af2977841e6ec42b58d390085ea33ad85">IDO_DATA_HOSTFAILUREPREDICTIONOPTIONS</a>:
<a name="l01856"></a>01856         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a65351f88715817db5399c29c9414c5ae">IDO_DATA_HOSTGROUPALIAS</a>:
<a name="l01857"></a>01857         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ae9293d7eb3b513027598619f792804ed">IDO_DATA_HOSTGROUPMEMBER</a>:
<a name="l01858"></a>01858         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#aa13ca861c4c42dcee6880f3ac6188305">IDO_DATA_HOSTGROUPNAME</a>:
<a name="l01859"></a>01859         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a32c7170240c599870c27a68cbf9f6905">IDO_DATA_HOSTNAME</a>:
<a name="l01860"></a>01860         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab89f64609ef3c57894ac9ff6a5ba279e">IDO_DATA_HOSTNOTIFICATIONCOMMAND</a>:
<a name="l01861"></a>01861         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a345b83ae8b53cb4f6125542d5af78b0b">IDO_DATA_HOSTNOTIFICATIONPERIOD</a>:
<a name="l01862"></a>01862         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a7aeaa260796ad6faae516e10235874f2">IDO_DATA_PAGERADDRESS</a>:
<a name="l01863"></a>01863         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a37ebf5eefdf1d71f77cc45c24434481d">IDO_DATA_PARENTHOST</a>:
<a name="l01864"></a>01864         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#abc63d8788278933d8a3d90833abf2e1e">IDO_DATA_SERVICECHECKCOMMAND</a>:
<a name="l01865"></a>01865         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#af5fb3e7eb1ff17577a87f65c3015ada9">IDO_DATA_SERVICECHECKPERIOD</a>:
<a name="l01866"></a>01866         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#acc3d90e6fffd03d9fdcb041861fd0547">IDO_DATA_SERVICEDESCRIPTION</a>:
<a name="l01867"></a>01867         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a8b9b5d1cddc93a1551927fb5ddc2741e">IDO_DATA_SERVICEEVENTHANDLER</a>:
<a name="l01868"></a>01868         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a52a40ecd98f2c478eba7f6ce63098227">IDO_DATA_SERVICEFAILUREPREDICTIONOPTIONS</a>:
<a name="l01869"></a>01869         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a0e8589a12d6faecd006141507a8ec95e">IDO_DATA_SERVICEGROUPALIAS</a>:
<a name="l01870"></a>01870         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#adefc8cccfc19e04c4b251679233c3fcf">IDO_DATA_SERVICEGROUPMEMBER</a>:
<a name="l01871"></a>01871         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#aff2a0a90811ef8059db96fb53bf99acc">IDO_DATA_SERVICEGROUPNAME</a>:
<a name="l01872"></a>01872         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab68c15f320ee8130b436a971b505a473">IDO_DATA_SERVICENOTIFICATIONCOMMAND</a>:
<a name="l01873"></a>01873         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ad70f6eb08d149a68c59445dbcd78888d">IDO_DATA_SERVICENOTIFICATIONPERIOD</a>:
<a name="l01874"></a>01874         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a75e53a5750d4c5c4e79a45a69d7aa22e">IDO_DATA_TIMEPERIODALIAS</a>:
<a name="l01875"></a>01875         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a05fa7c06b7224a6e8d5e00dea82c5f28">IDO_DATA_TIMEPERIODNAME</a>:
<a name="l01876"></a>01876         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a1e903248c23198f57d9517e8c36eb5e5">IDO_DATA_TIMERANGE</a>:
<a name="l01877"></a>01877 
<a name="l01878"></a>01878         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a47f3097fb0374a8189cd824f269d294f">IDO_DATA_ACTIONURL</a>:
<a name="l01879"></a>01879         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9cf705618ebc48d5942544445868d032">IDO_DATA_ICONIMAGE</a>:
<a name="l01880"></a>01880         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9748567b4990501cab0f89b396da10ed">IDO_DATA_ICONIMAGEALT</a>:
<a name="l01881"></a>01881         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#abe570b69e2c1ae1c3d5ec91ac64e2f8a">IDO_DATA_NOTES</a>:
<a name="l01882"></a>01882         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9167bd25bc9f76510c8a22bbdfc4e870">IDO_DATA_NOTESURL</a>:
<a name="l01883"></a>01883         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9ae5462d1599a5f76a71c3c19ac5c280">IDO_DATA_CUSTOMVARIABLE</a>:
<a name="l01884"></a>01884         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#afb0d9641d9aa3e123193694f89a72208">IDO_DATA_CONTACT</a>:
<a name="l01885"></a>01885 
<a name="l01886"></a>01886                 <span class="comment">/* strings are escaped when they arrive */</span>
<a name="l01887"></a>01887                 <span class="keywordflow">if</span>(buf==NULL)
<a name="l01888"></a>01888                         newbuf=strdup(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01889"></a>01889                 <span class="keywordflow">else</span>
<a name="l01890"></a>01890                         newbuf=strdup(buf);
<a name="l01891"></a>01891                 <a class="code" href="io_8h.html#aec2ca0b7f1b4298a9f11c90db36ef398">ido_unescape_buffer</a>(newbuf);
<a name="l01892"></a>01892                 <span class="keywordflow">break</span>;
<a name="l01893"></a>01893 
<a name="l01894"></a>01894         <span class="keywordflow">default</span>:
<a name="l01895"></a>01895 
<a name="l01896"></a>01896                 <span class="comment">/* data hasn&#39;t been escaped */</span>
<a name="l01897"></a>01897                 <span class="keywordflow">if</span>(buf==NULL)
<a name="l01898"></a>01898                         newbuf=strdup(<span class="stringliteral">&quot;&quot;</span>);
<a name="l01899"></a>01899                 <span class="keywordflow">else</span>
<a name="l01900"></a>01900                         newbuf=strdup(buf);
<a name="l01901"></a>01901                 <span class="keywordflow">break</span>;
<a name="l01902"></a>01902                 }
<a name="l01903"></a>01903 
<a name="l01904"></a>01904         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_add_input_data_item(%s)\n&quot;</span>, newbuf);
<a name="l01905"></a>01905 
<a name="l01906"></a>01906         <span class="comment">/* check for errors */</span>
<a name="l01907"></a>01907         <span class="keywordflow">if</span>(newbuf==NULL){
<a name="l01908"></a>01908                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_add_input_data_item() allocation error\n&quot;</span>);
<a name="l01909"></a>01909 <span class="preprocessor">#ifdef DEBUG_IDO2DB</span>
<a name="l01910"></a>01910 <span class="preprocessor"></span>                printf(<span class="stringliteral">&quot;ALLOCATION ERROR\n&quot;</span>);
<a name="l01911"></a>01911 <span class="preprocessor">#endif</span>
<a name="l01912"></a>01912 <span class="preprocessor"></span>                <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01913"></a>01913                 }
<a name="l01914"></a>01914 
<a name="l01915"></a>01915         <span class="comment">/* store the buffered data */</span>
<a name="l01916"></a>01916         <span class="keywordflow">switch</span>(type){
<a name="l01917"></a>01917 
<a name="l01918"></a>01918         <span class="comment">/* special case for data items that may appear multiple times */</span>
<a name="l01919"></a>01919         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a6a08def40893965a6bf9ff532721119b">IDO_DATA_CONTACTGROUP</a>:
<a name="l01920"></a>01920                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a4279e6d2545e8bc40051b7a99c9f532d">IDO2DB_MBUF_CONTACTGROUP</a>,newbuf);
<a name="l01921"></a>01921                 <span class="keywordflow">break</span>;
<a name="l01922"></a>01922         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a3124fe2651872de8c7a9b998cdb8588c">IDO_DATA_CONTACTGROUPMEMBER</a>:
<a name="l01923"></a>01923                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#ae309845b3c437efa5537543204d84678">IDO2DB_MBUF_CONTACTGROUPMEMBER</a>,newbuf);
<a name="l01924"></a>01924                 <span class="keywordflow">break</span>;
<a name="l01925"></a>01925         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#adefc8cccfc19e04c4b251679233c3fcf">IDO_DATA_SERVICEGROUPMEMBER</a>:
<a name="l01926"></a>01926                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a935ab4ca5cd336472560f82caa7ed554">IDO2DB_MBUF_SERVICEGROUPMEMBER</a>,newbuf);
<a name="l01927"></a>01927                 <span class="keywordflow">break</span>;
<a name="l01928"></a>01928         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ae9293d7eb3b513027598619f792804ed">IDO_DATA_HOSTGROUPMEMBER</a>:
<a name="l01929"></a>01929                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a0ac94f21442ff174581b8b53d2b104c5">IDO2DB_MBUF_HOSTGROUPMEMBER</a>,newbuf);
<a name="l01930"></a>01930                 <span class="keywordflow">break</span>;
<a name="l01931"></a>01931         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab68c15f320ee8130b436a971b505a473">IDO_DATA_SERVICENOTIFICATIONCOMMAND</a>:
<a name="l01932"></a>01932                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a55b03b10653684806fbc1a81681937c2">IDO2DB_MBUF_SERVICENOTIFICATIONCOMMAND</a>,newbuf);
<a name="l01933"></a>01933                 <span class="keywordflow">break</span>;
<a name="l01934"></a>01934         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#ab89f64609ef3c57894ac9ff6a5ba279e">IDO_DATA_HOSTNOTIFICATIONCOMMAND</a>:
<a name="l01935"></a>01935                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a360dc29496bae0f64d4873d16b032686">IDO2DB_MBUF_HOSTNOTIFICATIONCOMMAND</a>,newbuf);
<a name="l01936"></a>01936                 <span class="keywordflow">break</span>;
<a name="l01937"></a>01937         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a7a10468d179339e6c2e20c2e8a861319">IDO_DATA_CONTACTADDRESS</a>:
<a name="l01938"></a>01938                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a39d69fd3ddedfc086254c5b2c6eadbdc">IDO2DB_MBUF_CONTACTADDRESS</a>,newbuf);
<a name="l01939"></a>01939                 <span class="keywordflow">break</span>;
<a name="l01940"></a>01940         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a1e903248c23198f57d9517e8c36eb5e5">IDO_DATA_TIMERANGE</a>:
<a name="l01941"></a>01941                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a64f779293e5877c1f1eb06474466e8df">IDO2DB_MBUF_TIMERANGE</a>,newbuf);
<a name="l01942"></a>01942                 <span class="keywordflow">break</span>;
<a name="l01943"></a>01943         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a37ebf5eefdf1d71f77cc45c24434481d">IDO_DATA_PARENTHOST</a>:
<a name="l01944"></a>01944                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#af76cd92f650033e9f11161213dc9613f">IDO2DB_MBUF_PARENTHOST</a>,newbuf);
<a name="l01945"></a>01945                 <span class="keywordflow">break</span>;
<a name="l01946"></a>01946         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#adf48768490a447b139c02ca7379db0a4">IDO_DATA_CONFIGFILEVARIABLE</a>:
<a name="l01947"></a>01947                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#aa6196a0ae2da52545fbc23945af199b7">IDO2DB_MBUF_CONFIGFILEVARIABLE</a>,newbuf);
<a name="l01948"></a>01948                 <span class="keywordflow">break</span>;
<a name="l01949"></a>01949         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a4cc95324048ceb90764766a46766f95f">IDO_DATA_CONFIGVARIABLE</a>:
<a name="l01950"></a>01950                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a558d8c64d298bff57fd244b599ded571">IDO2DB_MBUF_CONFIGVARIABLE</a>,newbuf);
<a name="l01951"></a>01951                 <span class="keywordflow">break</span>;
<a name="l01952"></a>01952         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a17f69a6b1639b2d56e3dbf6df230081c">IDO_DATA_RUNTIMEVARIABLE</a>:
<a name="l01953"></a>01953                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#a14fe6a4a7a34b260260dc32bafc1d240">IDO2DB_MBUF_RUNTIMEVARIABLE</a>,newbuf);
<a name="l01954"></a>01954                 <span class="keywordflow">break</span>;
<a name="l01955"></a>01955         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#a9ae5462d1599a5f76a71c3c19ac5c280">IDO_DATA_CUSTOMVARIABLE</a>:
<a name="l01956"></a>01956                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#aa16eff6c0277456dfd0158ac0d43514a">IDO2DB_MBUF_CUSTOMVARIABLE</a>,newbuf);
<a name="l01957"></a>01957                 <span class="keywordflow">break</span>;
<a name="l01958"></a>01958         <span class="keywordflow">case</span> <a class="code" href="protoapi_8h.html#afb0d9641d9aa3e123193694f89a72208">IDO_DATA_CONTACT</a>:
<a name="l01959"></a>01959                 <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(idi,type,<a class="code" href="ido2db_8h.html#ad795689ce39f38d1b0eecb768faf192c">IDO2DB_MBUF_CONTACT</a>,newbuf);
<a name="l01960"></a>01960                 <span class="keywordflow">break</span>;
<a name="l01961"></a>01961 
<a name="l01962"></a>01962         <span class="comment">/* NORMAL DATA */</span>
<a name="l01963"></a>01963         <span class="comment">/* normal data items appear only once per data type */</span>
<a name="l01964"></a>01964         <span class="keywordflow">default</span>:
<a name="l01965"></a>01965 
<a name="l01966"></a>01966                 mbuf_used=<a class="code" href="module_2idoutils_2include_2common_8h.html#af609ab4b282d85d9fab8025f5b2b66c1">IDO_FALSE</a>;
<a name="l01967"></a>01967 
<a name="l01968"></a>01968                 <span class="comment">/* if there was already a matching item, discard the old one */</span>
<a name="l01969"></a>01969                 <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[type]!=NULL){
<a name="l01970"></a>01970                         free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[type]);
<a name="l01971"></a>01971                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[type]=NULL;
<a name="l01972"></a>01972                         }
<a name="l01973"></a>01973 
<a name="l01974"></a>01974                 <span class="comment">/* save buffered item */</span>
<a name="l01975"></a>01975                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[type]=newbuf;
<a name="l01976"></a>01976                 }
<a name="l01977"></a>01977 
<a name="l01978"></a>01978         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_start_input_data() end\n&quot;</span>);
<a name="l01979"></a>01979         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l01980"></a>01980         }
<a name="l01981"></a>01981 
<a name="l01982"></a>01982 
<a name="l01983"></a>01983 
<a name="l01984"></a><a class="code" href="ido2db_8c.html#a5194af7ec6201e6a3451855bfa2ae475">01984</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#af834369d8292619b4a994e251e233594">ido2db_add_input_data_mbuf</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> mbuf_slot, <span class="keywordtype">char</span> *buf){
<a name="l01985"></a>01985         <span class="keywordtype">int</span> allocation_chunk=80;
<a name="l01986"></a>01986         <span class="keywordtype">char</span> **newbuffer=NULL;
<a name="l01987"></a>01987 
<a name="l01988"></a>01988         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_add_input_data_mbuf() start\n&quot;</span>);
<a name="l01989"></a>01989 
<a name="l01990"></a>01990         <span class="keywordflow">if</span>(idi==NULL || buf==NULL)
<a name="l01991"></a>01991                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01992"></a>01992 
<a name="l01993"></a>01993         <span class="keywordflow">if</span>(mbuf_slot&gt;=<a class="code" href="ido2db_8h.html#aae764517d9446fd4d3524d344190b874">IDO2DB_MAX_MBUF_ITEMS</a>)
<a name="l01994"></a>01994                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l01995"></a>01995 
<a name="l01996"></a>01996         <span class="comment">/* create buffer */</span>
<a name="l01997"></a>01997         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>==NULL){
<a name="l01998"></a>01998 <span class="preprocessor">#ifdef IDO2DB_DEBUG_MBUF</span>
<a name="l01999"></a>01999 <span class="preprocessor"></span>                mbuf_bytes_allocated+=<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*allocation_chunk;
<a name="l02000"></a>02000                 printf(<span class="stringliteral">&quot;MBUF INITIAL ALLOCATION (MBUF = %lu bytes)\n&quot;</span>,mbuf_bytes_allocated);
<a name="l02001"></a>02001 <span class="preprocessor">#endif</span>
<a name="l02002"></a>02002 <span class="preprocessor"></span>                idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>=(<span class="keywordtype">char</span> **)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*allocation_chunk);
<a name="l02003"></a>02003                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a167eb3433ec458d100d88de5a3fdea1a">allocated_lines</a>+=allocation_chunk;
<a name="l02004"></a>02004                 }
<a name="l02005"></a>02005 
<a name="l02006"></a>02006         <span class="comment">/* expand buffer */</span>
<a name="l02007"></a>02007         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a599c5a116f9cbbf65365bec52c99f962">used_lines</a>==idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a167eb3433ec458d100d88de5a3fdea1a">allocated_lines</a>){
<a name="l02008"></a>02008                 newbuffer=(<span class="keywordtype">char</span> **)realloc(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a167eb3433ec458d100d88de5a3fdea1a">allocated_lines</a>+allocation_chunk));
<a name="l02009"></a>02009                 <span class="keywordflow">if</span>(newbuffer==NULL)
<a name="l02010"></a>02010                         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02011"></a>02011 <span class="preprocessor">#ifdef IDO2DB_DEBUG_MBUF</span>
<a name="l02012"></a>02012 <span class="preprocessor"></span>                mbuf_bytes_allocated+=<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *)*allocation_chunk;
<a name="l02013"></a>02013                 printf(<span class="stringliteral">&quot;MBUF RESIZED (MBUF = %lu bytes)\n&quot;</span>,mbuf_bytes_allocated);
<a name="l02014"></a>02014 <span class="preprocessor">#endif</span>
<a name="l02015"></a>02015 <span class="preprocessor"></span>                idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>=newbuffer;
<a name="l02016"></a>02016                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a167eb3433ec458d100d88de5a3fdea1a">allocated_lines</a>+=allocation_chunk;
<a name="l02017"></a>02017                 }
<a name="l02018"></a>02018 
<a name="l02019"></a>02019         <span class="comment">/* store the data */</span>
<a name="l02020"></a>02020         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>){
<a name="l02021"></a>02021                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>[idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a599c5a116f9cbbf65365bec52c99f962">used_lines</a>]=buf;
<a name="l02022"></a>02022                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[mbuf_slot].<a class="code" href="structido2db__mbuf__struct.html#a599c5a116f9cbbf65365bec52c99f962">used_lines</a>++;
<a name="l02023"></a>02023                 }
<a name="l02024"></a>02024         <span class="keywordflow">else</span>
<a name="l02025"></a>02025                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02026"></a>02026 
<a name="l02027"></a>02027         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_add_input_data_mbuf() end\n&quot;</span>);
<a name="l02028"></a>02028         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02029"></a>02029         }
<a name="l02030"></a>02030 
<a name="l02031"></a>02031 
<a name="l02032"></a>02032 
<a name="l02033"></a><a class="code" href="ido2db_8c.html#a367e53516a507f3cbc6075cbc17db49c">02033</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a2a53502607f308fd66122c7d9930e2eb">ido2db_end_input_data</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi){
<a name="l02034"></a>02034         <span class="keywordtype">int</span> result=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02035"></a>02035 
<a name="l02036"></a>02036         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_end_input_data() start\n&quot;</span>);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038         <span class="keywordflow">if</span>(idi==NULL)
<a name="l02039"></a>02039                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02040"></a>02040 
<a name="l02041"></a>02041         <span class="comment">/* update db stats occassionally */</span>
<a name="l02042"></a>02042         <span class="keywordflow">if</span>(<a class="code" href="db_8c.html#a3eec52d9d22159ce1967677e33516992">ido2db_db_last_checkin_time</a>&lt;(time(NULL)-60))
<a name="l02043"></a>02043                 <a class="code" href="db_8h.html#a7c8564c35fd2fb2fc97414dc85d37a6c">ido2db_db_checkin</a>(idi);
<a name="l02044"></a>02044 
<a name="l02045"></a>02045 <span class="preprocessor">#ifdef DEBUG_IDO2DB2</span>
<a name="l02046"></a>02046 <span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;HANDLING TYPE: %d\n&quot;</span>,idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>);
<a name="l02047"></a>02047 <span class="preprocessor">#endif</span>
<a name="l02048"></a>02048 <span class="preprocessor"></span>
<a name="l02049"></a>02049         <span class="keywordflow">switch</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa145bd79bf18b4af3b322746410a28ef">current_input_data</a>){
<a name="l02050"></a>02050 
<a name="l02051"></a>02051         <span class="comment">/* archived log entries */</span>
<a name="l02052"></a>02052         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ae55f7551c60a4fc595aced690e766b91">IDO2DB_INPUT_DATA_LOGENTRY</a>:
<a name="l02053"></a>02053                 result=<a class="code" href="dbhandlers_8h.html#a1fa8eda1b5ac6d556f4f13f2f41d3fe1">ido2db_handle_logentry</a>(idi);
<a name="l02054"></a>02054                 <span class="keywordflow">break</span>;
<a name="l02055"></a>02055 
<a name="l02056"></a>02056         <span class="comment">/* realtime Icinga data */</span>
<a name="l02057"></a>02057         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aba6dcd19e88227ffa1b76cc816470783">IDO2DB_INPUT_DATA_PROCESSDATA</a>:
<a name="l02058"></a>02058                 result=<a class="code" href="dbhandlers_8h.html#a265413e86a79e48ee9c260d8ae092ce7">ido2db_handle_processdata</a>(idi);
<a name="l02059"></a>02059                 <span class="keywordflow">break</span>;
<a name="l02060"></a>02060         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a463900824595d351ffdac6f3663509ce">IDO2DB_INPUT_DATA_TIMEDEVENTDATA</a>:
<a name="l02061"></a>02061                 result=<a class="code" href="dbhandlers_8h.html#a7e66efc0c2acdc202c3a0d2dfffc7d05">ido2db_handle_timedeventdata</a>(idi);
<a name="l02062"></a>02062                 <span class="keywordflow">break</span>;
<a name="l02063"></a>02063         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a45e4da936e8dc297f0f3b4ccefce3475">IDO2DB_INPUT_DATA_LOGDATA</a>:
<a name="l02064"></a>02064                 result=<a class="code" href="dbhandlers_8h.html#a61daa3b732e0a9150e927f076aabb4b2">ido2db_handle_logdata</a>(idi);
<a name="l02065"></a>02065                 <span class="keywordflow">break</span>;
<a name="l02066"></a>02066         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a98a0644960497c978f1dad0ddf329e42">IDO2DB_INPUT_DATA_SYSTEMCOMMANDDATA</a>:
<a name="l02067"></a>02067                 result=<a class="code" href="dbhandlers_8h.html#a69c6cd373e7c8ddeb1bd7e93afc0db44">ido2db_handle_systemcommanddata</a>(idi);
<a name="l02068"></a>02068                 <span class="keywordflow">break</span>;
<a name="l02069"></a>02069         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aa4c52e4f2d70f1b2187f014215515914">IDO2DB_INPUT_DATA_EVENTHANDLERDATA</a>:
<a name="l02070"></a>02070                 result=<a class="code" href="dbhandlers_8h.html#ad3ca333ba3fc4c5ba63acebeaf692bc6">ido2db_handle_eventhandlerdata</a>(idi);
<a name="l02071"></a>02071                 <span class="keywordflow">break</span>;
<a name="l02072"></a>02072         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ae12c0ae2e47689c515e2fb2eff843580">IDO2DB_INPUT_DATA_NOTIFICATIONDATA</a>:
<a name="l02073"></a>02073                 result=<a class="code" href="dbhandlers_8h.html#ae28d993e3a50a82bd62a222a5f4fd656">ido2db_handle_notificationdata</a>(idi);
<a name="l02074"></a>02074                 <span class="keywordflow">break</span>;
<a name="l02075"></a>02075         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aa89e2e5facd49e1fc4bdc8d6005429a5">IDO2DB_INPUT_DATA_SERVICECHECKDATA</a>:
<a name="l02076"></a>02076                 result=<a class="code" href="dbhandlers_8h.html#a3c556f200d852ba2876e607c47705d0c">ido2db_handle_servicecheckdata</a>(idi);
<a name="l02077"></a>02077                 <span class="keywordflow">break</span>;
<a name="l02078"></a>02078         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a976d5a798ac05f29e974c41efe1fa1c3">IDO2DB_INPUT_DATA_HOSTCHECKDATA</a>:
<a name="l02079"></a>02079                 result=<a class="code" href="dbhandlers_8h.html#ae595af2aaa32385cc6d00e44f800fb6b">ido2db_handle_hostcheckdata</a>(idi);
<a name="l02080"></a>02080                 <span class="keywordflow">break</span>;
<a name="l02081"></a>02081         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a077d61efa1bd4c83a9b8af2de64d9f42">IDO2DB_INPUT_DATA_COMMENTDATA</a>:
<a name="l02082"></a>02082                 result=<a class="code" href="dbhandlers_8h.html#a9a87d4b6a924239f30dda5c04d1957b4">ido2db_handle_commentdata</a>(idi);
<a name="l02083"></a>02083                 <span class="keywordflow">break</span>;
<a name="l02084"></a>02084         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a07d1af5133054388c727466f068ca287">IDO2DB_INPUT_DATA_DOWNTIMEDATA</a>:
<a name="l02085"></a>02085                 result=<a class="code" href="dbhandlers_8h.html#a07f86cd19c992dc2e4f33d1540d9b740">ido2db_handle_downtimedata</a>(idi);
<a name="l02086"></a>02086                 <span class="keywordflow">break</span>;
<a name="l02087"></a>02087         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a4b685ff934743579170dff79611cc4d9">IDO2DB_INPUT_DATA_FLAPPINGDATA</a>:
<a name="l02088"></a>02088                 result=<a class="code" href="dbhandlers_8h.html#a12f66048ed78d39fea7aa572a2905e64">ido2db_handle_flappingdata</a>(idi);
<a name="l02089"></a>02089                 <span class="keywordflow">break</span>;
<a name="l02090"></a>02090         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a5a3d56e7511365ed4eae9f03ac56b270">IDO2DB_INPUT_DATA_PROGRAMSTATUSDATA</a>:
<a name="l02091"></a>02091                 result=<a class="code" href="dbhandlers_8h.html#ae9526c9bed21da2c6327af97cc09ebb7">ido2db_handle_programstatusdata</a>(idi);
<a name="l02092"></a>02092                 <span class="keywordflow">break</span>;
<a name="l02093"></a>02093         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ab522462670d3ebebaa6a4d269281758e">IDO2DB_INPUT_DATA_HOSTSTATUSDATA</a>:
<a name="l02094"></a>02094                 result=<a class="code" href="dbhandlers_8h.html#a1c2d73fc7d56ea3f54d9cb8c940dad05">ido2db_handle_hoststatusdata</a>(idi);
<a name="l02095"></a>02095                 <span class="keywordflow">break</span>;
<a name="l02096"></a>02096         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a45290b363ae9831633b91f534622f59b">IDO2DB_INPUT_DATA_SERVICESTATUSDATA</a>:
<a name="l02097"></a>02097                 result=<a class="code" href="dbhandlers_8h.html#aa6e2039771e6a690a6cf1e00bc4c2e6f">ido2db_handle_servicestatusdata</a>(idi);
<a name="l02098"></a>02098                 <span class="keywordflow">break</span>;
<a name="l02099"></a>02099         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aabe3325ec54f9f7b088472dee377cf1a">IDO2DB_INPUT_DATA_CONTACTSTATUSDATA</a>:
<a name="l02100"></a>02100                 result=<a class="code" href="dbhandlers_8h.html#af60b3c97ac5786600debc46a9a8ca095">ido2db_handle_contactstatusdata</a>(idi);
<a name="l02101"></a>02101                 <span class="keywordflow">break</span>;
<a name="l02102"></a>02102         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ab7e5d392fdd136f751a90547c99b9fbd">IDO2DB_INPUT_DATA_ADAPTIVEPROGRAMDATA</a>:
<a name="l02103"></a>02103                 result=<a class="code" href="dbhandlers_8h.html#aeeb74642f5cddcba45527e753a58cedb">ido2db_handle_adaptiveprogramdata</a>(idi);
<a name="l02104"></a>02104                 <span class="keywordflow">break</span>;
<a name="l02105"></a>02105         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aad2ec0da03b42f2c0ea1570994449595">IDO2DB_INPUT_DATA_ADAPTIVEHOSTDATA</a>:
<a name="l02106"></a>02106                 result=<a class="code" href="dbhandlers_8h.html#a7a4c16f1e8baaaf0b2a7f59a4c358f09">ido2db_handle_adaptivehostdata</a>(idi);
<a name="l02107"></a>02107                 <span class="keywordflow">break</span>;
<a name="l02108"></a>02108         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a17180271e2111c8661be53092ab671b6">IDO2DB_INPUT_DATA_ADAPTIVESERVICEDATA</a>:
<a name="l02109"></a>02109                 result=<a class="code" href="dbhandlers_8h.html#a363f7855e1965235d276f291a03bfa25">ido2db_handle_adaptiveservicedata</a>(idi);
<a name="l02110"></a>02110                 <span class="keywordflow">break</span>;
<a name="l02111"></a>02111         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a82c67be65acc2c0b017245c2c9d46d19">IDO2DB_INPUT_DATA_ADAPTIVECONTACTDATA</a>:
<a name="l02112"></a>02112                 result=<a class="code" href="dbhandlers_8h.html#ab525ccef268602db3705855e0d20f5ee">ido2db_handle_adaptivecontactdata</a>(idi);
<a name="l02113"></a>02113                 <span class="keywordflow">break</span>;
<a name="l02114"></a>02114         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aa51473e1cf440375b8b2820778573585">IDO2DB_INPUT_DATA_EXTERNALCOMMANDDATA</a>:
<a name="l02115"></a>02115                 result=<a class="code" href="dbhandlers_8h.html#a468b742aca0e3b5cf98b41c994351d41">ido2db_handle_externalcommanddata</a>(idi);
<a name="l02116"></a>02116                 <span class="keywordflow">break</span>;
<a name="l02117"></a>02117         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ae7e835babfe4d8cf566335c711450e8e">IDO2DB_INPUT_DATA_AGGREGATEDSTATUSDATA</a>:
<a name="l02118"></a>02118                 result=<a class="code" href="dbhandlers_8h.html#a6e7f1914cbdfc34ab3b10011d752889d">ido2db_handle_aggregatedstatusdata</a>(idi);
<a name="l02119"></a>02119                 <span class="keywordflow">break</span>;
<a name="l02120"></a>02120         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ac8abb120180feb320b4556f572412a0a">IDO2DB_INPUT_DATA_RETENTIONDATA</a>:
<a name="l02121"></a>02121                 result=<a class="code" href="dbhandlers_8h.html#a7057ae39a1469c682c91695465271edb">ido2db_handle_retentiondata</a>(idi);
<a name="l02122"></a>02122                 <span class="keywordflow">break</span>;
<a name="l02123"></a>02123         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a22281a2b34b2a8f38dae8008dffd427f">IDO2DB_INPUT_DATA_CONTACTNOTIFICATIONDATA</a>:
<a name="l02124"></a>02124                 result=<a class="code" href="dbhandlers_8h.html#a91473a0ea241034a01bbbaee70f14597">ido2db_handle_contactnotificationdata</a>(idi);
<a name="l02125"></a>02125                 <span class="keywordflow">break</span>;
<a name="l02126"></a>02126         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ada595d54cb66460e46c3af6fd66330f7">IDO2DB_INPUT_DATA_CONTACTNOTIFICATIONMETHODDATA</a>:
<a name="l02127"></a>02127                 result=<a class="code" href="dbhandlers_8h.html#a24b96025fca04718c0ded724ad391d85">ido2db_handle_contactnotificationmethoddata</a>(idi);
<a name="l02128"></a>02128                 <span class="keywordflow">break</span>;
<a name="l02129"></a>02129         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ad2d413760ca1ec56b0d0d3e05c0cf8b9">IDO2DB_INPUT_DATA_ACKNOWLEDGEMENTDATA</a>:
<a name="l02130"></a>02130                 result=<a class="code" href="dbhandlers_8h.html#a2e4a9f74f7c4ded0b66a828908d06580">ido2db_handle_acknowledgementdata</a>(idi);
<a name="l02131"></a>02131                 <span class="keywordflow">break</span>;
<a name="l02132"></a>02132         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aeaf5acac8867843c04bde64c649cd4a3">IDO2DB_INPUT_DATA_STATECHANGEDATA</a>:
<a name="l02133"></a>02133                 result=<a class="code" href="dbhandlers_8h.html#a22f3b36ef74cd543598d36d617af92f4">ido2db_handle_statechangedata</a>(idi);
<a name="l02134"></a>02134                 <span class="keywordflow">break</span>;
<a name="l02135"></a>02135 
<a name="l02136"></a>02136         <span class="comment">/* config file and variable dumps */</span>
<a name="l02137"></a>02137         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a730a5d733ee3a61c4f65bb0b94b08c77">IDO2DB_INPUT_DATA_MAINCONFIGFILEVARIABLES</a>:
<a name="l02138"></a>02138                 result=<a class="code" href="dbhandlers_8h.html#a9ac6951263817f97aef4d5ca65b38508">ido2db_handle_configfilevariables</a>(idi,0);
<a name="l02139"></a>02139                 <span class="keywordflow">break</span>;
<a name="l02140"></a>02140         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aa91ad13945ed3e7ef5a72a3eca51eac4">IDO2DB_INPUT_DATA_RESOURCECONFIGFILEVARIABLES</a>:
<a name="l02141"></a>02141                 result=<a class="code" href="dbhandlers_8h.html#a9ac6951263817f97aef4d5ca65b38508">ido2db_handle_configfilevariables</a>(idi,1);
<a name="l02142"></a>02142                 <span class="keywordflow">break</span>;
<a name="l02143"></a>02143         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#af25c94aaadcdf06774f4a40bda95447e">IDO2DB_INPUT_DATA_CONFIGVARIABLES</a>:
<a name="l02144"></a>02144                 result=<a class="code" href="dbhandlers_8h.html#ad49c4ebeb4cc067f01cb58390fe8488f">ido2db_handle_configvariables</a>(idi);
<a name="l02145"></a>02145                 <span class="keywordflow">break</span>;
<a name="l02146"></a>02146         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a63cfc4262d9d589f069864d723c90eb9">IDO2DB_INPUT_DATA_RUNTIMEVARIABLES</a>:
<a name="l02147"></a>02147                 result=<a class="code" href="dbhandlers_8h.html#aa2350eb620ed3feaf731f23b05339c65">ido2db_handle_runtimevariables</a>(idi);
<a name="l02148"></a>02148                 <span class="keywordflow">break</span>;
<a name="l02149"></a>02149         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ae24444e4f53bcb4738ca810405442b01">IDO2DB_INPUT_DATA_CONFIGDUMPSTART</a>:
<a name="l02150"></a>02150                 result=<a class="code" href="dbhandlers_8h.html#adc23b277725e7222d7505ea54c0d5b85">ido2db_handle_configdumpstart</a>(idi);
<a name="l02151"></a>02151                 <span class="keywordflow">break</span>;
<a name="l02152"></a>02152         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a9fd2024907cc7dd108598ebc1736ede7">IDO2DB_INPUT_DATA_CONFIGDUMPEND</a>:
<a name="l02153"></a>02153                 result=<a class="code" href="dbhandlers_8h.html#a6655c3903d58a0a9c6d122f5bc7f5bcb">ido2db_handle_configdumpend</a>(idi);
<a name="l02154"></a>02154                 <span class="keywordflow">break</span>;
<a name="l02155"></a>02155 
<a name="l02156"></a>02156         <span class="comment">/* config definitions */</span>
<a name="l02157"></a>02157         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a9548a8f244bc4c0ec629c5878f83d49a">IDO2DB_INPUT_DATA_HOSTDEFINITION</a>:
<a name="l02158"></a>02158                 result=<a class="code" href="dbhandlers_8h.html#a18ac78178f599ca33441da12f6759326">ido2db_handle_hostdefinition</a>(idi);
<a name="l02159"></a>02159                 <span class="keywordflow">break</span>;
<a name="l02160"></a>02160         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ad314d0c45fef6911e9a4dd91280841df">IDO2DB_INPUT_DATA_HOSTGROUPDEFINITION</a>:
<a name="l02161"></a>02161                 result=<a class="code" href="dbhandlers_8h.html#af7c2593c0e2156921629ecf1b5748964">ido2db_handle_hostgroupdefinition</a>(idi);
<a name="l02162"></a>02162                 <span class="keywordflow">break</span>;
<a name="l02163"></a>02163         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a169571becf6fe1083e762b7808874540">IDO2DB_INPUT_DATA_SERVICEDEFINITION</a>:
<a name="l02164"></a>02164                 result=<a class="code" href="dbhandlers_8h.html#ad850578e5b36add56c2d3392d594247b">ido2db_handle_servicedefinition</a>(idi);
<a name="l02165"></a>02165                 <span class="keywordflow">break</span>;
<a name="l02166"></a>02166         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a660509757ba32b341ee84b57a99c2083">IDO2DB_INPUT_DATA_SERVICEGROUPDEFINITION</a>:
<a name="l02167"></a>02167                 result=<a class="code" href="dbhandlers_8h.html#a908007a3c9e9089cf21e075cf8ff4df2">ido2db_handle_servicegroupdefinition</a>(idi);
<a name="l02168"></a>02168                 <span class="keywordflow">break</span>;
<a name="l02169"></a>02169         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#af703687a4f37025d69d20c7a9e359f73">IDO2DB_INPUT_DATA_HOSTDEPENDENCYDEFINITION</a>:
<a name="l02170"></a>02170                 result=<a class="code" href="dbhandlers_8h.html#a9d5b5242c0328e95c4e81c2369a31732">ido2db_handle_hostdependencydefinition</a>(idi);
<a name="l02171"></a>02171                 <span class="keywordflow">break</span>;
<a name="l02172"></a>02172         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a324bcbd3e369f5290c48f5dadf431e38">IDO2DB_INPUT_DATA_SERVICEDEPENDENCYDEFINITION</a>:
<a name="l02173"></a>02173                 result=<a class="code" href="dbhandlers_8h.html#a21a776630bb86706c03b123efd44703b">ido2db_handle_servicedependencydefinition</a>(idi);
<a name="l02174"></a>02174                 <span class="keywordflow">break</span>;
<a name="l02175"></a>02175         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ab3fa7b636ac96216a770f76cb46eeeaa">IDO2DB_INPUT_DATA_HOSTESCALATIONDEFINITION</a>:
<a name="l02176"></a>02176                 result=<a class="code" href="dbhandlers_8h.html#a3d0af38a1f6ddf92c40f0d0ff4751b3b">ido2db_handle_hostescalationdefinition</a>(idi);
<a name="l02177"></a>02177                 <span class="keywordflow">break</span>;
<a name="l02178"></a>02178         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a2e52c86b600246690497e92e161482af">IDO2DB_INPUT_DATA_SERVICEESCALATIONDEFINITION</a>:
<a name="l02179"></a>02179                 result=<a class="code" href="dbhandlers_8h.html#a866b0627df27e51e2158aa876e9a77da">ido2db_handle_serviceescalationdefinition</a>(idi);
<a name="l02180"></a>02180                 <span class="keywordflow">break</span>;
<a name="l02181"></a>02181         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#aa17be51ed856d24b521ae12e9286b86e">IDO2DB_INPUT_DATA_COMMANDDEFINITION</a>:
<a name="l02182"></a>02182                 result=<a class="code" href="dbhandlers_8h.html#a758132db9a02216cb303215746f50b26">ido2db_handle_commanddefinition</a>(idi);
<a name="l02183"></a>02183                 <span class="keywordflow">break</span>;
<a name="l02184"></a>02184         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a132d711ee5c5382d44a46f9f9b6a2cda">IDO2DB_INPUT_DATA_TIMEPERIODDEFINITION</a>:
<a name="l02185"></a>02185                 result=<a class="code" href="dbhandlers_8h.html#ad26ee0af33a93e35d5cd4d1e28def60c">ido2db_handle_timeperiodefinition</a>(idi);
<a name="l02186"></a>02186                 <span class="keywordflow">break</span>;
<a name="l02187"></a>02187         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a3c96b889ad72dc294dbfbd81fdbdea17">IDO2DB_INPUT_DATA_CONTACTDEFINITION</a>:
<a name="l02188"></a>02188                 result=<a class="code" href="dbhandlers_8h.html#ae0059e63a48e88c6016d0870d436bdde">ido2db_handle_contactdefinition</a>(idi);
<a name="l02189"></a>02189                 <span class="keywordflow">break</span>;
<a name="l02190"></a>02190         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a5dd3bdfbc6ea50a001ee7eff61f6a954">IDO2DB_INPUT_DATA_CONTACTGROUPDEFINITION</a>:
<a name="l02191"></a>02191                 result=<a class="code" href="dbhandlers_8h.html#a8a215c494f0a533fb50f18435ff423ec">ido2db_handle_contactgroupdefinition</a>(idi);
<a name="l02192"></a>02192                 <span class="keywordflow">break</span>;
<a name="l02193"></a>02193         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#ac6d657d73127c7a36cc1e54df1895b5d">IDO2DB_INPUT_DATA_HOSTEXTINFODEFINITION</a>:
<a name="l02194"></a>02194                 <span class="comment">/* deprecated - merged with host definitions */</span>
<a name="l02195"></a>02195                 <span class="keywordflow">break</span>;
<a name="l02196"></a>02196         <span class="keywordflow">case</span> <a class="code" href="ido2db_8h.html#a2f01827a0d61fcbf6201695c7b231b6c">IDO2DB_INPUT_DATA_SERVICEEXTINFODEFINITION</a>:
<a name="l02197"></a>02197                 <span class="comment">/* deprecated - merged with service definitions */</span>
<a name="l02198"></a>02198                 <span class="keywordflow">break</span>;
<a name="l02199"></a>02199 
<a name="l02200"></a>02200         <span class="keywordflow">default</span>:
<a name="l02201"></a>02201                 <span class="keywordflow">break</span>;
<a name="l02202"></a>02202                 }
<a name="l02203"></a>02203 
<a name="l02204"></a>02204         <span class="comment">/* free input memory */</span>
<a name="l02205"></a>02205         <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(idi);
<a name="l02206"></a>02206 
<a name="l02207"></a>02207         <span class="comment">/* adjust items processed */</span>
<a name="l02208"></a>02208         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a700ef2c38019a55dab560d3da266536d">entries_processed</a>++;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210         <span class="comment">/* perform periodic maintenance... */</span>
<a name="l02211"></a>02211         <span class="comment">//ido2db_db_perform_maintenance(idi);</span>
<a name="l02212"></a>02212 
<a name="l02213"></a>02213         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_end_input_data() end\n&quot;</span>);
<a name="l02214"></a>02214         <span class="keywordflow">return</span> result;
<a name="l02215"></a>02215         }
<a name="l02216"></a>02216 
<a name="l02217"></a>02217 
<a name="l02218"></a>02218 <span class="comment">/* free memory allocated to data input */</span>
<a name="l02219"></a><a class="code" href="ido2db_8c.html#a53219de16c65f3dab6ac5959b269ecfc">02219</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi){
<a name="l02220"></a>02220         <span class="keyword">register</span> <span class="keywordtype">int</span> x=0;
<a name="l02221"></a>02221         <span class="keyword">register</span> <span class="keywordtype">int</span> y=0;
<a name="l02222"></a>02222 
<a name="l02223"></a>02223         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_free_input_memory() start\n&quot;</span>);
<a name="l02224"></a>02224 
<a name="l02225"></a>02225         <span class="keywordflow">if</span>(idi==NULL)
<a name="l02226"></a>02226                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02227"></a>02227 
<a name="l02228"></a>02228         <span class="comment">/* free memory allocated to single-instance data buffers */</span>
<a name="l02229"></a>02229         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>){
<a name="l02230"></a>02230 
<a name="l02231"></a>02231                 <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="protoapi_8h.html#a226c26c0bc87fc3edb55886244bc0ed3">IDO_MAX_DATA_TYPES</a>;x++){
<a name="l02232"></a>02232                         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[x])
<a name="l02233"></a>02233                                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[x]);
<a name="l02234"></a>02234                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[x]=NULL;
<a name="l02235"></a>02235                         }
<a name="l02236"></a>02236 
<a name="l02237"></a>02237                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>);
<a name="l02238"></a>02238                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>=NULL;
<a name="l02239"></a>02239                 }
<a name="l02240"></a>02240 
<a name="l02241"></a>02241         <span class="comment">/* free memory allocated to multi-instance data buffers */</span>
<a name="l02242"></a>02242         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>){
<a name="l02243"></a>02243                 <span class="keywordflow">for</span>(x=0;x&lt;<a class="code" href="ido2db_8h.html#aae764517d9446fd4d3524d344190b874">IDO2DB_MAX_MBUF_ITEMS</a>;x++){
<a name="l02244"></a>02244                         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>){
<a name="l02245"></a>02245                                 <span class="keywordflow">for</span>(y=0;y&lt;idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#a599c5a116f9cbbf65365bec52c99f962">used_lines</a>;y++){
<a name="l02246"></a>02246                                         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>[y]){
<a name="l02247"></a>02247                                                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>[y]);
<a name="l02248"></a>02248                                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>[y]=NULL;
<a name="l02249"></a>02249                                                 }
<a name="l02250"></a>02250                                         }
<a name="l02251"></a>02251                                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>);
<a name="l02252"></a>02252                                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#afeedf13a7297a414e292d23b239cb719">buffer</a>=NULL;
<a name="l02253"></a>02253                                 }
<a name="l02254"></a>02254                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#a599c5a116f9cbbf65365bec52c99f962">used_lines</a>=0;
<a name="l02255"></a>02255                         idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a5cae47323c97e69adb45bcecc8ba62de">mbuf</a>[x].<a class="code" href="structido2db__mbuf__struct.html#a167eb3433ec458d100d88de5a3fdea1a">allocated_lines</a>=0;
<a name="l02256"></a>02256                         }
<a name="l02257"></a>02257                 }
<a name="l02258"></a>02258 
<a name="l02259"></a>02259         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_free_input_memory() end\n&quot;</span>);
<a name="l02260"></a>02260         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02261"></a>02261         }
<a name="l02262"></a>02262 
<a name="l02263"></a>02263 
<a name="l02264"></a>02264 <span class="comment">/* free memory allocated to connection */</span>
<a name="l02265"></a><a class="code" href="ido2db_8c.html#a2db5a14831b0a28fa44d11e91285b62f">02265</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#affc50ec47a6ba3154814cf0ef77f0928">ido2db_free_connection_memory</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi){
<a name="l02266"></a>02266 
<a name="l02267"></a>02267         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_free_connection_memory() start\n&quot;</span>);
<a name="l02268"></a>02268 
<a name="l02269"></a>02269         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>){
<a name="l02270"></a>02270                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>);
<a name="l02271"></a>02271                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>=NULL;
<a name="l02272"></a>02272                 }
<a name="l02273"></a>02273         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abf6e1df34a8c51b8b6b4c350e76c9337">agent_name</a>){
<a name="l02274"></a>02274                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abf6e1df34a8c51b8b6b4c350e76c9337">agent_name</a>);
<a name="l02275"></a>02275                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abf6e1df34a8c51b8b6b4c350e76c9337">agent_name</a>=NULL;
<a name="l02276"></a>02276                 }
<a name="l02277"></a>02277         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a>){
<a name="l02278"></a>02278                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a>);
<a name="l02279"></a>02279                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a>=NULL;
<a name="l02280"></a>02280                 }
<a name="l02281"></a>02281         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a>){
<a name="l02282"></a>02282                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a>);
<a name="l02283"></a>02283                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a>=NULL;
<a name="l02284"></a>02284                 }
<a name="l02285"></a>02285         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a>){
<a name="l02286"></a>02286                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a>);
<a name="l02287"></a>02287                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a>=NULL;
<a name="l02288"></a>02288                 }
<a name="l02289"></a>02289         <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a>){
<a name="l02290"></a>02290                 free(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a>);
<a name="l02291"></a>02291                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a>=NULL;
<a name="l02292"></a>02292                 }
<a name="l02293"></a>02293 
<a name="l02294"></a>02294         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_free_connection_memory() end\n&quot;</span>);
<a name="l02295"></a>02295         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02296"></a>02296         }
<a name="l02297"></a>02297 
<a name="l02298"></a>02298 
<a name="l02299"></a>02299 
<a name="l02300"></a>02300 <span class="comment">/****************************************************************************/</span>
<a name="l02301"></a>02301 <span class="comment">/* DATA TYPE CONVERTION ROUTINES                                            */</span>
<a name="l02302"></a>02302 <span class="comment">/****************************************************************************/</span>
<a name="l02303"></a>02303 
<a name="l02304"></a><a class="code" href="ido2db_8c.html#ae01ae68cad6cb7517a10e63931ba0392">02304</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a49fe186d6863b65e0db24a28505ff0fe">ido2db_convert_standard_data_elements</a>(<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi, <span class="keywordtype">int</span> *type, <span class="keywordtype">int</span> *flags, <span class="keywordtype">int</span> *attr, <span class="keyword">struct</span> timeval *tstamp){
<a name="l02305"></a>02305         <span class="keywordtype">int</span> result1=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02306"></a>02306         <span class="keywordtype">int</span> result2=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02307"></a>02307         <span class="keywordtype">int</span> result3=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02308"></a>02308         <span class="keywordtype">int</span> result4=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02309"></a>02309 
<a name="l02310"></a>02310         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_standard_data_elements() start\n&quot;</span>);
<a name="l02311"></a>02311 
<a name="l02312"></a>02312         result1=<a class="code" href="ido2db_8h.html#ae6d3a21e7e24fd41a088c5a8b1878a91">ido2db_convert_string_to_int</a>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[<a class="code" href="protoapi_8h.html#ac72cda8dcc8d6121ab19438eadff3b4c">IDO_DATA_TYPE</a>],type);
<a name="l02313"></a>02313         result2=<a class="code" href="ido2db_8h.html#ae6d3a21e7e24fd41a088c5a8b1878a91">ido2db_convert_string_to_int</a>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[<a class="code" href="protoapi_8h.html#ae56562b68f171a58ac82c282bb0df6ad">IDO_DATA_FLAGS</a>],flags);
<a name="l02314"></a>02314         result3=<a class="code" href="ido2db_8h.html#ae6d3a21e7e24fd41a088c5a8b1878a91">ido2db_convert_string_to_int</a>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[<a class="code" href="protoapi_8h.html#abddfae537feff4f166da7a4173880036">IDO_DATA_ATTRIBUTES</a>],attr);
<a name="l02315"></a>02315         result4=<a class="code" href="ido2db_8h.html#a9d0675139445808b73143a9d02c55906">ido2db_convert_string_to_timeval</a>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a000a01642734429cc5be1894e86e3db6">buffered_input</a>[<a class="code" href="protoapi_8h.html#a93b0eb798c5b443a68202f96b1778c13">IDO_DATA_TIMESTAMP</a>],tstamp);
<a name="l02316"></a>02316 
<a name="l02317"></a>02317         <span class="keywordflow">if</span>(result1==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a> || result2==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a> || result3==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a> || result4==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>)
<a name="l02318"></a>02318                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02319"></a>02319 
<a name="l02320"></a>02320 
<a name="l02321"></a>02321         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_standard_data_elements() end\n&quot;</span>);
<a name="l02322"></a>02322         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02323"></a>02323         }
<a name="l02324"></a>02324 
<a name="l02325"></a>02325 
<a name="l02326"></a><a class="code" href="ido2db_8c.html#a47095102358abe49459764ee362bd6d6">02326</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ae6d3a21e7e24fd41a088c5a8b1878a91">ido2db_convert_string_to_int</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> *i){
<a name="l02327"></a>02327 
<a name="l02328"></a>02328         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_int(%s) start\n&quot;</span>, buf);
<a name="l02329"></a>02329 
<a name="l02330"></a>02330         <span class="keywordflow">if</span>(buf==NULL)
<a name="l02331"></a>02331                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02332"></a>02332 
<a name="l02333"></a>02333         *i=atoi(buf);
<a name="l02334"></a>02334 
<a name="l02335"></a>02335         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_int(%d) end\n&quot;</span>, i);
<a name="l02336"></a>02336         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02337"></a>02337         }
<a name="l02338"></a>02338 
<a name="l02339"></a>02339 
<a name="l02340"></a><a class="code" href="ido2db_8c.html#a433d212cc900c844ab05a2d76061be32">02340</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a23afed04a52efabd14f0f0136cd25e18">ido2db_convert_string_to_float</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">float</span> *f){
<a name="l02341"></a>02341         <span class="keywordtype">char</span> *endptr=NULL;
<a name="l02342"></a>02342 
<a name="l02343"></a>02343         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_float(%s) start\n&quot;</span>, buf);
<a name="l02344"></a>02344 
<a name="l02345"></a>02345         <span class="keywordflow">if</span>(buf==NULL)
<a name="l02346"></a>02346                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02347"></a>02347 
<a name="l02348"></a>02348 <span class="preprocessor">#ifdef HAVE_STRTOF</span>
<a name="l02349"></a>02349 <span class="preprocessor"></span>        *f=strtof(buf,&amp;endptr);
<a name="l02350"></a>02350 <span class="preprocessor">#else</span>
<a name="l02351"></a>02351 <span class="preprocessor"></span>        <span class="comment">/* Solaris 8 doesn&#39;t have strtof() */</span>
<a name="l02352"></a>02352         *f=(float)strtod(buf,&amp;endptr);
<a name="l02353"></a>02353 <span class="preprocessor">#endif</span>
<a name="l02354"></a>02354 <span class="preprocessor"></span>
<a name="l02355"></a>02355         <span class="keywordflow">if</span>(*f==0 &amp;&amp; (endptr==buf || <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE))
<a name="l02356"></a>02356                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02357"></a>02357         <span class="keywordflow">if</span>(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE)
<a name="l02358"></a>02358                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02359"></a>02359 
<a name="l02360"></a>02360         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_float(%f) end\n&quot;</span>, f);
<a name="l02361"></a>02361         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02362"></a>02362         }
<a name="l02363"></a>02363 
<a name="l02364"></a>02364 
<a name="l02365"></a><a class="code" href="ido2db_8c.html#a4c8298b48159a771c16eac0de0dbb125">02365</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a6f9cc858e7a819f9645cd5ae6b916c0c">ido2db_convert_string_to_double</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">double</span> *d){
<a name="l02366"></a>02366         <span class="keywordtype">char</span> *endptr=NULL;
<a name="l02367"></a>02367 
<a name="l02368"></a>02368         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_double(%s) start\n&quot;</span>, buf);
<a name="l02369"></a>02369         <span class="keywordflow">if</span>(buf==NULL)
<a name="l02370"></a>02370                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02371"></a>02371 
<a name="l02372"></a>02372         *d=strtod(buf,&amp;endptr);
<a name="l02373"></a>02373 
<a name="l02374"></a>02374         <span class="keywordflow">if</span>(*d==0 &amp;&amp; (endptr==buf || <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE))
<a name="l02375"></a>02375                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02376"></a>02376         <span class="keywordflow">if</span>(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE)
<a name="l02377"></a>02377                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02378"></a>02378 
<a name="l02379"></a>02379         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_double(%lf) end\n&quot;</span>, d);
<a name="l02380"></a>02380         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02381"></a>02381         }
<a name="l02382"></a>02382 
<a name="l02383"></a>02383 
<a name="l02384"></a><a class="code" href="ido2db_8c.html#a0f298459c43ab07ad7ac7daa7ed35999">02384</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a0a2060d71928225633c38a2a8aad66df">ido2db_convert_string_to_long</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">long</span> *l){
<a name="l02385"></a>02385         <span class="keywordtype">char</span> *endptr=NULL;
<a name="l02386"></a>02386 
<a name="l02387"></a>02387         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_long(%s) start\n&quot;</span>, buf);
<a name="l02388"></a>02388 
<a name="l02389"></a>02389         <span class="keywordflow">if</span>(buf==NULL)
<a name="l02390"></a>02390                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02391"></a>02391 
<a name="l02392"></a>02392         *l=strtol(buf,&amp;endptr,0);
<a name="l02393"></a>02393 
<a name="l02394"></a>02394         <span class="keywordflow">if</span>(*l==LONG_MAX &amp;&amp; <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE)
<a name="l02395"></a>02395                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02396"></a>02396         <span class="keywordflow">if</span>(*l==0L &amp;&amp; endptr==buf)
<a name="l02397"></a>02397                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02398"></a>02398 
<a name="l02399"></a>02399         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_long(%l) end\n&quot;</span>, l);
<a name="l02400"></a>02400         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02401"></a>02401         }
<a name="l02402"></a>02402 
<a name="l02403"></a>02403 
<a name="l02404"></a><a class="code" href="ido2db_8c.html#ab7c5952b1b93966e5941c5da14abddc6">02404</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#ab16d6b78a295991bcce24494c93509ac">ido2db_convert_string_to_unsignedlong</a>(<span class="keywordtype">char</span> *buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *ul){
<a name="l02405"></a>02405         <span class="keywordtype">char</span> *endptr=NULL;
<a name="l02406"></a>02406 
<a name="l02407"></a>02407         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_unsignedlong(%s) start\n&quot;</span>, buf);
<a name="l02408"></a>02408 
<a name="l02409"></a>02409         <span class="keywordflow">if</span>(buf==NULL)
<a name="l02410"></a>02410                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02411"></a>02411 
<a name="l02412"></a>02412         *ul=strtoul(buf,&amp;endptr,0);
<a name="l02413"></a>02413         <span class="keywordflow">if</span>(*ul==ULONG_MAX &amp;&amp; <a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>==ERANGE)
<a name="l02414"></a>02414                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02415"></a>02415         <span class="keywordflow">if</span>(*ul==0L &amp;&amp; endptr==buf)
<a name="l02416"></a>02416                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02417"></a>02417 
<a name="l02418"></a>02418         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_unsignedlong(%lu) end\n&quot;</span>, ul);
<a name="l02419"></a>02419         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02420"></a>02420 }
<a name="l02421"></a>02421 
<a name="l02422"></a>02422 
<a name="l02423"></a><a class="code" href="ido2db_8c.html#a59b7ba2a7e54beda48cade91a98c7f4b">02423</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a9d0675139445808b73143a9d02c55906">ido2db_convert_string_to_timeval</a>(<span class="keywordtype">char</span> *buf, <span class="keyword">struct</span> timeval *tv){
<a name="l02424"></a>02424         <span class="keywordtype">char</span> *newbuf=NULL;
<a name="l02425"></a>02425         <span class="keywordtype">char</span> *ptr=NULL;
<a name="l02426"></a>02426         <span class="keywordtype">int</span> result=<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02427"></a>02427 
<a name="l02428"></a>02428         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_timeval(%s) start\n&quot;</span>, buf);
<a name="l02429"></a>02429 
<a name="l02430"></a>02430         <span class="keywordflow">if</span>(buf==NULL)
<a name="l02431"></a>02431                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02432"></a>02432 
<a name="l02433"></a>02433         tv-&gt;tv_sec=(time_t)0L;
<a name="l02434"></a>02434         tv-&gt;tv_usec=(suseconds_t)0L;
<a name="l02435"></a>02435 
<a name="l02436"></a>02436         <span class="keywordflow">if</span>((newbuf=strdup(buf))==NULL)
<a name="l02437"></a>02437                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02438"></a>02438 
<a name="l02439"></a>02439         ptr=strtok(newbuf,<span class="stringliteral">&quot;.&quot;</span>);
<a name="l02440"></a>02440         <span class="keywordflow">if</span>((result=<a class="code" href="ido2db_8h.html#ab16d6b78a295991bcce24494c93509ac">ido2db_convert_string_to_unsignedlong</a>(ptr,(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;tv-&gt;tv_sec))==<a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>){
<a name="l02441"></a>02441                 ptr=strtok(NULL,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02442"></a>02442                 result=<a class="code" href="ido2db_8h.html#ab16d6b78a295991bcce24494c93509ac">ido2db_convert_string_to_unsignedlong</a>(ptr,(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> *)&amp;tv-&gt;tv_usec);
<a name="l02443"></a>02443                 }
<a name="l02444"></a>02444 
<a name="l02445"></a>02445         free(newbuf);
<a name="l02446"></a>02446 
<a name="l02447"></a>02447         <span class="keywordflow">if</span>(result==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>)
<a name="l02448"></a>02448                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02449"></a>02449 
<a name="l02450"></a>02450         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_convert_string_to_timeval() end\n&quot;</span>);
<a name="l02451"></a>02451         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02452"></a>02452         }
<a name="l02453"></a>02453 
<a name="l02454"></a>02454 
<a name="l02455"></a>02455 
<a name="l02456"></a>02456 <span class="comment">/****************************************************************************/</span>
<a name="l02457"></a>02457 <span class="comment">/* LOGGING ROUTINES                                                         */</span>
<a name="l02458"></a>02458 <span class="comment">/****************************************************************************/</span>
<a name="l02459"></a>02459 
<a name="l02460"></a>02460 <span class="comment">/* opens the debug log for writing */</span>
<a name="l02461"></a><a class="code" href="ido2db_8c.html#ac480583b46396ce99b422d2c6864f6c7">02461</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#ac480583b46396ce99b422d2c6864f6c7">ido2db_open_debug_log</a>(<span class="keywordtype">void</span>){
<a name="l02462"></a>02462 
<a name="l02463"></a>02463         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_open_debug_log() start\n&quot;</span>);
<a name="l02464"></a>02464 
<a name="l02465"></a>02465         <span class="comment">/* don&#39;t do anything if we&#39;re not debugging */</span>
<a name="l02466"></a>02466         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a8eba9fd4ad64e80e8f2e7a91a4f3d2d0">ido2db_debug_level</a>==<a class="code" href="ido2db_8h.html#ac726c5df56c46e323a00583134f5e5a0">IDO2DB_DEBUGL_NONE</a>)
<a name="l02467"></a>02467                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02468"></a>02468 
<a name="l02469"></a>02469         <span class="keywordflow">if</span>((<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>=fopen(<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>,<span class="stringliteral">&quot;a+&quot;</span>))==NULL) {
<a name="l02470"></a>02470                 syslog(LOG_ERR, <span class="stringliteral">&quot;Warning: Could not open debug file &#39;%s&#39; - &#39;%s&#39;&quot;</span>, <a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>, strerror(<a class="code" href="base_2utils_8c.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l02471"></a>02471                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02472"></a>02472         }
<a name="l02473"></a>02473 
<a name="l02474"></a>02474         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_open_debug_log() end\n&quot;</span>);
<a name="l02475"></a>02475 
<a name="l02476"></a>02476         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02477"></a>02477         }
<a name="l02478"></a>02478 
<a name="l02479"></a>02479 
<a name="l02480"></a>02480 <span class="comment">/* closes the debug log */</span>
<a name="l02481"></a><a class="code" href="ido2db_8c.html#a15b16bfb2ea5d42ffaf8a5ab04c18ae8">02481</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8c.html#a15b16bfb2ea5d42ffaf8a5ab04c18ae8">ido2db_close_debug_log</a>(<span class="keywordtype">void</span>){
<a name="l02482"></a>02482 
<a name="l02483"></a>02483         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>!=NULL)
<a name="l02484"></a>02484                 fclose(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>);
<a name="l02485"></a>02485 
<a name="l02486"></a>02486         <a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>=NULL;
<a name="l02487"></a>02487 
<a name="l02488"></a>02488         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02489"></a>02489         }
<a name="l02490"></a>02490 
<a name="l02491"></a>02491 
<a name="l02492"></a>02492 <span class="comment">/* write to the debug log */</span>
<a name="l02493"></a><a class="code" href="ido2db_8c.html#ae5a6f8254994e420514ca9032ca159f0">02493</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<span class="keywordtype">int</span> level, <span class="keywordtype">int</span> verbosity, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...){
<a name="l02494"></a>02494         va_list ap;
<a name="l02495"></a>02495         <span class="keywordtype">char</span> *<a class="code" href="checks_8c.html#ac633a7a52422f2b1d56ed02a56dc8fcf">temp_path</a>=NULL;
<a name="l02496"></a>02496         <span class="keyword">struct </span>timeval current_time;
<a name="l02497"></a>02497 
<a name="l02498"></a>02498         <span class="keywordflow">if</span>(!(<a class="code" href="ido2db_8c.html#a8eba9fd4ad64e80e8f2e7a91a4f3d2d0">ido2db_debug_level</a>==<a class="code" href="ido2db_8h.html#af054fcd11108d2e578e15fe202ca3bc1">IDO2DB_DEBUGL_ALL</a> || (level &amp; <a class="code" href="ido2db_8c.html#a8eba9fd4ad64e80e8f2e7a91a4f3d2d0">ido2db_debug_level</a>)))
<a name="l02499"></a>02499                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02500"></a>02500 
<a name="l02501"></a>02501         <span class="keywordflow">if</span>(verbosity&gt;<a class="code" href="ido2db_8c.html#ab58b27ab80d7038b4aed2731e24663ed">ido2db_debug_verbosity</a>)
<a name="l02502"></a>02502                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02503"></a>02503 
<a name="l02504"></a>02504         <span class="keywordflow">if</span>(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>==NULL)
<a name="l02505"></a>02505                 <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02506"></a>02506 
<a name="l02507"></a>02507         <span class="comment">/* write the timestamp */</span>
<a name="l02508"></a>02508         gettimeofday(&amp;current_time,NULL);
<a name="l02509"></a>02509         fprintf(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>,<span class="stringliteral">&quot;[%lu.%06lu] [%03d.%d] [pid=%lu] &quot;</span>,current_time.tv_sec,current_time.tv_usec,level,verbosity,(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)getpid());
<a name="l02510"></a>02510 
<a name="l02511"></a>02511         <span class="comment">/* write the data */</span>
<a name="l02512"></a>02512         va_start(ap,fmt);
<a name="l02513"></a>02513         vfprintf(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>,fmt,ap);
<a name="l02514"></a>02514         va_end(ap);
<a name="l02515"></a>02515 
<a name="l02516"></a>02516         <span class="comment">/* flush, so we don&#39;t have problems tailing or when fork()ing */</span>
<a name="l02517"></a>02517         fflush(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>);
<a name="l02518"></a>02518 
<a name="l02519"></a>02519         <span class="comment">/* if file has grown beyond max, rotate it */</span>
<a name="l02520"></a>02520         <span class="keywordflow">if</span>((<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)ftell(<a class="code" href="ido2db_8c.html#a9772436a16b709727d9a7c9c8227935f">ido2db_debug_file_fp</a>)&gt;<a class="code" href="ido2db_8c.html#aff7a69c074bd68f4f72fbdabe95dfaf9">ido2db_max_debug_file_size</a> &amp;&amp; <a class="code" href="ido2db_8c.html#aff7a69c074bd68f4f72fbdabe95dfaf9">ido2db_max_debug_file_size</a>&gt;0L){
<a name="l02521"></a>02521 
<a name="l02522"></a>02522                 <span class="comment">/* close the file */</span>
<a name="l02523"></a>02523                 <a class="code" href="ido2db_8c.html#a15b16bfb2ea5d42ffaf8a5ab04c18ae8">ido2db_close_debug_log</a>();
<a name="l02524"></a>02524 
<a name="l02525"></a>02525                 <span class="comment">/* rotate the log file */</span>
<a name="l02526"></a>02526                 <span class="keywordflow">if</span>(<a class="code" href="snprintf_8c.html#a28a648dd20504ebc0c03623a28d82c93">asprintf</a>(&amp;temp_path,<span class="stringliteral">&quot;%s.old&quot;</span>,<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>)==-1)
<a name="l02527"></a>02527                         temp_path=NULL; 
<a name="l02528"></a>02528 
<a name="l02529"></a>02529                 <span class="keywordflow">if</span>(temp_path){
<a name="l02530"></a>02530 
<a name="l02531"></a>02531                         <span class="comment">/* unlink the old debug file */</span>
<a name="l02532"></a>02532                         unlink(temp_path);
<a name="l02533"></a>02533 
<a name="l02534"></a>02534                         <span class="comment">/* rotate the debug file */</span>
<a name="l02535"></a>02535                         <a class="code" href="base_2utils_8c.html#aa23bc32b41818196b62048be4ee1803e">my_rename</a>(<a class="code" href="ido2db_8c.html#a6a884d1c2dce7e9bef3bd260724f9c73">ido2db_debug_file</a>,temp_path);
<a name="l02536"></a>02536 
<a name="l02537"></a>02537                         <span class="comment">/* free memory */</span>
<a name="l02538"></a>02538                         <a class="code" href="include_2common_8h.html#a9b12a99aae3efc49af9be50afc17b526">my_free</a>(temp_path);
<a name="l02539"></a>02539                         }
<a name="l02540"></a>02540 
<a name="l02541"></a>02541                 <span class="comment">/* open a new file */</span>
<a name="l02542"></a>02542                 <a class="code" href="ido2db_8c.html#ac480583b46396ce99b422d2c6864f6c7">ido2db_open_debug_log</a>();
<a name="l02543"></a>02543                 }
<a name="l02544"></a>02544 
<a name="l02545"></a>02545         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02546"></a>02546         }
<a name="l02547"></a>02547 
<a name="l02548"></a>02548 <span class="comment">/********************************************************************</span>
<a name="l02549"></a>02549 <span class="comment"> *</span>
<a name="l02550"></a>02550 <span class="comment"> * housekeeping - this is the function for the db trimming thread</span>
<a name="l02551"></a>02551 <span class="comment"> *</span>
<a name="l02552"></a>02552 <span class="comment"> ********************************************************************/</span>
<a name="l02553"></a>02553 
<a name="l02554"></a><a class="code" href="ido2db_8c.html#a81a64d72ddd1e9266e45e1820a71b30a">02554</a> <span class="keywordtype">void</span> * <a class="code" href="ido2db_8h.html#ab3ef4313a21d2353ecc8eb5ffb15086f">ido2db_thread_cleanup</a>(<span class="keywordtype">void</span> *data) {
<a name="l02555"></a>02555 
<a name="l02556"></a>02556         <a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a> *idi = (<a class="code" href="structido2db__input__data__info__struct.html">ido2db_idi</a>*) data;
<a name="l02557"></a>02557 
<a name="l02558"></a>02558         <span class="keywordtype">int</span> old_thread_state;
<a name="l02559"></a>02559 
<a name="l02560"></a>02560         <span class="keyword">struct </span>timespec delay;
<a name="l02561"></a>02561         delay.tv_sec = 0;
<a name="l02562"></a>02562         delay.tv_nsec = 500;
<a name="l02563"></a>02563 
<a name="l02564"></a>02564         <span class="comment">/* it might happen that db connection comes to fast after main thread so sleep a while */</span>
<a name="l02565"></a>02565         <span class="comment">//delay.tv_sec = 60;</span>
<a name="l02566"></a>02566         <span class="comment">/* allowed to be set in config */</span>
<a name="l02567"></a>02567         delay.tv_sec = ido2db_db_settings.<a class="code" href="structido2db__dbconfig__struct.html#ad79df68423cbb2c5887ab727f6a85341">housekeeping_thread_startup_delay</a>;
<a name="l02568"></a>02568         nanosleep(&amp;delay, NULL);
<a name="l02569"></a>02569 
<a name="l02570"></a>02570         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() start\n&quot;</span>);
<a name="l02571"></a>02571 
<a name="l02572"></a>02572         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() initialize thread idi\n&quot;</span>);
<a name="l02573"></a>02573 
<a name="l02574"></a>02574         <span class="comment">/* initialize input data information */</span>
<a name="l02575"></a>02575         <a class="code" href="ido2db_8h.html#a918617b0d7fa8c9e95119bdc9fead47e">ido2db_idi_init</a>(&amp;thread_idi);
<a name="l02576"></a>02576 
<a name="l02577"></a>02577         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() initialize thread db connection\n&quot;</span>);
<a name="l02578"></a>02578         <span class="comment">/* initialize database connection */</span>
<a name="l02579"></a>02579         <a class="code" href="db_8h.html#a43b388ea23f1f456d3a3c4bba0762792">ido2db_db_init</a>(&amp;thread_idi);
<a name="l02580"></a>02580 
<a name="l02581"></a>02581         <span class="keywordflow">if</span>(<a class="code" href="db_8h.html#a3587cb89a643965537b1533b9cc3678d">ido2db_db_connect</a>(&amp;thread_idi)==<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>){
<a name="l02582"></a>02582 
<a name="l02583"></a>02583                 <span class="comment">/* tell main process to disconnect */</span>
<a name="l02584"></a>02584                 idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>=<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>;
<a name="l02585"></a>02585 
<a name="l02586"></a>02586                 <span class="comment">/* cleanup the thread */</span>
<a name="l02587"></a>02587                 <a class="code" href="db_8h.html#a61a5fddb76c111a1689fd5dd95f9d7b7">ido2db_db_deinit</a>(&amp;thread_idi);
<a name="l02588"></a>02588 
<a name="l02589"></a>02589                 <span class="comment">/* free memory */</span>
<a name="l02590"></a>02590                 <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(&amp;thread_idi);
<a name="l02591"></a>02591                 <a class="code" href="ido2db_8h.html#affc50ec47a6ba3154814cf0ef77f0928">ido2db_free_connection_memory</a>(&amp;thread_idi);
<a name="l02592"></a>02592 
<a name="l02593"></a>02593                 <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)<a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>;
<a name="l02594"></a>02594         }
<a name="l02595"></a>02595 
<a name="l02596"></a>02596         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() pthread_cleanup push()\n&quot;</span>);
<a name="l02597"></a>02597         pthread_cleanup_push((<span class="keywordtype">void</span> *) &amp;ido2db_thread_cleanup_exit_handler, NULL);
<a name="l02598"></a>02598         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() pthread_cleanup push() end \n&quot;</span>);
<a name="l02599"></a>02599 
<a name="l02600"></a>02600         delay.tv_sec = 0;
<a name="l02601"></a>02601         delay.tv_nsec = 500;
<a name="l02602"></a>02602 
<a name="l02603"></a>02603         <span class="keywordflow">while</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>==NULL) {
<a name="l02604"></a>02604                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() nanosleeping cause missing instance_name...\n&quot;</span>);
<a name="l02605"></a>02605                 nanosleep(&amp;delay, NULL);
<a name="l02606"></a>02606         }
<a name="l02607"></a>02607 
<a name="l02608"></a>02608         <span class="comment">/* copy needed idi information */</span>
<a name="l02609"></a>02609         thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a> = idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>;
<a name="l02610"></a>02610         thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#abf6e1df34a8c51b8b6b4c350e76c9337">agent_name</a> = <span class="stringliteral">&quot;IDO2DB Trimming Thread&quot;</span>;
<a name="l02611"></a>02611         thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a> = idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a89ec0cdd236f85e3b20cd7714b65721b">agent_version</a>;
<a name="l02612"></a>02612         thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a> = idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a4b6075b4f57b95e2b1ce859f3d910445">disposition</a>;
<a name="l02613"></a>02613         thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a> = idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a537cfedde54c56063dc6db3d0221c32c">connect_source</a>;
<a name="l02614"></a>02614         thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a> = idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#aa39e79bd38aa0589d93bd26fe8b2d862">connect_type</a>;
<a name="l02615"></a>02615 
<a name="l02616"></a>02616 
<a name="l02617"></a>02617         delay.tv_sec = 5;
<a name="l02618"></a>02618         <span class="comment">/* save connection info to DB */</span>
<a name="l02619"></a>02619         <span class="keywordflow">while</span>(<a class="code" href="db_8h.html#a36b4adcbcc9e1070c8d146a6dcfdacd0">ido2db_thread_db_hello</a>(&amp;thread_idi) == <a class="code" href="module_2idoutils_2include_2common_8h.html#acf8b2367b3a651dee4ecb764e86adb18">IDO_ERROR</a>) {
<a name="l02620"></a>02620                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() no instance found, sleeping...\n&quot;</span>);
<a name="l02621"></a>02621                 nanosleep(&amp;delay, NULL);
<a name="l02622"></a>02622         }
<a name="l02623"></a>02623 
<a name="l02624"></a>02624         <span class="keywordflow">while</span>(1){
<a name="l02625"></a>02625                 <span class="keywordflow">if</span>(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>==<a class="code" href="module_2idoutils_2include_2common_8h.html#a1fa5946b37f7219aef0f13d921804a2f">IDO_TRUE</a>){
<a name="l02626"></a>02626                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup(): origin idi said we should disconnect the client\n&quot;</span>);
<a name="l02627"></a>02627                         <span class="keywordflow">break</span>;
<a name="l02628"></a>02628                 }
<a name="l02629"></a>02629                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() working...\n&quot;</span>);
<a name="l02630"></a>02630                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() idi is: &#39;%d&#39;\n&quot;</span>, idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#abee9ed5825c860963333469d4ac44d21">disconnect_client</a>);
<a name="l02631"></a>02631                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() has instance name &#39;%s&#39;...\n&quot;</span>, thread_idi.<a class="code" href="structido2db__input__data__info__struct.html#a431d8deafe6a37331df18cda22c5df79">instance_name</a>);
<a name="l02632"></a>02632                 <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() calling ido2db_db_perform_maintenance...\n&quot;</span>);
<a name="l02633"></a>02633 
<a name="l02634"></a>02634                 <span class="comment">/* Set this thread temporary to CANCEL_DISABLE to prevent interuption */</span>
<a name="l02635"></a>02635                 <span class="keywordflow">if</span>(pthread_setcancelstate( PTHREAD_CANCEL_DISABLE, &amp;old_thread_state) != 0) {
<a name="l02636"></a>02636                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 1, <span class="stringliteral">&quot;ido2db_thread_cleanup() Problem during pthread_setcancelstate() LOCK Cancel\n&quot;</span>);
<a name="l02637"></a>02637                 }
<a name="l02638"></a>02638 
<a name="l02639"></a>02639                 <span class="comment">/* Perfom DB Maintenance */</span>
<a name="l02640"></a>02640                 <a class="code" href="db_8h.html#af5208a5c32998d94cc977ee47344bc39">ido2db_db_perform_maintenance</a>(&amp;thread_idi);
<a name="l02641"></a>02641 
<a name="l02642"></a>02642                 <span class="comment">/* Reset this thread cancelstate */</span>
<a name="l02643"></a>02643                 <span class="keywordflow">if</span>(pthread_setcancelstate( old_thread_state, NULL) != 0) {
<a name="l02644"></a>02644                         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 1, <span class="stringliteral">&quot;ido2db_thread_cleanup() Problem during pthread_setcancelstate() UNLOCK Cancel\n&quot;</span>);
<a name="l02645"></a>02645                 }
<a name="l02646"></a>02646                 sleep(idi-&gt;<a class="code" href="structido2db__input__data__info__struct.html#a09c3d285310fe1c3abc5cac74719aa1a">dbinfo</a>.<a class="code" href="structido2db__dbconninfo__struct.html#aad3534298055c5d438a801779647ae66">trim_db_interval</a>+1);
<a name="l02647"></a>02647         }
<a name="l02648"></a>02648 
<a name="l02649"></a>02649         <span class="comment">/* gracefully back out of current operation... */</span>
<a name="l02650"></a>02650         <a class="code" href="db_8h.html#a8f7271af7f540e62f3acf72672fe34fb">ido2db_db_goodbye</a>(&amp;thread_idi);
<a name="l02651"></a>02651 
<a name="l02652"></a>02652         <span class="comment">/* disconnect from database */</span>
<a name="l02653"></a>02653         <a class="code" href="db_8h.html#aa3f184ab38d15b8ce774c348ed0e0d46">ido2db_db_disconnect</a>(&amp;thread_idi);
<a name="l02654"></a>02654         <a class="code" href="db_8h.html#a61a5fddb76c111a1689fd5dd95f9d7b7">ido2db_db_deinit</a>(&amp;thread_idi);
<a name="l02655"></a>02655 
<a name="l02656"></a>02656         <span class="comment">/* free memory */</span>
<a name="l02657"></a>02657         <a class="code" href="ido2db_8h.html#ac1307695902242ff43dda55bb331247a">ido2db_free_input_memory</a>(&amp;thread_idi);
<a name="l02658"></a>02658         <a class="code" href="ido2db_8h.html#affc50ec47a6ba3154814cf0ef77f0928">ido2db_free_connection_memory</a>(&amp;thread_idi);
<a name="l02659"></a>02659 
<a name="l02660"></a>02660         pthread_cleanup_pop(1);
<a name="l02661"></a>02661 
<a name="l02662"></a>02662         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() end\n&quot;</span>);
<a name="l02663"></a>02663         pthread_exit((<span class="keywordtype">void</span> *) pthread_self());
<a name="l02664"></a>02664 }
<a name="l02665"></a>02665 
<a name="l02666"></a>02666 <span class="comment">/* ******************************************************************</span>
<a name="l02667"></a>02667 <span class="comment"> *</span>
<a name="l02668"></a>02668 <span class="comment"> * exit_handler_mem is called as thread canceling</span>
<a name="l02669"></a>02669 <span class="comment"> *</span>
<a name="l02670"></a>02670 <span class="comment"> * ******************************************************************/</span>
<a name="l02671"></a>02671 
<a name="l02672"></a>02672 <span class="keyword">static</span> <span class="keywordtype">void</span> *ido2db_thread_cleanup_exit_handler(<span class="keywordtype">void</span> * arg) {
<a name="l02673"></a>02673         <a class="code" href="ido2db_8h.html#a41ec38b7ad432f23ae27fa524f162c80">ido2db_log_debug_info</a>(<a class="code" href="ido2db_8h.html#a5e1eab77d53300d6dbbf030d8eb689e5">IDO2DB_DEBUGL_PROCESSINFO</a>, 2, <span class="stringliteral">&quot;ido2db_thread_cleanup() cleanup_exit_handler...\n&quot;</span>);
<a name="l02674"></a>02674         <span class="keywordflow">return</span> 0;
<a name="l02675"></a>02675 
<a name="l02676"></a>02676 }
<a name="l02677"></a>02677 
<a name="l02678"></a><a class="code" href="ido2db_8c.html#a2736c793ca4023019d32b38245cafce5">02678</a> <span class="keywordtype">int</span> <a class="code" href="ido2db_8h.html#a2736c793ca4023019d32b38245cafce5">ido2db_kill_threads</a>(<span class="keywordtype">void</span>){
<a name="l02679"></a>02679 
<a name="l02680"></a>02680         <a class="code" href="db_8h.html#aa3f184ab38d15b8ce774c348ed0e0d46">ido2db_db_disconnect</a>(&amp;thread_idi);
<a name="l02681"></a>02681         <a class="code" href="db_8h.html#a61a5fddb76c111a1689fd5dd95f9d7b7">ido2db_db_deinit</a>(&amp;thread_idi);
<a name="l02682"></a>02682 
<a name="l02683"></a>02683         <span class="comment">/* kill sub threads */</span>
<a name="l02684"></a>02684         pthread_kill(<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0], SIGINT);
<a name="l02685"></a>02685         pthread_cancel(<a class="code" href="ido2db_8c.html#a8aabd1d298c05224c265426161429f05">thread_pool</a>[0]);
<a name="l02686"></a>02686 
<a name="l02687"></a>02687         <span class="keywordflow">return</span> <a class="code" href="module_2idoutils_2include_2common_8h.html#a09bcc0b0314a6545997e722684799f4e">IDO_OK</a>;
<a name="l02688"></a>02688 }
<a name="l02689"></a>02689 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="ido2db_8c.html">ido2db.c</a>      </li>
      <li class="footer">Generated on Fri Mar 18 2011 15:07:11 for Icinga-core by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
